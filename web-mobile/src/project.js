require=function a(i,c,l){function s(e,t){if(!c[e]){if(!i[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var r=c[e]={exports:{}};i[e][0].call(r.exports,function(t){return s(i[e][1][t]||t)},r,r.exports,a,i,c,l)}return c[e].exports}for(var u="function"==typeof require&&require,t=0;t<l.length;t++)s(l[t]);return s}({ArkInWorld:[function(t,e,o){"use strict";cc._RF.push(e,"dec21HFq/1BXrPvCkgOJBUs","ArkInWorld"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprArk=null,t.lblName=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(t,e){console.log("sar",t),this.data=t,this.sprArk.node.setContentSize(t.arkSize,t.arkSize),this.lblName.string=t.nickname,this.refreshZoom(e)},t.prototype.refreshZoom=function(t){var e=new cc.Vec2(this.data.arkLocationX,this.data.arkLocationY);e.mulSelf(t),this.node.position=e},__decorate([a(cc.Sprite)],t.prototype,"sprArk",void 0),__decorate([a(cc.Label)],t.prototype,"lblName",void 0),t=__decorate([r],t)}(cc.Component);o.default=i,cc._RF.pop()},{}],ArkUI:[function(t,e,o){"use strict";cc._RF.push(e,"e7f42dM68VAz487nLcu3wTI","ArkUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./BaseUI"),a=t("./WorldUI"),u=t("./DataMgr"),c=t("./BuildPanel"),l=t("./Building"),i=cc._decorator,s=i.ccclass,d=i.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.arkMap=null,t.cargoLabelContainer=null,t.cargoLabelTemplate=null,t.cargoLabels={},t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=1,t.buildingTemplate=null,t.buildingContainer=null,t.blueprint=null,t.blueprintIndicator=null,t.currentHoldingBlueprint=null,t.grpBuild=null,t.btnConfirmBuild=null,t}return __extends(t,e),(i=t).prototype.onLoad=function(){var n=this,e=i.Instance=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.cells=[];for(var t=-50;t<=50;t++){this.cells[t]=[];for(var o=-50;o<50;o++)this.cells[t][o]=new h}this.blueprint.on(cc.Node.EventType.TOUCH_MOVE,this.dragBlueprint.bind(this)),this.buildingTemplate.active=!1;var r=cc.instantiate(this.cargoLabelTemplate);r.parent=this.cargoLabelContainer;var a=r.getComponent(cc.Label);a.string="人口",this.cargoLabels.population=a,u.DataMgr.CargoConfig.forEach(function(t){var e=cc.instantiate(n.cargoLabelTemplate);e.parent=n.cargoLabelContainer;var o=e.getComponent(cc.Label);o.string=t.Name,n.cargoLabels[t.id]=o}),this.cargoLabelTemplate.active=!1},t.prototype.onEnable=function(){this.refreshZoom();for(var t=u.DataMgr.myData,e=-Math.floor(t.arkSize/2);e<t.arkSize/2;e++)for(var o=-Math.floor(t.arkSize/2);o<t.arkSize/2;o++){var n=this.cells[e][o];n.isLand=!0,n.building=null}var r=0;u.DataMgr.myBuildingData.forEach(function(t){r+=t.workers}),u.DataMgr.idleWorkers=t.population-r},t.prototype.refreshZoom=function(){this.arkMap.scale=this.zoomScale},t.prototype.update=function(t){u.DataMgr.changed&&(this.refreshData(),u.DataMgr.changed=!1),this.cargoLabels.population.string="人口   "+u.DataMgr.myData.population.toFixed()+"(闲置"+u.DataMgr.idleWorkers.toFixed()+")";for(var e=function(t){var n=u.DataMgr.CargoConfig[t],e=u.DataMgr.myCargoData.find(function(t,e,o){return t.id==n.id});o.cargoLabels[n.id].string=n.Name+"   "+e.amount.toFixed()},o=this,n=0;n<u.DataMgr.CargoConfig.length;n++)e(n);var r=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<r?((r-=5*t)<.5&&(r=.5),this.sldZoom.progress=r):r<.5&&(.5<(r+=5*t)&&(r=.5),this.sldZoom.progress=r)),.5!=r){var a=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(r-.5)*5*t),this.clampZoom();var i=this.zoomScale/a;this.arkMap.position=this.arkMap.position.mul(i),this.refreshZoom()}if(this.currentHoldingBlueprint){this.blueprint.active=!0,this.blueprint.position=new cc.Vec2(100*this.currentBlueprintIJ.i-50,100*this.currentBlueprintIJ.j-50),this.blueprint.setContentSize(100*this.currentHoldingBlueprint.length,100*this.currentHoldingBlueprint.width);var c=!1;this.blueprintIndicator.clear();for(n=0;n<this.currentHoldingBlueprint.length;n++)for(var l=0;l<this.currentHoldingBlueprint.width;l++){var s=this.cells[this.currentBlueprintIJ.i+n][this.currentBlueprintIJ.j+l];this.blueprintIndicator.fillColor=s.building?cc.Color.RED:cc.Color.GREEN,s.building&&(c=!0),this.blueprintIndicator.fillRect(100*n,100*l,100,100)}this.grpBuild.active=!0,this.btnConfirmBuild.interactable=!c}else this.blueprint.active=!1,this.grpBuild.active=!1},t.prototype.refreshData=function(){},t.prototype.onGotoWorldClick=function(){n.default.EnterUI(a.default)},t.prototype.onBuildingClick=function(){c.default.Show()},t.prototype.onTechClick=function(){},t.prototype.onCenterBtnClick=function(){var t=u.DataMgr.myData,e=new cc.Vec2(t.arkLocationX,t.arkLocationY);e.mulSelf(this.zoomScale),this.arkMap.position=e.neg()},t.prototype.onPanPadTouchMove=function(t){console.log("drag map");var e=t.getDelta();this.arkMap.position=this.arkMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),o=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/o;this.arkMap.position=this.arkMap.position.mul(n),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){3<this.zoomScale&&(this.zoomScale=3),this.zoomScale<.3&&(this.zoomScale=.3)},t.prototype.enterBuildMode=function(t){this.currentHoldingBlueprint=t,this.currentBlueprintIJ=u.IJ.ZERO},t.prototype.dragBlueprint=function(t){var e=t.getLocation();console.log("loc",e);var o=this.arkMap.convertToNodeSpaceAR(e);this.currentBlueprintIJ.i=Math.round(o.x/100),this.currentBlueprintIJ.j=Math.round(o.y/100)},t.prototype.onBtnConfirmBuildClick=function(){for(var t=!1,e=0;e<this.currentHoldingBlueprint.length;e++)for(var o=0;o<this.currentHoldingBlueprint.width;o++){this.cells[this.currentBlueprintIJ.i+e][this.currentBlueprintIJ.j+o].building&&(t=!0)}t||(this.createBuilding(this.currentHoldingBlueprint,this.currentBlueprintIJ),"road00001"==this.currentHoldingBlueprint.id?this.currentBlueprintIJ.j+=1:this.currentHoldingBlueprint=null)},t.prototype.onBtnCancelBuildClick=function(){this.currentHoldingBlueprint=null},t.prototype.createBuilding=function(t,e){var o=cc.instantiate(this.buildingTemplate);o.parent=this.buildingContainer;var n=o.getComponent(l.default),r=new u.BuildingData;r.id=t.id,r.ij=e.clone(),r.workers=0,u.DataMgr.myBuildingData.push(r),n.setInfo(t,r),o.position=new cc.Vec2(100*e.i-50,100*e.j-50),o.active=!0;for(var a=0;a<t.length;a++)for(var i=0;i<t.width;i++){this.cells[e.i+a][e.j+i].building=n}},__decorate([d(cc.Node)],t.prototype,"arkMap",void 0),__decorate([d(cc.Node)],t.prototype,"cargoLabelContainer",void 0),__decorate([d(cc.Node)],t.prototype,"cargoLabelTemplate",void 0),__decorate([d(cc.Node)],t.prototype,"panPad",void 0),__decorate([d(cc.Slider)],t.prototype,"sldZoom",void 0),__decorate([d(cc.Node)],t.prototype,"buildingTemplate",void 0),__decorate([d(cc.Node)],t.prototype,"buildingContainer",void 0),__decorate([d(cc.Node)],t.prototype,"blueprint",void 0),__decorate([d(cc.Graphics)],t.prototype,"blueprintIndicator",void 0),__decorate([d(cc.Node)],t.prototype,"grpBuild",void 0),__decorate([d(cc.Button)],t.prototype,"btnConfirmBuild",void 0),t=i=__decorate([s],t);var i}(r.default);o.default=p;var h=function(){this.isLand=!1,this.building=null};cc._RF.pop()},{"./BaseUI":"BaseUI","./BuildPanel":"BuildPanel","./Building":"Building","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./WorldUI":"WorldUI"}],BaseUI:[function(t,e,o){"use strict";cc._RF.push(e,"3b934a4EjZFs6JzaRDhWpVf","BaseUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([r],e)}(cc.Component));o.default=a,cc._RF.pop()},{}],BuildPanel:[function(t,e,o){"use strict";cc._RF.push(e,"5cf0290QotGfpJodxaDGNKp","BuildPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./DataMgr"),r=t("./BuildingButton"),a=cc._decorator,i=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonContainer=null,t.buttonTemplate=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1,console.log("BP onL")},t.prototype.start=function(){var o=this;n.DataMgr.BuildingConfig.forEach(function(t){var e=cc.instantiate(o.buttonTemplate);e.parent=o.buttonContainer,e.getComponent(r.default).setAndRefresh(t),e.active=!0}),this.buttonTemplate.active=!1},t.prototype.onEnable=function(){},t.prototype.refresh=function(){},t.Show=function(){o.Instance.node.active=!0},t.Hide=function(){o.Instance.node.active=!1},t.prototype.close=function(){this.node.active=!1},__decorate([c(cc.Node)],t.prototype,"buttonContainer",void 0),__decorate([c(cc.Node)],t.prototype,"buttonTemplate",void 0),t=o=__decorate([i],t);var o}(cc.Component);o.default=l,cc._RF.pop()},{"./BuildingButton":"BuildingButton","./DataMgr":"DataMgr"}],BuildingButton:[function(t,e,o){"use strict";cc._RF.push(e,"7884bIsfolMCKOoH+GiGik+","BuildingButton"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./BuildPanel"),r=t("./ArkUI"),i=t("./DataMgr"),a=cc._decorator,c=a.ccclass,l=a.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblSize=null,t.lblConsumption=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(r){this.info=r,this.lblName.string=r.Name,this.lblSize.string=r.length+"*"+r.width;for(var a=[],t=function(t){var e=r["Raw"+t];if(e&&0<e.length){var o=r["Raw"+t+"Rate"],n=i.DataMgr.CargoConfig.find(function(t){return t.id==e});a.push("消耗 "+o+n.Name+"/min")}},e=0;e<4;e++)t(e);var o=function(t){var e=r["Out"+t];if(e&&0<e.length){var o=r["Out"+t+"Rate"],n=i.DataMgr.CargoConfig.find(function(t){return t.id==e});a.push("生产 "+o+n.Name+"/min")}};for(e=0;e<4;e++)o(e);if(0<a.length){var n=a[0];for(e=1;e<a.length;e++){n+="\n"+a[e]}this.lblConsumption.string=n}else this.lblConsumption.string=""},t.prototype.onClick=function(){n.default.Hide(),r.default.Instance.enterBuildMode(this.info)},__decorate([l(cc.Label)],t.prototype,"lblName",void 0),__decorate([l(cc.Label)],t.prototype,"lblSize",void 0),__decorate([l(cc.Label)],t.prototype,"lblConsumption",void 0),t=__decorate([c],t)}(cc.Component);o.default=s,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildPanel":"BuildPanel","./DataMgr":"DataMgr"}],Building:[function(t,e,o){"use strict";cc._RF.push(e,"3d090TfsndH9pF8dNZnNchl","Building"),Object.defineProperty(o,"__esModule",{value:!0});var c=t("./DataMgr"),n=cc._decorator,r=n.ccclass,a=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblConsumption=null,t.lblOutput=null,t.lblWorkers=null,t.nodeGear=null,t}return __extends(t,e),t.prototype.setInfo=function(r,t){this.info=r,this.data=t,this.lblName.string=r.Name;for(var a=[],e=function(t){var e=r["Raw"+t];if(e&&0<e.length){var o=r["Raw"+t+"Rate"],n=c.DataMgr.CargoConfig.find(function(t){return t.id==e});a.push("消耗 "+o+n.Name+"/min")}},o=0;o<4;o++)e(o);var n=function(t){var e=r["Out"+t];if(e&&0<e.length){var o=r["Out"+t+"Rate"],n=c.DataMgr.CargoConfig.find(function(t){return t.id==e});a.push("生产 "+o+n.Name+"/min")}};for(o=0;o<4;o++)n(o);if(0<a.length){var i=a[0];for(o=1;o<a.length;o++){i+="\n"+a[o]}this.lblConsumption.string=i}else this.lblConsumption.string="";this.node.setContentSize(100*r.length,100*r.width)},t.prototype.changeWorkers=function(t,e){if("-"==e){var o=Math.min(this.data.workers,1);this.data.workers-=o,c.DataMgr.idleWorkers+=o}else if("+"==e){var n=Math.min(c.DataMgr.idleWorkers,1);this.data.workers+=n,c.DataMgr.idleWorkers-=n}},t.prototype.update=function(t){this.lblWorkers.string="工人 "+this.data.workers.toFixed(),this.data.isWorking&&(this.nodeGear.rotation+=90*this.data.workers*t)},__decorate([a(cc.Label)],t.prototype,"lblName",void 0),__decorate([a(cc.Label)],t.prototype,"lblConsumption",void 0),__decorate([a(cc.Label)],t.prototype,"lblOutput",void 0),__decorate([a(cc.Label)],t.prototype,"lblWorkers",void 0),__decorate([a(cc.Node)],t.prototype,"nodeGear",void 0),t=__decorate([r],t)}(cc.Component);o.default=i,cc._RF.pop()},{"./DataMgr":"DataMgr"}],CvsMain:[function(t,e,o){"use strict";cc._RF.push(e,"69237yn4edJBK/5XvDAGlzX","CvsMain"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.uiContainer=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).uiContainer.children.forEach(function(t){return t.active=!1})},t.EnterUI=function(e){this.Instance.uiContainer.children.forEach(function(t){t.getComponent(e)?t.active=!0:t.active=!1})},__decorate([a(cc.Node)],t.prototype,"uiContainer",void 0),t=o=__decorate([r],t);var o}(cc.Component);o.default=i,cc._RF.pop()},{}],DataMgr:[function(t,e,o){"use strict";cc._RF.push(e,"c6c13KfXfRK06sYYQzi7BU0","DataMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){}return e.readData=function(){try{var t=JSON.parse(cc.sys.localStorage.getItem("user0"));e.myData=t,e.myBuildingData=JSON.parse(cc.sys.localStorage.getItem("user0Building")),e.changed=!0,console.log("finish read data")}catch(t){console.error(t)}},e.writeData=function(){try{cc.sys.localStorage.setItem("user0",JSON.stringify(e.myData)),cc.sys.localStorage.setItem("user0Building",JSON.stringify(e.myBuildingData)),console.log("finish write data")}catch(t){console.error(t)}},e.clearData=function(){cc.sys.localStorage.removeItem("user0"),cc.sys.localStorage.removeItem("user0Building")},e.idleWorkers=0,e.othersData=[],e.changed=!1,e}();o.DataMgr=n;var r=function(){this.population=0};o.UserData=r;var a=function(){};o.BuildingInfo=a;var i=function(){this.workers=0,this.isWorking=!1};o.BuildingData=i;var c=function(){};o.CargoInfo=c;var l=function(){};o.CargoData=l;var s=function(){function e(){this.i=0,this.j=0}return e.prototype.clone=function(){var t=new e;return t.i=this.i,t.j=this.j,t},Object.defineProperty(e,"ZERO",{get:function(){return new e},enumerable:!0,configurable:!0}),e}();o.IJ=s,cc._RF.pop()},{}],DialogPanel:[function(t,e,o){"use strict";cc._RF.push(e,"c0958fmSyFAp6wyHbHS0e10","DialogPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblTitle=null,t.lblContext=null,t.btn0=null,t.lblBtn0=null,t.btn1=null,t.lblBtn1=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).hide()},t.PopupWith1Button=function(t,e,o,n){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=o,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(0,0),this.Instance.btn1.active=!1},t.PopupWith2Buttons=function(t,e,o,n,r,a){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=o,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(-150,0),this.Instance.func1=n,this.Instance.lblBtn1.string=o,this.Instance.btn1.active=!0,this.Instance.btn1.position=new cc.Vec2(150,0)},t.prototype.onBtn0Click=function(){this.func0&&this.func0()},t.prototype.onBtn1Click=function(){this.func1&&this.func1()},t.prototype.show=function(){this.node.active=!0},t.prototype.hide=function(){this.node.active=!1},__decorate([a(cc.Label)],t.prototype,"lblTitle",void 0),__decorate([a(cc.Label)],t.prototype,"lblContext",void 0),__decorate([a(cc.Node)],t.prototype,"btn0",void 0),__decorate([a(cc.Label)],t.prototype,"lblBtn0",void 0),__decorate([a(cc.Node)],t.prototype,"btn1",void 0),__decorate([a(cc.Label)],t.prototype,"lblBtn1",void 0),t=o=__decorate([r],t);var o}(cc.Component);o.default=i,cc._RF.pop()},{}],Foregroud:[function(t,e,o){"use strict";cc._RF.push(e,"c7a1eqdirtJGpHjde8W3SsV","Foregroud"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.node.children.forEach(function(t){t.active||(t.active=!0,t.active=!1)})},e=__decorate([r],e)}(cc.Component));o.default=a,cc._RF.pop()},{}],HomeUI:[function(t,e,o){"use strict";cc._RF.push(e,"458fd6d6ChEGo+U+drv+haG","HomeUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./BaseUI"),a=t("./MainCtrl"),i=t("./DataMgr"),c=t("./WorldUI"),l=cc._decorator,s=l.ccclass,u=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnClaim0=null,t.btnClaim1=null,t.btnClaim2=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){o.Instance=this},t.prototype.start=function(){i.DataMgr.myData&&(i.DataMgr.myData.arkSize||(i.DataMgr.myData=null)),i.DataMgr.myData&&n.default.EnterUI(c.default)},t.prototype.onClaim=function(t,e){switch(e){case"0":i.DataMgr.myData=a.default.Instance.generateNewArk(9),this.enterGameWithArk()}i.DataMgr.myBuildingData=[]},t.prototype.enterGameWithArk=function(){i.DataMgr.myCargoData=[],i.DataMgr.CargoConfig.forEach(function(t){var e=new i.CargoData;e.id=t.id,e.amount=0,i.DataMgr.myCargoData.push(e)}),n.default.EnterUI(c.default)},__decorate([u(cc.Button)],t.prototype,"btnClaim0",void 0),__decorate([u(cc.Button)],t.prototype,"btnClaim1",void 0),__decorate([u(cc.Button)],t.prototype,"btnClaim2",void 0),t=o=__decorate([s],t);var o}(r.default);o.default=d,cc._RF.pop()},{"./BaseUI":"BaseUI","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./MainCtrl":"MainCtrl","./WorldUI":"WorldUI"}],MainCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"162b9/mIe1LjqpHBpjQnzp+","MainCtrl"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./HomeUI"),l=t("./DataMgr"),a=cc._decorator,i=a.ccclass,c=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),(o=e).prototype.onLoad=function(){o.Instance=this,l.DataMgr.readData(),this.fetchRemoteData()},e.prototype.start=function(){n.default.EnterUI(r.default),console.log("goto home"),cc.loader.loadRes("Building",function(t,e){console.log("Building loaded"),l.DataMgr.BuildingConfig=e}.bind(this)),cc.loader.loadRes("Cargo",function(t,e){console.log("Cargo loaded"),l.DataMgr.CargoConfig=e}.bind(this)),cc.loader.loadRes("Tech",function(t,e){console.log("Tech loaded"),l.DataMgr.TechConfig=e}.bind(this))},e.prototype.gotoHome=function(){n.default.EnterUI(r.default)},e.prototype.generateNewArk=function(t){var e=new l.UserData;e.arkSize=t;var o=Math.random()*Math.PI;return e.arkLocationX=4e3*Math.cos(o),e.arkLocationY=4e3*Math.sin(o),e.speed=0,e.population=2,e.nickname="新玩家",e},e.prototype.fetchRemoteData=function(){var t=[],e=new l.UserData;e.arkSize=41,e.arkLocationX=0,e.arkLocationY=0,e.speed=0,e.population=2251,e.nickname="星云号交易所方舟",t.push(e),l.DataMgr.othersData=t,l.DataMgr.changed=!0},e.prototype.update=function(c){l.DataMgr.myBuildingData&&l.DataMgr.myBuildingData.forEach(function(n){if(n.isWorking=!1,!(n.workers<=0)){for(var r=l.DataMgr.BuildingConfig.find(function(t){return t.id==n.id}),t=[],e=0;e<4;e++){var o=r["Raw"+e];o&&0<o.length&&t.push([o,r["Raw"+e+"Rate"]/60*c*n.workers])}var a=!0;if(t.forEach(function(e){if(a){var t=l.DataMgr.myCargoData.find(function(t){return t.id==e[0]});t&&t.amount>e[1]?e.push(t):a=!1}}),a){t.forEach(function(t){t[2].amount-=t[1]});var i=function(t){var e=r["Out"+t];if(e&&0<e.length){var o=l.DataMgr.myCargoData.find(function(t){return t.id==e});o||((o=new l.CargoData).id=e,o.amount=0,l.DataMgr.myCargoData.push(o)),o.amount+=r["Out"+t+"Rate"]/60*c*n.workers}};for(e=0;e<4;e++)i(e);n.isWorking=!0}}})},e=o=__decorate([i],e);var o}(cc.Component));o.default=c,cc._RF.pop()},{"./CvsMain":"CvsMain","./DataMgr":"DataMgr","./HomeUI":"HomeUI"}],TaskMgr:[function(t,e,o){"use strict";cc._RF.push(e,"8b016C7S51BeY/RKmLSDzh4","TaskMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.list=[{description:"",func:function(){}}],t}();o.default=n,cc._RF.pop()},{}],WorldUI:[function(t,e,o){"use strict";cc._RF.push(e,"d2d4ehqPFVDS4fv9l1Oq7He","WorldUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./BaseUI"),a=t("./ArkUI"),i=t("./ArkInWorld"),c=t("./DataMgr"),l=cc._decorator,s=l.ccclass,u=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblEnergy=null,t.btnPause=null,t.ingameRange=null,t.arkContainer=null,t.arkTemplate=null,t.worldMap=null,t.earth=null,t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=.1,t}return __extends(t,e),(o=t).prototype.onLoad=function(){var e=o.Instance=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this)},t.prototype.start=function(){},t.prototype.onEnable=function(){this.refreshData(),this.refreshZoom()},t.prototype.refreshData=function(){for(var t=c.DataMgr.othersData.length+1,e=this.arkContainer.childrenCount;e<t;e++){cc.instantiate(this.arkTemplate).parent=this.arkContainer}var o=[];for(e=t;e<this.arkContainer.childrenCount;e++)o.push(this.arkContainer.children[e]);o.forEach(function(t){return t.destroy()}),this.arkContainer.children[0].getComponent(i.default).setAndRefresh(c.DataMgr.myData,this.zoomScale);for(e=0;e<c.DataMgr.othersData.length;e++){c.DataMgr.othersData[e];this.arkContainer.children[e+1].getComponent(i.default).setAndRefresh(c.DataMgr.othersData[e],this.zoomScale)}},t.prototype.refreshZoom=function(){var e=this,t=12e3*this.zoomScale;this.earth.setContentSize(t,t),this.arkContainer.children.forEach(function(t){t.getComponent(i.default).refreshZoom(e.zoomScale)})},t.prototype.update=function(t){c.DataMgr.changed&&(this.refreshData(),c.DataMgr.changed=!1);var e=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<e?((e-=5*t)<.5&&(e=.5),this.sldZoom.progress=e):e<.5&&(.5<(e+=5*t)&&(e=.5),this.sldZoom.progress=e)),.5!=e){var o=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(e-.5)*5*t),this.clampZoom();var n=this.zoomScale/o;this.worldMap.position=this.worldMap.position.mul(n),this.refreshZoom()}},t.prototype.onGotoArkClick=function(){n.default.EnterUI(a.default)},t.prototype.onCenterBtnClick=function(){var t=c.DataMgr.myData,e=new cc.Vec2(t.arkLocationX,t.arkLocationY);e.mulSelf(this.zoomScale),this.worldMap.position=e.neg()},t.prototype.onPanPadTouchMove=function(t){console.log("drag map");var e=t.getDelta();this.worldMap.position=this.worldMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),o=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/o;this.worldMap.position=this.worldMap.position.mul(n),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){10<this.zoomScale&&(this.zoomScale=10),this.zoomScale<.01&&(this.zoomScale=.01)},__decorate([u(cc.Label)],t.prototype,"lblEnergy",void 0),__decorate([u(cc.Button)],t.prototype,"btnPause",void 0),__decorate([u(cc.Node)],t.prototype,"ingameRange",void 0),__decorate([u(cc.Node)],t.prototype,"arkContainer",void 0),__decorate([u(cc.Node)],t.prototype,"arkTemplate",void 0),__decorate([u(cc.Node)],t.prototype,"worldMap",void 0),__decorate([u(cc.Node)],t.prototype,"earth",void 0),__decorate([u(cc.Node)],t.prototype,"panPad",void 0),__decorate([u(cc.Slider)],t.prototype,"sldZoom",void 0),t=o=__decorate([s],t);var o}(r.default);o.default=d,cc._RF.pop()},{"./ArkInWorld":"ArkInWorld","./ArkUI":"ArkUI","./BaseUI":"BaseUI","./CvsMain":"CvsMain","./DataMgr":"DataMgr"}]},{},["ArkInWorld","ArkUI","BaseUI","BuildPanel","Building","BuildingButton","CvsMain","DataMgr","DialogPanel","Foregroud","HomeUI","MainCtrl","TaskMgr","WorldUI"]);