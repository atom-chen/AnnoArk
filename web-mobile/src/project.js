require=function a(i,c,l){function s(e,t){if(!c[e]){if(!i[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var r=c[e]={exports:{}};i[e][0].call(r.exports,function(t){return s(i[e][1][t]||t)},r,r.exports,a,i,c,l)}return c[e].exports}for(var u="function"==typeof require&&require,t=0;t<l.length;t++)s(l[t]);return s}({ArkInWorld:[function(t,e,o){"use strict";cc._RF.push(e,"dec21HFq/1BXrPvCkgOJBUs","ArkInWorld"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprArk=null,t.lblName=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(t,e){console.log("sar",t),this.data=t,this.sprArk.node.setContentSize(t.arkSize,t.arkSize),this.lblName.string=t.nickname,this.refreshZoom(e)},t.prototype.refreshZoom=function(t){var e=new cc.Vec2(this.data.arkLocationX,this.data.arkLocationY);e.mulSelf(t),this.node.position=e},__decorate([a(cc.Sprite)],t.prototype,"sprArk",void 0),__decorate([a(cc.Label)],t.prototype,"lblName",void 0),t=__decorate([r],t)}(cc.Component);o.default=i,cc._RF.pop()},{}],ArkUI:[function(t,e,o){"use strict";cc._RF.push(e,"e7f42dM68VAz487nLcu3wTI","ArkUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./BaseUI"),a=t("./WorldUI"),u=t("./DataMgr"),c=t("./BuildPanel"),l=t("./Building"),s=t("./TechPanel"),d=t("./DialogPanel"),i=cc._decorator,p=i.ccclass,h=i.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.arkMap=null,t.cargoLabelContainer=null,t.cargoLabelTemplate=null,t.cargoLabels={},t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=1,t.workshopTemplate=null,t.houseTemplate=null,t.roadTemplate=null,t.buildingContainer=null,t.blueprint=null,t.blueprintIndicator=null,t.currentHoldingBlueprint=null,t.grpBuild=null,t.btnConfirmBuild=null,t.selectedBuilding=null,t.grpBuildingInfo=null,t}return __extends(t,e),(i=t).prototype.onLoad=function(){var n=this,e=i.Instance=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.cells=[];for(var t=-50;t<=50;t++){this.cells[t]=[];for(var o=-50;o<50;o++)this.cells[t][o]=new g}this.blueprint.on(cc.Node.EventType.TOUCH_MOVE,this.dragBlueprint.bind(this)),this.workshopTemplate.active=!1,this.roadTemplate.active=!1,this.houseTemplate.active=!1;var r=cc.instantiate(this.cargoLabelTemplate);r.parent=this.cargoLabelContainer;var a=r.getComponent(cc.Label);a.string="人口",this.cargoLabels.population=a,u.DataMgr.CargoConfig.forEach(function(t){var e=cc.instantiate(n.cargoLabelTemplate);e.parent=n.cargoLabelContainer;var o=e.getComponent(cc.Label);o.string=t.Name,n.cargoLabels[t.id]=o}),this.cargoLabelTemplate.active=!1},t.prototype.onEnable=function(){this.refreshZoom();for(var t=u.DataMgr.myData,e=-Math.floor(t.arkSize/2);e<t.arkSize/2;e++)for(var o=-Math.floor(t.arkSize/2);o<t.arkSize/2;o++){var n=this.cells[e][o];n.isLand=!0,n.building=null}var r=0;u.DataMgr.myBuildingData.forEach(function(t){r+=t.workers}),u.DataMgr.idleWorkers=t.population-r,this.deselectBuilding()},t.prototype.refreshZoom=function(){this.arkMap.scale=this.zoomScale},t.prototype.update=function(t){u.DataMgr.changed&&(this.refreshData(),u.DataMgr.changed=!1),this.cargoLabels.population.string="人口 "+u.DataMgr.myData.population+"/"+u.DataMgr.populationLimit+" (闲置 "+u.DataMgr.idleWorkers+") 增长"+u.DataMgr.populationGrowPerMin.toFixed(0)+"/min";for(var e=function(t){var n=u.DataMgr.CargoConfig[t],e=u.DataMgr.myCargoData.find(function(t,e,o){return t.id==n.id});o.cargoLabels[n.id].string=n.Name+"   "+Math.floor(e.amount).toFixed()},o=this,n=0;n<u.DataMgr.CargoConfig.length;n++)e(n);var r=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<r?((r-=5*t)<.5&&(r=.5),this.sldZoom.progress=r):r<.5&&(.5<(r+=5*t)&&(r=.5),this.sldZoom.progress=r)),.5!=r){var a=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(r-.5)*5*t),this.clampZoom();var i=this.zoomScale/a;this.arkMap.position=this.arkMap.position.mul(i),this.refreshZoom()}if(this.currentHoldingBlueprint){this.blueprint.active=!0,this.blueprint.position=new cc.Vec2(100*this.currentBlueprintIJ.i-50,100*this.currentBlueprintIJ.j-50),this.blueprint.setContentSize(100*this.currentHoldingBlueprint.length,100*this.currentHoldingBlueprint.width);var c=!0;this.blueprintIndicator.clear();for(n=0;n<this.currentHoldingBlueprint.length;n++)for(var l=0;l<this.currentHoldingBlueprint.width;l++){var s=this.cells[this.currentBlueprintIJ.i+n][this.currentBlueprintIJ.j+l];this.blueprintIndicator.fillColor=s.building?cc.Color.RED:cc.Color.GREEN,s.building&&(c=!1),s.isLand||(c=!1),this.blueprintIndicator.fillRect(100*n,100*l,100,100)}this.grpBuild.active=!0,this.btnConfirmBuild.interactable=c}else this.blueprint.active=!1,this.grpBuild.active=!1;this.selectedBuilding?this.grpBuildingInfo.active=!0:this.grpBuildingInfo.active=!1},t.prototype.refreshData=function(){},t.prototype.onGotoWorldClick=function(){this.deselectBuilding(),n.default.EnterUI(a.default)},t.prototype.onBuildBtnClick=function(){this.deselectBuilding(),c.default.Show()},t.prototype.onTechClick=function(){this.deselectBuilding(),s.default.Show()},t.prototype.onCenterBtnClick=function(){var t=u.DataMgr.myData,e=new cc.Vec2(t.arkLocationX,t.arkLocationY);e.mulSelf(this.zoomScale),this.arkMap.position=e.neg()},t.prototype.onPanPadTouchMove=function(t){console.log("drag map");var e=t.getDelta();this.arkMap.position=this.arkMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),o=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/o;this.arkMap.position=this.arkMap.position.mul(n),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){3<this.zoomScale&&(this.zoomScale=3),this.zoomScale<.3&&(this.zoomScale=.3)},t.prototype.enterBuildMode=function(t){this.currentHoldingBlueprint=t,this.currentBlueprintIJ=u.IJ.ZERO},t.prototype.dragBlueprint=function(t){var e=t.getLocation(),o=this.arkMap.convertToNodeSpaceAR(e);this.currentBlueprintIJ.i=Math.round(o.x/100),this.currentBlueprintIJ.j=Math.round(o.y/100)},t.prototype.onBtnConfirmBuildClick=function(){for(var t=!0,e=0;e<this.currentHoldingBlueprint.length;e++)for(var o=0;o<this.currentHoldingBlueprint.width;o++){var n=this.cells[this.currentBlueprintIJ.i+e][this.currentBlueprintIJ.j+o];n.building&&(t=!1),n.isLand||(t=!1)}if(t){var r=[];for(e=0;e<4;e++){var a=this.currentHoldingBlueprint["BuildMat"+e];if(a&&0<a.length){var i=this.currentHoldingBlueprint["BuildMat"+e+"Count"];r.push([a,i])}}var c=!0;r.forEach(function(e){u.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount<e[1]&&(c=!1)}),c&&(r.forEach(function(e){u.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount-=e[1]}),this.createBuilding(this.currentHoldingBlueprint,this.currentBlueprintIJ),"road00001"==this.currentHoldingBlueprint.id?this.currentBlueprintIJ.j+=1:this.currentHoldingBlueprint=null)}},t.prototype.onBtnCancelBuildClick=function(){this.currentHoldingBlueprint=null},t.prototype.createBuilding=function(t,e){var o=t.prefab,n=cc.instantiate(this[o+"Template"]);n.parent=this.buildingContainer;var r=n.getComponent(l.default),a=new u.BuildingData;a.id=t.id,a.ij=e.clone(),a.workers=0,u.DataMgr.myBuildingData.push(a),r.setInfo(t,a),n.position=new cc.Vec2(100*e.i-50,100*e.j-50),n.active=!0;for(var i=0;i<t.length;i++)for(var c=0;c<t.width;c++){this.cells[e.i+i][e.j+c].building=r}},t.prototype.selectBuilding=function(t){console.log("选中建筑"),this.selectedBuilding=t},t.prototype.deselectBuilding=function(){this.selectedBuilding=null},t.prototype.onDemolishBtnClick=function(){var t=i.Instance;this.selectedBuilding&&d.default.PopupWith2Buttons("确定拆除建筑吗",t.selectedBuilding.info.Name+"\n建筑材料不予返还","拆除",function(){t.demolishBuilding(t.selectedBuilding),t.deselectBuilding()},"取消",null)},t.prototype.demolishBuilding=function(e){if(e){console.log("拆除建筑");var t=u.DataMgr.myBuildingData.findIndex(function(t){return t==e.data});if(0<=t){var o=e.data.workers;u.DataMgr.myBuildingData.splice(t,1),e.node.destroy(),u.DataMgr.idleWorkers+=o}}},__decorate([h(cc.Node)],t.prototype,"arkMap",void 0),__decorate([h(cc.Node)],t.prototype,"cargoLabelContainer",void 0),__decorate([h(cc.Node)],t.prototype,"cargoLabelTemplate",void 0),__decorate([h(cc.Node)],t.prototype,"panPad",void 0),__decorate([h(cc.Slider)],t.prototype,"sldZoom",void 0),__decorate([h(cc.Node)],t.prototype,"workshopTemplate",void 0),__decorate([h(cc.Node)],t.prototype,"houseTemplate",void 0),__decorate([h(cc.Node)],t.prototype,"roadTemplate",void 0),__decorate([h(cc.Node)],t.prototype,"buildingContainer",void 0),__decorate([h(cc.Node)],t.prototype,"blueprint",void 0),__decorate([h(cc.Graphics)],t.prototype,"blueprintIndicator",void 0),__decorate([h(cc.Node)],t.prototype,"grpBuild",void 0),__decorate([h(cc.Button)],t.prototype,"btnConfirmBuild",void 0),__decorate([h(cc.Node)],t.prototype,"grpBuildingInfo",void 0),t=i=__decorate([p],t);var i}(r.default);o.default=f;var g=function(){this.isLand=!1,this.building=null};cc._RF.pop()},{"./BaseUI":"BaseUI","./BuildPanel":"BuildPanel","./Building":"Building","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./TechPanel":"TechPanel","./WorldUI":"WorldUI"}],BaseUI:[function(t,e,o){"use strict";cc._RF.push(e,"3b934a4EjZFs6JzaRDhWpVf","BaseUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([r],e)}(cc.Component));o.default=a,cc._RF.pop()},{}],BuildPanel:[function(t,e,o){"use strict";cc._RF.push(e,"5cf0290QotGfpJodxaDGNKp","BuildPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./DataMgr"),r=t("./BuildingButton"),a=cc._decorator,i=a.ccclass,c=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonContainer=null,t.buttonTemplate=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.start=function(){var o=this;n.DataMgr.BuildingConfig.forEach(function(t){var e=cc.instantiate(o.buttonTemplate);e.parent=o.buttonContainer,e.getComponent(r.default).setAndRefresh(t),e.active=!0}),this.buttonTemplate.active=!1},t.prototype.onEnable=function(){},t.prototype.refresh=function(){},t.Show=function(){o.Instance.node.active=!0},t.Hide=function(){o.Instance.node.active=!1},t.prototype.close=function(){this.node.active=!1},__decorate([c(cc.Node)],t.prototype,"buttonContainer",void 0),__decorate([c(cc.Node)],t.prototype,"buttonTemplate",void 0),t=o=__decorate([i],t);var o}(cc.Component);o.default=l,cc._RF.pop()},{"./BuildingButton":"BuildingButton","./DataMgr":"DataMgr"}],BuildingButton:[function(t,e,o){"use strict";cc._RF.push(e,"7884bIsfolMCKOoH+GiGik+","BuildingButton"),Object.defineProperty(o,"__esModule",{value:!0});var l=t("./BuildPanel"),s=t("./ArkUI"),u=t("./DataMgr"),d=t("./DialogPanel"),n=cc._decorator,r=n.ccclass,a=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblSize=null,t.sprSize=null,t.lblConsumption=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(r){this.info=r,this.lblName.string=r.Name,this.lblSize.string=r.length+"*"+r.width,this.sprSize.setContentSize(12*r.length,12*r.width);for(var a=[],t=function(t){var e=r["BuildMat"+t];if(e&&0<e.length){var o=r["BuildMat"+t+"Count"],n=u.DataMgr.CargoConfig.find(function(t){return t.id==e});a.push(n.Name+"*"+o)}},e=0;e<4;e++)t(e);if(0<a.length){var o=a[0];for(e=1;e<a.length;e++){o+="\n"+a[e]}this.lblConsumption.string=o}else this.lblConsumption.string=""},t.prototype.onClick=function(){console.log("TODO:打开详情面板")},t.prototype.onBuildClick=function(){for(var t=[],e=0;e<4;e++){var o=this.info["BuildMat"+e];if(o&&0<o.length){var n=this.info["BuildMat"+e+"Count"];t.push([o,n])}}var r=!0;if(t.forEach(function(e){u.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount<e[1]&&(r=!1)}),r){var a=[];for(e=0;e<4;e++){var i=this.info["NeedTech"+e];i&&0<i.length&&a.push(i)}r=!0;var c=[];a.forEach(function(e){if(!u.DataMgr.myTechData.find(function(t){return t.id==e}).finished){r=!1;var t=u.DataMgr.TechConfig.find(function(t){return t.id==e});c.push(t.Name)}}),r?(l.default.Hide(),s.default.Instance.enterBuildMode(this.info)):d.default.PopupWith1Button("尚未研究所需科技",c.join(", "),"确定",null)}else d.default.PopupWith1Button("建筑材料不足","","确定",null)},__decorate([a(cc.Label)],t.prototype,"lblName",void 0),__decorate([a(cc.Label)],t.prototype,"lblSize",void 0),__decorate([a(cc.Node)],t.prototype,"sprSize",void 0),__decorate([a(cc.Label)],t.prototype,"lblConsumption",void 0),t=__decorate([r],t)}(cc.Component);o.default=i,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildPanel":"BuildPanel","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel"}],Building:[function(t,e,o){"use strict";cc._RF.push(e,"3d090TfsndH9pF8dNZnNchl","Building"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./ArkUI"),r=cc._decorator,a=r.ccclass,i=r.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t}return __extends(t,e),t.prototype.onClick=function(){n.default.Instance.selectBuilding(this)},t.prototype.setInfo=function(t,e){this.info=t,this.data=e,this.lblName&&(this.lblName.string=t.Name),this.node.setContentSize(100*t.length,100*t.width)},__decorate([i(cc.Label)],t.prototype,"lblName",void 0),t=__decorate([a],t)}(cc.Component);o.default=c,cc._RF.pop()},{"./ArkUI":"ArkUI"}],CvsMain:[function(t,e,o){"use strict";cc._RF.push(e,"69237yn4edJBK/5XvDAGlzX","CvsMain"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fitter=null,t.uiContainer=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).uiContainer.children.forEach(function(t){return t.active=!1})},t.EnterUI=function(e){this.Instance.uiContainer.children.forEach(function(t){t.getComponent(e)?t.active=!0:t.active=!1})},t.prototype.update=function(){var t=cc.view.getVisibleSize();this.lastVisibleSize&&t.equals(this.lastVisibleSize)||(t.width>=t.height?(this.fitter.rotation=0,this.fitter.scale=1,this.fitter.setContentSize(1080/t.height*t.width,1080)):(this.fitter.rotation=90,this.fitter.setContentSize(1080/t.width*t.height,1080),this.fitter.scale=t.width/1080),this.lastVisibleSize=t,console.log("fit"))},__decorate([a(cc.Node)],t.prototype,"fitter",void 0),__decorate([a(cc.Node)],t.prototype,"uiContainer",void 0),t=o=__decorate([r],t);var o}(cc.Component);o.default=i,cc._RF.pop()},{}],DataMgr:[function(t,e,o){"use strict";cc._RF.push(e,"c6c13KfXfRK06sYYQzi7BU0","DataMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){}return e.readData=function(){try{var t=JSON.parse(cc.sys.localStorage.getItem("user0"));e.myData=t,e.myBuildingData=JSON.parse(cc.sys.localStorage.getItem("user0Building")),e.myCargoData=JSON.parse(cc.sys.localStorage.getItem("user0Cargo")),e.myTechData=JSON.parse(cc.sys.localStorage.getItem("user0Tech")),e.currentWorkingTech=JSON.parse(cc.sys.localStorage.getItem("user0CurrentWorkingTech")),e.changed=!0,console.log("finish read data")}catch(t){console.error(t)}},e.writeData=function(){try{cc.sys.localStorage.setItem("user0",JSON.stringify(e.myData)),cc.sys.localStorage.setItem("user0Building",JSON.stringify(e.myBuildingData)),cc.sys.localStorage.setItem("user0Cargo",JSON.stringify(e.myCargoData)),cc.sys.localStorage.setItem("user0Tech",JSON.stringify(e.myTechData)),cc.sys.localStorage.setItem("user0CurrentWorkingTech",JSON.stringify(e.currentWorkingTech)),console.log("finish write data")}catch(t){console.error(t)}},e.clearData=function(){cc.sys.localStorage.removeItem("user0"),cc.sys.localStorage.removeItem("user0Building")},e.idleWorkers=0,e.populationLimit=0,e.othersData=[],e.changed=!1,e.populationGrowPerMin=0,e.researchRatePerMin=0,e.HumanConfig={},e}();o.DataMgr=n;var r=function(){this.population=0};o.UserData=r;var a=function(){};o.BuildingInfo=a;var i=function(){this.workers=0,this.isWorking=!1};o.BuildingData=i;var c=function(){};o.CargoInfo=c;var l=function(){};o.CargoData=l;var s=function(){};o.TechInfo=s;var u=function(){};o.TechData=u;var d=function(){function e(){this.i=0,this.j=0}return e.prototype.clone=function(){var t=new e;return t.i=this.i,t.j=this.j,t},Object.defineProperty(e,"ZERO",{get:function(){return new e},enumerable:!0,configurable:!0}),e}();o.IJ=d,cc._RF.pop()},{}],DialogPanel:[function(t,e,o){"use strict";cc._RF.push(e,"c0958fmSyFAp6wyHbHS0e10","DialogPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=n.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblTitle=null,t.lblContext=null,t.btn0=null,t.lblBtn0=null,t.btn1=null,t.lblBtn1=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).hide()},t.PopupWith1Button=function(t,e,o,n){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=o,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(0,0),this.Instance.btn1.active=!1},t.PopupWith2Buttons=function(t,e,o,n,r,a){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=o,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(-150,0),this.Instance.func1=a,this.Instance.lblBtn1.string=r,this.Instance.btn1.active=!0,this.Instance.btn1.position=new cc.Vec2(150,0)},t.prototype.onBtn0Click=function(){this.func0&&this.func0(),this.hide()},t.prototype.onBtn1Click=function(){this.func1&&this.func1(),this.hide()},t.prototype.show=function(){this.node.active=!0},t.prototype.hide=function(){this.node.active=!1},__decorate([a(cc.Label)],t.prototype,"lblTitle",void 0),__decorate([a(cc.Label)],t.prototype,"lblContext",void 0),__decorate([a(cc.Node)],t.prototype,"btn0",void 0),__decorate([a(cc.Label)],t.prototype,"lblBtn0",void 0),__decorate([a(cc.Node)],t.prototype,"btn1",void 0),__decorate([a(cc.Label)],t.prototype,"lblBtn1",void 0),t=o=__decorate([r],t);var o}(cc.Component);o.default=i,cc._RF.pop()},{}],Foregroud:[function(t,e,o){"use strict";cc._RF.push(e,"c7a1eqdirtJGpHjde8W3SsV","Foregroud"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.node.children.forEach(function(t){t.active||(t.active=!0,t.active=!1)})},e=__decorate([r],e)}(cc.Component));o.default=a,cc._RF.pop()},{}],HomeUI:[function(t,e,o){"use strict";cc._RF.push(e,"458fd6d6ChEGo+U+drv+haG","HomeUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./BaseUI"),a=t("./MainCtrl"),i=t("./DataMgr"),c=t("./WorldUI"),l=cc._decorator,s=l.ccclass,u=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnClaim0=null,t.btnClaim1=null,t.btnClaim2=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){o.Instance=this},t.prototype.start=function(){i.DataMgr.myData&&(i.DataMgr.myData.arkSize||(i.DataMgr.myData=null)),i.DataMgr.myData&&n.default.EnterUI(c.default)},t.prototype.onClaim=function(t,e){switch(e){case"0":i.DataMgr.myData=a.default.Instance.generateNewArk(9),this.enterGameWithArk()}i.DataMgr.myBuildingData=[]},t.prototype.enterGameWithArk=function(){i.DataMgr.myCargoData=[],i.DataMgr.CargoConfig.forEach(function(t){var e=new i.CargoData;e.id=t.id,e.amount=0,i.DataMgr.myCargoData.push(e)}),i.DataMgr.myTechData=[],i.DataMgr.TechConfig.forEach(function(t){var e=new i.TechData;e.id=t.id,e.filledWork=0,e.finished=!1,i.DataMgr.myTechData.push(e)}),n.default.EnterUI(c.default),console.log("pop",i.DataMgr.myData.population)},t.prototype.onBookClick=function(){console.log("哪有白皮书")},__decorate([u(cc.Button)],t.prototype,"btnClaim0",void 0),__decorate([u(cc.Button)],t.prototype,"btnClaim1",void 0),__decorate([u(cc.Button)],t.prototype,"btnClaim2",void 0),t=o=__decorate([s],t);var o}(r.default);o.default=d,cc._RF.pop()},{"./BaseUI":"BaseUI","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./MainCtrl":"MainCtrl","./WorldUI":"WorldUI"}],HouseBuilding:[function(t,e,o){"use strict";cc._RF.push(e,"4551bhwrptGmI96ad9hW5WZ","HouseBuilding"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Building"),r=cc._decorator,a=r.ccclass,i=r.property,c=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.lblPopulation=null,t}return __extends(t,o),t.prototype.setInfo=function(t,e){o.prototype.setInfo.call(this,t,e),this.lblPopulation.string=t.Arg0},__decorate([i(cc.Label)],t.prototype,"lblPopulation",void 0),t=__decorate([a],t)}(n.default);o.default=c,cc._RF.pop()},{"./Building":"Building"}],MainCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"162b9/mIe1LjqpHBpjQnzp+","MainCtrl"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./HomeUI"),h=t("./DataMgr"),a=cc._decorator,i=a.ccclass,c=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),(o=e).prototype.onLoad=function(){o.Instance=this,h.DataMgr.readData(),this.fetchRemoteData()},e.prototype.start=function(){n.default.EnterUI(r.default),console.log("goto home"),cc.loader.loadRes("Building",function(t,e){console.log("Building loaded",e),h.DataMgr.BuildingConfig=e}.bind(this)),cc.loader.loadRes("Cargo",function(t,e){console.log("Cargo loaded"),h.DataMgr.CargoConfig=e}.bind(this)),cc.loader.loadRes("Tech",function(t,e){console.log("Tech loaded",e),h.DataMgr.TechConfig=e}.bind(this))},e.prototype.gotoHome=function(){n.default.EnterUI(r.default)},e.prototype.generateNewArk=function(t){var e=new h.UserData;e.arkSize=t;var o=Math.random()*Math.PI;return e.arkLocationX=4e3*Math.cos(o),e.arkLocationY=4e3*Math.sin(o),e.speed=0,e.population=5,e.nickname="新玩家",e},e.prototype.fetchRemoteData=function(){var t=[],e=new h.UserData;e.arkSize=41,e.arkLocationX=0,e.arkLocationY=0,e.speed=0,e.population=2251,e.nickname="星云号交易所方舟",t.push(e),h.DataMgr.othersData=t,h.DataMgr.changed=!0},e.prototype.update=function(u){var d=this;if(h.DataMgr.myData){h.DataMgr.populationLimit=0;var p=h.DataMgr.researchRatePerMin=0;if(h.DataMgr.myBuildingData&&h.DataMgr.myBuildingData.forEach(function(n){if(n.isWorking=!1,p+=n.workers,d.isHouse(n.id)){var r=h.DataMgr.BuildingConfig.find(function(t){return t.id==n.id});h.DataMgr.populationLimit+=parseInt(r.Arg0)}else if("research239"==n.id){if(h.DataMgr.currentWorkingTech){var t=h.DataMgr.TechConfig.find(function(t){return t.id==h.DataMgr.currentWorkingTech}),e=h.DataMgr.myTechData.find(function(t){return t.id==h.DataMgr.currentWorkingTech}),o=Math.min(t.Work-e.filledWork,1*n.workers/60*u);e.filledWork+=o,e.filledWork>=t.Work&&(e.finished=!0,h.DataMgr.currentWorkingTech=null),h.DataMgr.researchRatePerMin+=1*n.workers}}else{if(n.workers<=0)return;r=h.DataMgr.BuildingConfig.find(function(t){return t.id==n.id});for(var a=[],i=0;i<4;i++){var c=r["Raw"+i];c&&0<c.length&&a.push([c,r["Raw"+i+"Rate"]/60*u*n.workers])}var l=!0;if(a.forEach(function(e){if(l){var t=h.DataMgr.myCargoData.find(function(t){return t.id==e[0]});t&&t.amount>e[1]?e.push(t):l=!1}}),l){a.forEach(function(t){t[2].amount-=t[1]});var s=function(t){var e=r["Out"+t];if(e&&0<e.length){var o=h.DataMgr.myCargoData.find(function(t){return t.id==e});o||((o=new h.CargoData).id=e,o.amount=0,h.DataMgr.myCargoData.push(o)),o.amount+=r["Out"+t+"Rate"]/60*u*n.workers}};for(i=0;i<4;i++)s(i);n.isWorking=!0}}}),h.DataMgr.idleWorkers=h.DataMgr.myData.population-p,h.DataMgr.myData&&h.DataMgr.myCargoData){var n=1*h.DataMgr.myData.population/60*u,t=n;if(h.DataMgr.CargoConfig.forEach(function(e){if("TRUE"==e.IsFood){var t=h.DataMgr.myCargoData.find(function(t){return t.id==e.id});if(t&&0<t.amount){var o=Math.min(n,t.amount);n-=o,t.amount-=o}}}),n<=0&&h.DataMgr.myData.population<h.DataMgr.populationLimit){var e=(10+Math.sqrt(h.DataMgr.myData.population))/10*300,o=e/60*u;Math.random()<o&&(h.DataMgr.myData.population+=1,h.DataMgr.idleWorkers+=1),h.DataMgr.populationGrowPerMin=e}else if(0<n){var r=n/t,a=Math.max(0,h.DataMgr.myData.population-10)*r;o=a/60*u;if(Math.random()<o)if(0<h.DataMgr.idleWorkers)h.DataMgr.myData.population-=1,h.DataMgr.idleWorkers-=1;else{var i=h.DataMgr.myBuildingData.filter(function(t){return 0<t.workers&&"fisher8032"!=t.id});if(0<i.length)i[Math.floor(Math.random()*i.length)].workers-=1,h.DataMgr.myData.population-=1}h.DataMgr.populationGrowPerMin=-a}else h.DataMgr.populationGrowPerMin=0}}},e.prototype.isHouse=function(t){return"dorm08821"==t||"house8523"==t},e=o=__decorate([i],e);var o}(cc.Component));o.default=c,cc._RF.pop()},{"./CvsMain":"CvsMain","./DataMgr":"DataMgr","./HomeUI":"HomeUI"}],Road:[function(t,e,o){"use strict";cc._RF.push(e,"57853rAZexG4pEfR+Uh0ALl","Road"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Building"),r=cc._decorator,a=r.ccclass,i=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([a],e)}(n.default));o.default=i,cc._RF.pop()},{"./Building":"Building"}],TaskMgr:[function(t,e,o){"use strict";cc._RF.push(e,"8b016C7S51BeY/RKmLSDzh4","TaskMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.list=[{description:"",func:function(){}}],t}();o.default=n,cc._RF.pop()},{}],TechButton:[function(t,e,o){"use strict";cc._RF.push(e,"381b4B+yDRNAIom8tWyu99R","TechButton"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./DataMgr"),r=cc._decorator,a=r.ccclass,i=r.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblWork=null,t.prgWork=null,t.gear=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(t,e){this.info=t,this.lblName.string=t.Name,this.lblWork.string=t.Work,this.data=e,this.prgWork.progress=e.filledWork/t.Work},t.prototype.update=function(t){this.prgWork.progress=this.data.filledWork/this.info.Work,n.DataMgr.currentWorkingTech==this.info.id?(this.gear.active=!0,this.gear.rotation+=36*n.DataMgr.researchRatePerMin*t):this.gear.active=!1},t.prototype.onClick=function(){n.DataMgr.currentWorkingTech!=this.info.id?n.DataMgr.currentWorkingTech=this.info.id:n.DataMgr.currentWorkingTech=null},__decorate([i(cc.Label)],t.prototype,"lblName",void 0),__decorate([i(cc.Label)],t.prototype,"lblWork",void 0),__decorate([i(cc.ProgressBar)],t.prototype,"prgWork",void 0),__decorate([i(cc.Node)],t.prototype,"gear",void 0),t=__decorate([a],t)}(cc.Component);o.default=c,cc._RF.pop()},{"./DataMgr":"DataMgr"}],TechPanel:[function(t,e,o){"use strict";cc._RF.push(e,"3402dUp2TBLFIsk2dVlT1d5","TechPanel"),Object.defineProperty(o,"__esModule",{value:!0});var a=t("./DataMgr"),i=t("./TechButton"),n=cc._decorator,r=n.ccclass,c=n.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonContainer=null,t.buttonTemplate=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.start=function(){var r=this;a.DataMgr.TechConfig.forEach(function(e){var t=cc.instantiate(r.buttonTemplate);t.parent=r.buttonContainer;var o=t.getComponent(i.default),n=a.DataMgr.myTechData.find(function(t){return t.id==e.id});o.setAndRefresh(e,n),t.active=!0}),this.buttonTemplate.active=!1},t.prototype.onEnable=function(){},t.prototype.refresh=function(){},t.Show=function(){o.Instance.node.active=!0},t.Hide=function(){o.Instance.node.active=!1},t.prototype.close=function(){this.node.active=!1},__decorate([c(cc.Node)],t.prototype,"buttonContainer",void 0),__decorate([c(cc.Node)],t.prototype,"buttonTemplate",void 0),t=o=__decorate([r],t);var o}(cc.Component);o.default=l,cc._RF.pop()},{"./DataMgr":"DataMgr","./TechButton":"TechButton"}],WorkshopBuilding:[function(t,e,o){"use strict";cc._RF.push(e,"2ffd4wRHIRBKbqpQioNYuQn","WorkshopBuilding"),Object.defineProperty(o,"__esModule",{value:!0});var c=t("./DataMgr"),n=t("./Building"),r=cc._decorator,a=r.ccclass,i=r.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblConsumption=null,t.lblOutput=null,t.lblWorkers=null,t.nodeGear=null,t.btnDecWork=null,t.btnIncWork=null,t}return __extends(t,e),t.prototype.setInfo=function(r,t){console.log("wb si"),this.info=r,this.data=t,this.lblName.string=r.Name;for(var a=[],e=function(t){var e=r["Raw"+t];if(e&&0<e.length){var o=r["Raw"+t+"Rate"],n=c.DataMgr.CargoConfig.find(function(t){return t.id==e});a.push("消耗 "+o+n.Name+"/min")}},o=0;o<4;o++)e(o);var n=function(t){var e=r["Out"+t];if(e&&0<e.length){var o=r["Out"+t+"Rate"],n=c.DataMgr.CargoConfig.find(function(t){return t.id==e});a.push("生产 "+o+n.Name+"/min")}};for(o=0;o<4;o++)n(o);if(0<a.length){var i=a[0];for(o=1;o<a.length;o++){i+="\n"+a[o]}this.lblConsumption.string=i}else this.lblConsumption.string="";this.node.setContentSize(100*r.length,100*r.width)},t.prototype.changeWorkers=function(t,e){if("-"==e){var o=Math.min(this.data.workers,1);this.data.workers-=o,c.DataMgr.idleWorkers+=o}else if("+"==e){var n=Math.min(c.DataMgr.idleWorkers,1,this.info.MaxHuman-this.data.workers);this.data.workers+=n,c.DataMgr.idleWorkers-=n}},t.prototype.update=function(t){this.lblWorkers.string="工人 "+this.data.workers.toFixed(),this.data.isWorking&&(this.nodeGear.rotation+=90*this.data.workers*t),this.btnDecWork.interactable=0<this.data.workers,this.btnIncWork.interactable=this.data.workers<this.info.MaxHuman},__decorate([i(cc.Label)],t.prototype,"lblConsumption",void 0),__decorate([i(cc.Label)],t.prototype,"lblOutput",void 0),__decorate([i(cc.Label)],t.prototype,"lblWorkers",void 0),__decorate([i(cc.Node)],t.prototype,"nodeGear",void 0),__decorate([i(cc.Button)],t.prototype,"btnDecWork",void 0),__decorate([i(cc.Button)],t.prototype,"btnIncWork",void 0),t=__decorate([a],t)}(n.default);o.default=l,cc._RF.pop()},{"./Building":"Building","./DataMgr":"DataMgr"}],WorldUI:[function(t,e,o){"use strict";cc._RF.push(e,"d2d4ehqPFVDS4fv9l1Oq7He","WorldUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./BaseUI"),a=t("./ArkUI"),i=t("./ArkInWorld"),c=t("./DataMgr"),l=cc._decorator,s=l.ccclass,u=l.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblEnergy=null,t.btnPause=null,t.ingameRange=null,t.arkContainer=null,t.arkTemplate=null,t.worldMap=null,t.earth=null,t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=.1,t}return __extends(t,e),(o=t).prototype.onLoad=function(){var e=o.Instance=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this)},t.prototype.start=function(){},t.prototype.onEnable=function(){this.refreshData(),this.refreshZoom()},t.prototype.refreshData=function(){for(var t=c.DataMgr.othersData.length+1,e=this.arkContainer.childrenCount;e<t;e++){cc.instantiate(this.arkTemplate).parent=this.arkContainer}var o=[];for(e=t;e<this.arkContainer.childrenCount;e++)o.push(this.arkContainer.children[e]);o.forEach(function(t){return t.destroy()}),this.arkContainer.children[0].getComponent(i.default).setAndRefresh(c.DataMgr.myData,this.zoomScale);for(e=0;e<c.DataMgr.othersData.length;e++){c.DataMgr.othersData[e];this.arkContainer.children[e+1].getComponent(i.default).setAndRefresh(c.DataMgr.othersData[e],this.zoomScale)}},t.prototype.refreshZoom=function(){var e=this,t=12e3*this.zoomScale;this.earth.setContentSize(t,t),this.arkContainer.children.forEach(function(t){t.getComponent(i.default).refreshZoom(e.zoomScale)})},t.prototype.update=function(t){c.DataMgr.changed&&(this.refreshData(),c.DataMgr.changed=!1);var e=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<e?((e-=5*t)<.5&&(e=.5),this.sldZoom.progress=e):e<.5&&(.5<(e+=5*t)&&(e=.5),this.sldZoom.progress=e)),.5!=e){var o=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(e-.5)*5*t),this.clampZoom();var n=this.zoomScale/o;this.worldMap.position=this.worldMap.position.mul(n),this.refreshZoom()}},t.prototype.onGotoArkClick=function(){n.default.EnterUI(a.default)},t.prototype.onCenterBtnClick=function(){var t=c.DataMgr.myData,e=new cc.Vec2(t.arkLocationX,t.arkLocationY);e.mulSelf(this.zoomScale),this.worldMap.position=e.neg()},t.prototype.onPanPadTouchMove=function(t){console.log("drag map");var e=t.getDelta();this.worldMap.position=this.worldMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),o=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/o;this.worldMap.position=this.worldMap.position.mul(n),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){10<this.zoomScale&&(this.zoomScale=10),this.zoomScale<.01&&(this.zoomScale=.01)},__decorate([u(cc.Label)],t.prototype,"lblEnergy",void 0),__decorate([u(cc.Button)],t.prototype,"btnPause",void 0),__decorate([u(cc.Node)],t.prototype,"ingameRange",void 0),__decorate([u(cc.Node)],t.prototype,"arkContainer",void 0),__decorate([u(cc.Node)],t.prototype,"arkTemplate",void 0),__decorate([u(cc.Node)],t.prototype,"worldMap",void 0),__decorate([u(cc.Node)],t.prototype,"earth",void 0),__decorate([u(cc.Node)],t.prototype,"panPad",void 0),__decorate([u(cc.Slider)],t.prototype,"sldZoom",void 0),t=o=__decorate([s],t);var o}(r.default);o.default=d,cc._RF.pop()},{"./ArkInWorld":"ArkInWorld","./ArkUI":"ArkUI","./BaseUI":"BaseUI","./CvsMain":"CvsMain","./DataMgr":"DataMgr"}]},{},["ArkInWorld","ArkUI","BaseUI","BuildPanel","Building","BuildingButton","CvsMain","DataMgr","DialogPanel","Foregroud","HomeUI","HouseBuilding","MainCtrl","Road","TaskMgr","TechButton","TechPanel","WorkshopBuilding","WorldUI"]);