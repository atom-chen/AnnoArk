require=function r(i,c,l){function s(e,t){if(!c[e]){if(!i[e]){var a="function"==typeof require&&require;if(!t&&a)return a(e,!0);if(d)return d(e,!0);var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}var n=c[e]={exports:{}};i[e][0].call(n.exports,function(t){return s(i[e][1][t]||t)},n,n.exports,r,i,c,l)}return c[e].exports}for(var d="function"==typeof require&&require,t=0;t<l.length;t++)s(l[t]);return s}({ArkInWorld:[function(t,e,a){"use strict";cc._RF.push(e,"dec21HFq/1BXrPvCkgOJBUs","ArkInWorld"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./DataMgr"),n=t("./WorldUI"),r=t("./UI/FlagMgr"),i=cc._decorator,c=i.ccclass,l=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprArk=null,t.sprFlag=null,t.lblName=null,t.grpInfo=null,t}return __extends(t,e),t.prototype.onLoad=function(){},t.prototype.setAndRefresh=function(t,e){this.data=t,this.sprArk.node.setContentSize(t.arkSize,t.arkSize),this.lblName.string=t.nickname,this.refreshZoom(e),r.FlagMgr.setFlag(this.sprFlag,t.country)},t.prototype.refreshZoom=function(t){this.node.position=new cc.Vec2(this.data.currentLocation.x,this.data.currentLocation.y).mul(t),this.grpInfo.opacity=.08<n.default.Instance.zoomScale||n.default.Instance.selectedObjectNode==this.node.parent||this.data==o.DataMgr.myData?255:0},t.prototype.update=function(t){this.refreshZoom(n.default.Instance.zoomScale)},t.prototype.onClick=function(){n.default.Instance.selectArk(this.node)},__decorate([l(cc.Sprite)],t.prototype,"sprArk",void 0),__decorate([l(cc.Sprite)],t.prototype,"sprFlag",void 0),__decorate([l(cc.Label)],t.prototype,"lblName",void 0),__decorate([l(cc.Node)],t.prototype,"grpInfo",void 0),t=__decorate([c],t)}(cc.Component);a.default=s,cc._RF.pop()},{"./DataMgr":"DataMgr","./UI/FlagMgr":"FlagMgr","./WorldUI":"WorldUI"}],ArkUI:[function(t,e,a){"use strict";cc._RF.push(e,"e7f42dM68VAz487nLcu3wTI","ArkUI"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./CvsMain"),n=t("./BaseUI"),i=t("./WorldUI"),d=t("./DataMgr"),c=t("./BuildPanel"),l=t("./Building"),s=t("./TechPanel"),u=t("./DialogPanel"),p=t("./UI/BuildingInfoPanel"),h=t("./Utils/CurrencyFormatter"),f=t("./BlockchainMgr"),r=cc._decorator,g=r.ccclass,m=r.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.arkMap=null,t.ark=null,t.cargoLabelContainer=null,t.cargoLabelTemplate=null,t.cargoLabels={},t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=1,t.workshopTemplate=null,t.houseTemplate=null,t.roadTemplate=null,t.buildingContainer=null,t.blueprint=null,t.blueprintIndicator=null,t.currentHoldingBlueprint=null,t.grpBuild=null,t.btnConfirmBuild=null,t.selectedBuilding=null,t.grpBuildingInfo=null,t}return __extends(t,e),(r=t).prototype.onLoad=function(){(r.Instance=this).node.active=!1;var e=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.panPad.on(cc.Node.EventType.TOUCH_END,this.deselectBuilding,this),this.cells=[];for(var t=-50;t<=50;t++){this.cells[t]=[];for(var a=-50;a<50;a++)this.cells[t][a]=new M}this.blueprint.on(cc.Node.EventType.TOUCH_MOVE,this.dragBlueprint.bind(this)),this.workshopTemplate.active=!1,this.roadTemplate.active=!1,this.houseTemplate.active=!1;var o=cc.instantiate(this.cargoLabelTemplate);o.parent=this.cargoLabelContainer;var n=o.getComponent(cc.Label);n.string="人口",this.cargoLabels.population=n},t.prototype.start=function(){var o=this;d.DataMgr.CargoConfig.forEach(function(t){var e=cc.instantiate(o.cargoLabelTemplate);e.parent=o.cargoLabelContainer;var a=e.getComponent(cc.Label);a.string=t.Name,o.cargoLabels[t.id]=a}),this.cargoLabelTemplate.active=!1},t.prototype.onEnable=function(){var a=this;this.refreshZoom();var t=d.DataMgr.myData;console.log("size",t.arkSize);for(var e=-Math.floor(t.arkSize/2);e<t.arkSize/2;e++)for(var o=-Math.floor(t.arkSize/2);o<t.arkSize/2;o++){var n=this.cells[e][o];n.isLand=!0,n.building=null}this.buildingContainer.destroyAllChildren();var r=0;d.DataMgr.myBuildingData.forEach(function(e){var t=d.DataMgr.BuildingConfig.find(function(t){return t.id==e.id});console.log("precreatebuilding",e),a.createBuilding(t,e),r+=e.workers}),d.DataMgr.idleWorkers=t.population-r,this.deselectBuilding()},t.prototype.refreshZoom=function(){this.arkMap.scale=this.zoomScale},t.prototype.update=function(t){d.DataMgr.changed&&(this.refreshData(),d.DataMgr.changed=!1),this.updateCheckExpand(),this.cargoLabels.population.string="人口 "+d.DataMgr.myData.population+"/"+d.DataMgr.populationLimit+" (闲置 "+d.DataMgr.idleWorkers+") 增长"+d.DataMgr.populationGrowPerMin.toFixed(0)+"/min";for(var e=function(t){var e=d.DataMgr.CargoConfig[t],a=d.DataMgr.myCargoData.find(function(t){return t.id==e.id}),o=d.DataMgr.outputRates[e.id];o||(o=0);var n=e.Name+"   "+Math.floor(a?a.amount:0).toFixed()+"("+(0<o?"+":"")+o.toFixed()+")";"fish34509"==e.id&&a.amount<=0&&o<0&&(n+=" 食物短缺"),r.cargoLabels[e.id].string=n},r=this,a=0;a<d.DataMgr.CargoConfig.length;a++)e(a);var o=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<o?((o-=5*t)<.5&&(o=.5),this.sldZoom.progress=o):o<.5&&(.5<(o+=5*t)&&(o=.5),this.sldZoom.progress=o)),.5!=o){var n=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(o-.5)*5*t),this.clampZoom();var i=this.zoomScale/n;this.arkMap.position=this.arkMap.position.mul(i),this.refreshZoom()}if(this.currentHoldingBlueprint){this.blueprint.active=!0,this.blueprint.position=new cc.Vec2(100*this.currentBlueprintIJ.i-50,100*this.currentBlueprintIJ.j-50),this.blueprint.setContentSize(100*this.currentHoldingBlueprint.Length,100*this.currentHoldingBlueprint.Width);var c=!0;this.blueprintIndicator.clear();for(a=0;a<this.currentHoldingBlueprint.Length;a++)for(var l=0;l<this.currentHoldingBlueprint.Width;l++){var s=this.cells[this.currentBlueprintIJ.i+a][this.currentBlueprintIJ.j+l];this.blueprintIndicator.fillColor=s.building?cc.Color.RED:s.isLand?cc.Color.GREEN:cc.Color.RED,s.building&&(c=!1),s.isLand||(c=!1),this.blueprintIndicator.fillRect(100*a,100*l,100,100)}this.grpBuild.active=!0,this.btnConfirmBuild.interactable=c}else this.blueprint.active=!1,this.grpBuild.active=!1;this.selectedBuilding?this.grpBuildingInfo.active=!0:this.grpBuildingInfo.active=!1,this.ark.setContentSize(100*d.DataMgr.myData.arkSize,100*d.DataMgr.myData.arkSize)},t.prototype.refreshData=function(){},t.prototype.onGotoWorldClick=function(){this.deselectBuilding(),o.default.EnterUI(i.default)},t.prototype.onBuildBtnClick=function(){this.deselectBuilding(),c.default.Show(),s.default.Hide()},t.prototype.onTechClick=function(){this.deselectBuilding(),d.DataMgr.myBuildingData.find(function(t){return"research239"==t.id})||u.default.PopupWith1Button("没有研究院","建造研究院并指派工作人员进行研究","确定",null),s.default.Show(),c.default.Hide()},t.prototype.onCenterBtnClick=function(){var t=d.DataMgr.myData,e=new cc.Vec2(t.currentLocation.x,t.currentLocation.y);e.mulSelf(this.zoomScale),this.arkMap.position=e.neg()},t.prototype.onPanPadTouchMove=function(t){var e=t.getDelta();this.arkMap.position=this.arkMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),a=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var o=this.zoomScale/a;this.arkMap.position=this.arkMap.position.mul(o),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){3<this.zoomScale&&(this.zoomScale=3),this.zoomScale<.3&&(this.zoomScale=.3)},t.prototype.enterBuildMode=function(t){this.currentHoldingBlueprint=t,this.currentBlueprintIJ=d.IJ.ZERO},t.prototype.dragBlueprint=function(t){var e=t.getLocation(),a=this.arkMap.convertToNodeSpaceAR(e);this.currentBlueprintIJ.i=Math.round(a.x/100),this.currentBlueprintIJ.j=Math.round(a.y/100)},t.prototype.onBtnConfirmBuildClick=function(){for(var t=!0,e=0;e<this.currentHoldingBlueprint.Length;e++)for(var a=0;a<this.currentHoldingBlueprint.Width;a++){var o=this.cells[this.currentBlueprintIJ.i+e][this.currentBlueprintIJ.j+a];o.building&&(t=!1),o.isLand||(t=!1)}if(t){var n=[];for(e=0;e<4;e++){var r=this.currentHoldingBlueprint["BuildMat"+e];if(r&&0<r.length){var i=this.currentHoldingBlueprint["BuildMat"+e+"Count"];n.push([r,i])}}var c=!0;if(n.forEach(function(e){d.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount<e[1]&&(c=!1)}),c){n.forEach(function(e){d.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount-=e[1]});var l=new d.BuildingData;l.id=this.currentHoldingBlueprint.id,l.ij=this.currentBlueprintIJ.clone(),l.workers=0,d.DataMgr.myBuildingData.push(l),this.createBuilding(this.currentHoldingBlueprint,l),"road00001"==this.currentHoldingBlueprint.id?this.currentBlueprintIJ.j+=1:this.currentHoldingBlueprint=null}}},t.prototype.onBtnCancelBuildClick=function(){this.currentHoldingBlueprint=null},t.prototype.createBuilding=function(t,e){var a=t.prefab,o=cc.instantiate(this[a+"Template"]);o.parent=this.buildingContainer;var n=o.getComponent(l.default);n.setInfo(t,e),o.position=new cc.Vec2(100*e.ij.i-50,100*e.ij.j-50),o.active=!0;for(var r=0;r<t.Length;r++)for(var i=0;i<t.Width;i++){this.cells[e.ij.i+r][e.ij.j+i].building=n}},t.prototype.selectBuilding=function(t){console.log("选中建筑"),this.selectedBuilding=t},t.prototype.deselectBuilding=function(){this.selectedBuilding=null},t.prototype.onDemolishBtnClick=function(){var t=r.Instance;this.selectedBuilding&&u.default.PopupWith2Buttons("确定拆除建筑吗",t.selectedBuilding.info.Name+"\n建筑材料不予返还","取消",null,"拆除",function(){t.demolishBuilding(t.selectedBuilding),t.deselectBuilding()})},t.prototype.demolishBuilding=function(e){if(e){console.log("拆除建筑");var t=d.DataMgr.myBuildingData.findIndex(function(t){return t==e.data});if(0<=t){var a=e.data.workers;d.DataMgr.myBuildingData.splice(t,1),d.DataMgr.idleWorkers+=a;var o=d.DataMgr.BuildingConfig.find(function(t){return t.id==e.data.id});console.log("info.Length",o.Length);for(var n=0;n<o.Length;n++)for(var r=0;r<o.Width;r++)console.log("cells",e.data.ij.i+n,e.data.ij.j+r),this.cells[e.data.ij.i+n][e.data.ij.j+r].building=null;e.node.destroy()}}},t.prototype.onBuildingInfoBtnClick=function(){this.selectedBuilding&&(p.default.Show(this.selectedBuilding.info),this.deselectBuilding())},t.prototype.onBtnExpandClick=function(){if(d.DataMgr.myData.arkSize<=d.DataMgr.SmallArkSize)u.default.PopupWith1Button("简陋方舟无法扩建","您的方舟是简陋方舟，没有扩建功能。\n想要功能完整的方舟？请回到主界面领取标准方舟或大型方舟。需要安装星云钱包哦！","知道了",null);else{for(var t=null,e=0;e<d.DataMgr.RechargeToArkSize.length;e++){var a=d.DataMgr.RechargeToArkSize[e];if(d.DataMgr.myData.rechargeOnExpand/1e18<a[0]){t=a;break}}if(t){var o=t[0]-d.DataMgr.myData.rechargeOnExpand/1e18,n=t[1];u.default.PopupWith2Buttons("扩建方舟","支付 "+h.default.formatNAS(o)+"NAS 扩建方舟到 "+n+"×"+n+" 吗","取消",null,"支付",function(){f.default.Instance.expandArk(o)})}else u.default.PopupWith1Button("方舟已经最大","非常感谢您的支持！区块链首款SLG必将越做越好！","支持！！！",null)}},t.prototype.updateCheckExpand=function(){var t=d.DataMgr.GetArkSizeByRecharge(d.DataMgr.myData.rechargeOnExpand/1e18);if(this.lastTickArkSize!=t){console.log("检测到方舟成功扩建了",this.lastTickArkSize,t),this.lastTickArkSize=t;var e=d.DataMgr.myData;e.arkSize=t;for(var a=-Math.floor(e.arkSize/2);a<e.arkSize/2;a++)for(var o=-Math.floor(e.arkSize/2);o<e.arkSize/2;o++){this.cells[a][o].isLand=!0}}},__decorate([m(cc.Node)],t.prototype,"arkMap",void 0),__decorate([m(cc.Node)],t.prototype,"ark",void 0),__decorate([m(cc.Node)],t.prototype,"cargoLabelContainer",void 0),__decorate([m(cc.Node)],t.prototype,"cargoLabelTemplate",void 0),__decorate([m(cc.Node)],t.prototype,"panPad",void 0),__decorate([m(cc.Slider)],t.prototype,"sldZoom",void 0),__decorate([m(cc.Node)],t.prototype,"workshopTemplate",void 0),__decorate([m(cc.Node)],t.prototype,"houseTemplate",void 0),__decorate([m(cc.Node)],t.prototype,"roadTemplate",void 0),__decorate([m(cc.Node)],t.prototype,"buildingContainer",void 0),__decorate([m(cc.Node)],t.prototype,"blueprint",void 0),__decorate([m(cc.Graphics)],t.prototype,"blueprintIndicator",void 0),__decorate([m(cc.Node)],t.prototype,"grpBuild",void 0),__decorate([m(cc.Button)],t.prototype,"btnConfirmBuild",void 0),__decorate([m(cc.Node)],t.prototype,"grpBuildingInfo",void 0),t=r=__decorate([g],t);var r}(n.default);a.default=y;var M=function(){this.isLand=!1,this.building=null};cc._RF.pop()},{"./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./BuildPanel":"BuildPanel","./Building":"Building","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./TechPanel":"TechPanel","./UI/BuildingInfoPanel":"BuildingInfoPanel","./Utils/CurrencyFormatter":"CurrencyFormatter","./WorldUI":"WorldUI"}],AsyncLoadSprite:[function(t,e,a){"use strict";cc._RF.push(e,"39cbcBA8NhMbplhvYeYYTtc","AsyncLoadSprite"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=o.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.delay=0,t.path="",t}return __extends(t,e),t.prototype.start=function(){setTimeout(this.loadSprite.bind(this),1e3*this.delay)},t.prototype.loadSprite=function(){try{var o=this;cc.loader.loadRes(o.path,cc.SpriteFrame,function(t,e){if(!t){var a=o.node.getComponent(cc.Sprite);a&&(a.spriteFrame=e)}})}catch(t){console.error(t)}},__decorate([r(cc.Float)],t.prototype,"delay",void 0),__decorate([r(cc.String)],t.prototype,"path",void 0),t=__decorate([n],t)}(cc.Component);a.default=i,cc._RF.pop()},{}],AttackIslandPanel:[function(t,e,a){"use strict";cc._RF.push(e,"820acbSeDlEZbUkJ5dGpgYt","AttackIslandPanel"),Object.defineProperty(a,"__esModule",{value:!0});var i=t("../DataMgr"),c=t("../BlockchainMgr"),l=t("../DialogPanel"),o=cc._decorator,n=o.ccclass,r=o.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblOccupant=null,t.lblDefTank=null,t.lblDefChopper=null,t.lblDefShip=null,t.lblAtkTankMax=null,t.lblAtkChopperMax=null,t.lblAtkShipMax=null,t.edtAtkTank=null,t.edtAtkChopper=null,t.edtAtkShip=null,t.SldAtkTank=null,t.SldAtkChopper=null,t.SldAtkShip=null,t.lblDistance=null,t.lblMethane=null,t.lblConfirmButton=null,t.tankMax=0,t.chopperMax=0,t.shipMax=0,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1},t.prototype.setAndRefresh=function(e){this.island=e;var t=i.DataMgr.myData.address==e.data.occupant,a=t?i.DataMgr.myData:i.DataMgr.othersData.find(function(t){return t.address==e.data.occupant});this.lblOccupant.string=a?a.nickname:e.data.occupant,this.lblConfirmButton.string=t?"追加":"进攻";var o=(Number(new Date)-e.data.lastBattleTime)/36e5,n=Math.exp(-.05*o);this.lblDefTank.string=(e.data.tankPower*n).toFixed(),this.lblDefChopper.string=(e.data.chopperPower*n).toFixed(),this.lblDefShip.string=(e.data.shipPower*n).toFixed(),this.SldAtkTank.progress=0,this.SldAtkChopper.progress=0,this.SldAtkShip.progress=0,this.onSliderChange(null,"Tank"),this.onSliderChange(null,"Chopper"),this.onSliderChange(null,"Ship"),this.refreshMethaneCost()},t.prototype.onSliderChange=function(t,e){switch(e){case"Tank":this.edtAtkTank.string=(this.SldAtkTank.progress*this.tankMax).toFixed();break;case"Chopper":this.edtAtkChopper.string=(this.SldAtkChopper.progress*this.chopperMax).toFixed();break;case"Ship":this.edtAtkShip.string=(this.SldAtkShip.progress*this.shipMax).toFixed()}this.refreshMethaneCost()},t.prototype.onEditBoxChange=function(t,e){switch(e){case"Tank":var a=parseInt(this.edtAtkTank.string);a=Math.max(0,Math.min(this.tankMax,a)),this.edtAtkTank.string=a.toFixed(),this.SldAtkTank.progress=a/this.tankMax;break;case"Chopper":a=parseInt(this.edtAtkChopper.string),a=Math.max(0,Math.min(this.chopperMax,a)),this.edtAtkChopper.string=a.toFixed(),this.SldAtkChopper.progress=a/this.chopperMax;break;case"Ship":a=parseInt(this.edtAtkShip.string),a=Math.max(0,Math.min(this.shipMax,a)),this.edtAtkShip.string=a.toFixed(),this.SldAtkShip.progress=a/this.shipMax}this.refreshMethaneCost()},t.prototype.update=function(t){this.tankMax=Math.floor(i.DataMgr.myCargoData.find(function(t){return"tank23532"==t.id}).amount),this.lblAtkTankMax.string="/"+this.tankMax.toFixed(),this.chopperMax=Math.floor(i.DataMgr.myCargoData.find(function(t){return"chopper424"==t.id}).amount),this.lblAtkChopperMax.string="/"+this.chopperMax.toFixed(),this.shipMax=Math.floor(i.DataMgr.myCargoData.find(function(t){return"ship40342"==t.id}).amount),this.lblAtkShipMax.string="/"+this.shipMax.toFixed()},t.prototype.refreshMethaneCost=function(){var t=this.island.node.position.sub(new cc.Vec2(i.DataMgr.myData.currentLocation.x,i.DataMgr.myData.currentLocation.y)).mag(),e=i.DataMgr.getMethaneCostOfAttack(t,Math.round(this.SldAtkTank.progress*this.tankMax),Math.round(this.SldAtkChopper.progress*this.chopperMax),Math.round(this.SldAtkShip.progress*this.shipMax)),a=i.DataMgr.myCargoData.find(function(t){return"methane74"==t.id}).amount;this.lblDistance.string=t.toFixed()+"km",this.lblMethane.string=e.toFixed()+"/"+a.toFixed()},t.prototype.onConfirmClick=function(){console.log("准备攻占资源岛",this.island);var t=this.island.node.position.sub(new cc.Vec2(i.DataMgr.myData.currentLocation.x,i.DataMgr.myData.currentLocation.y)).mag(),e=i.DataMgr.getMethaneCostOfAttack(t,Math.round(this.SldAtkTank.progress*this.tankMax),Math.round(this.SldAtkChopper.progress*this.chopperMax),Math.round(this.SldAtkShip.progress*this.shipMax)),a=i.DataMgr.myCargoData.find(function(t){return"methane74"==t.id});if(e<=a.amount){var o=Math.round(this.SldAtkTank.progress*this.tankMax),n=Math.round(this.SldAtkChopper.progress*this.chopperMax),r=Math.round(this.SldAtkShip.progress*this.shipMax);c.default.Instance.attackIsland(this.island.data.id,o,n,r,function(){try{a.amount=Math.max(0,a.amount-e),i.DataMgr.myCargoData.find(function(t){return"tank23532"==t.id}).amount-=o,i.DataMgr.myCargoData.find(function(t){return"chopper424"==t.id}).amount-=n,i.DataMgr.myCargoData.find(function(t){return"ship40342"==t.id}).amount-=r}catch(t){}})}else l.default.PopupWith1Button("燃料不足","将方舟靠近目标，减少派兵数量，或者生产更多甲烷吧","确定",null)},t.prototype.close=function(){this.node.active=!1},__decorate([r(cc.Label)],t.prototype,"lblOccupant",void 0),__decorate([r(cc.Label)],t.prototype,"lblDefTank",void 0),__decorate([r(cc.Label)],t.prototype,"lblDefChopper",void 0),__decorate([r(cc.Label)],t.prototype,"lblDefShip",void 0),__decorate([r(cc.Label)],t.prototype,"lblAtkTankMax",void 0),__decorate([r(cc.Label)],t.prototype,"lblAtkChopperMax",void 0),__decorate([r(cc.Label)],t.prototype,"lblAtkShipMax",void 0),__decorate([r(cc.EditBox)],t.prototype,"edtAtkTank",void 0),__decorate([r(cc.EditBox)],t.prototype,"edtAtkChopper",void 0),__decorate([r(cc.EditBox)],t.prototype,"edtAtkShip",void 0),__decorate([r(cc.Slider)],t.prototype,"SldAtkTank",void 0),__decorate([r(cc.Slider)],t.prototype,"SldAtkChopper",void 0),__decorate([r(cc.Slider)],t.prototype,"SldAtkShip",void 0),__decorate([r(cc.Label)],t.prototype,"lblDistance",void 0),__decorate([r(cc.Label)],t.prototype,"lblMethane",void 0),__decorate([r(cc.Label)],t.prototype,"lblConfirmButton",void 0),t=a=__decorate([n],t);var a}(cc.Component);a.default=s,cc._RF.pop()},{"../BlockchainMgr":"BlockchainMgr","../DataMgr":"DataMgr","../DialogPanel":"DialogPanel"}],BaseUI:[function(t,e,a){"use strict";cc._RF.push(e,"3b934a4EjZFs6JzaRDhWpVf","BaseUI"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([n],e)}(cc.Component));a.default=r,cc._RF.pop()},{}],BlockchainMgr:[function(t,e,d){"use strict";cc._RF.push(e,"3ffefed5pBCD40DXf/kM6bs","BlockchainMgr"),Object.defineProperty(d,"__esModule",{value:!0});var n=t("./DataMgr"),u=t("./DialogPanel"),r=t("./WorldUI"),a=t("./UI/ToastPanel"),i=t("./ArkUI"),c=t("./CvsMain"),l=t("./HomeUI"),o=t("./UI/AttackIslandPanel"),s=cc._decorator,p=s.ccclass;s.property;d.ContractAddress="n1jiTBXSNGvuYK6vB4JFz95C4bhATQoJwBm",d.EncKey=37234;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.checkWalletCountdown=1e9,t.fetchAllDataCountdown=1e9,t}return __extends(t,e),(s=t).prototype.onLoad=function(){s.Instance=this},t.prototype.start=function(){this.checkWalletCountdown=1,this.fetchAllDataCountdown=1},t.prototype.update=function(t){try{Neb,NebPay}catch(t){return}if(this.checkWalletCountdown-=t,this.fetchAllDataCountdown-=t,this.checkWalletCountdown<=0){try{var e=this;(a=new Neb).setRequest(new HttpRequest(s.BlockchainUrl)),a.api.getNebState().then(function(t){window.addEventListener("message",e.onGetWalletData),window.postMessage({target:"contentscript",data:{},method:"getAccount"},"*")})}catch(t){console.error(t)}this.checkWalletCountdown=s.CheckWalletInterval}if(this.fetchAllDataCountdown<=0){var a;(a=new Neb).setRequest(new HttpRequest(s.BlockchainUrl));var o=s.WalletAddress?s.WalletAddress:Account.NewAccount().getAddressString(),n={function:"get_map_info",args:"[]"};a.api.call(o,d.ContractAddress,"0","0","1000000","2000000",n).then(this.onGetAllMapData).catch(function(t){console.log("call get_map_info error:"+t.message)}),this.fetchAllDataCountdown=s.FetchAllDataInterval}},t.prototype.onGetWalletData=function(t){if(t.data&&t.data.data&&t.data.data.account&&0<t.data.data.account.length){var e=t.data.data.account;if(s.WalletAddress!=e){console.log("Change wallet address:",e),s.WalletAddress=e,this.fetchAllDataCountdown=0;try{n.DataMgr.myData&&n.DataMgr.myData.address!=e&&(r.default.Instance.node.active||i.default.Instance.node.active)&&c.default.EnterUI(l.default)}catch(t){console.error(t)}}}},t.prototype.onGetAllMapData=function(t){console.log("onGetAllMapData",t);var e=JSON.parse(t.result).result_data,a=e.ark_info,o=e.island_info;n.DataMgr.othersData=[],a.forEach(function(t){t.address==s.WalletAddress?(n.DataMgr.myData||(n.DataMgr.myData=new n.UserData),n.DataMgr.myData.nickname||(n.DataMgr.myData.nickname=t.nickname),n.DataMgr.myData.address!=t.address&&(r.default.Instance.node.active||i.default.Instance.node.active)&&c.default.EnterUI(l.default),n.DataMgr.myData.address=t.address,n.DataMgr.myData.country||(n.DataMgr.myData.country=t.country),n.DataMgr.myData.speed=t.speed,n.DataMgr.myData.locationX=t.locationX,n.DataMgr.myData.locationY=t.locationY,n.DataMgr.myData.lastLocationTime=t.lastLocationTime,n.DataMgr.myData.destinationX=t.destinationX,n.DataMgr.myData.destinationY=t.destinationY,n.DataMgr.myData.rechargeOnExpand=t.rechargeOnExpand,n.DataMgr.myData.arkSize=n.DataMgr.GetArkSizeByRecharge(t.rechargeOnExpand/1e18),n.DataMgr.writeData()):(n.DataMgr.othersData[t.address]=t,n.DataMgr.othersData[t.address].currentLocation=new cc.Vec2(t.locationX,t.locationY))}),o.forEach(function(t){var e=n.DataMgr.allIslandData[t.id];if(e)for(var a in t)e[a]=t[a];else console.error("从区块链获取到未知id的island:",t)})},t.prototype.claimArk=function(t){if(window.webExtensionWallet)try{var e=l.default.Instance.lblNickname.string,a=l.default.Instance.country,o=new NebPay,n=s.BlockchainUrl,r=d.ContractAddress;console.log("调用钱包claim_ark(",e);var i='["'+e+'","'+a+'"]';o.call(r,t,"claim_ark",i,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:n,listener:this.claimArkCallback})}catch(t){console.error(t)}else u.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.claimArkCallback=function(t){console.log("claimArkCallback: ",t),"Error"!=t.toString().substr(0,5)?u.default.PopupWith2Buttons("方舟正在组装，请等候30秒","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):a.default.Toast("交易失败:"+t)},t.prototype.setSail=function(t,e){if(window.webExtensionWallet)try{var a=new NebPay,o=s.BlockchainUrl,n=d.ContractAddress;console.log("调用钱包update_ark",t);var r='["'+encodeURIComponent(JSON.stringify(t))+'"]';a.call(n,0,"update_ark",r,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:o,listener:this.setSailCallback(e)})}catch(t){console.error(t)}else u.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.setSailCallback=function(e){return function(t){console.log("setSailCallback: ",e,t),"Error"!=t.toString().substr(0,5)?(u.default.PopupWith2Buttons("方舟引擎开始预热，预计1分钟内出发","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null),r.default.Instance.editSailDestinationMode=!1,e&&e()):a.default.Toast("交易失败:"+t)}},t.prototype.expandArk=function(t){if(window.webExtensionWallet)try{var e=new NebPay,a=s.BlockchainUrl,o=d.ContractAddress,n=Math.ceil(1e6*t)/1e6;console.log("调用钱包recharge_expand(valueNas",t,"value",n),e.call(o,n,"recharge_expand",null,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:a,listener:this.expandArkCallback})}catch(t){console.error(t)}else u.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.expandArkCallback=function(t){console.log("expandArkCallback: ",t),"Error"!=t.toString().substr(0,5)?u.default.PopupWith2Buttons("扩建计划已启动，请稍候","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):a.default.Toast("交易失败:"+t)},t.prototype.attackIsland=function(t,e,a,o,n){if(window.webExtensionWallet)try{var r=new NebPay,i=s.BlockchainUrl,c=d.ContractAddress;console.log("调用钱包attack_island(",t,e,a,o);var l=JSON.stringify([t,e,a,o]);r.call(c,0,"attack_island",l,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:i,listener:this.attackIslandCallback(n)})}catch(t){console.error(t)}else u.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.attackIslandCallback=function(e){return function(t){console.log("attackIslandCallback: ",e,t),"Error"!=t.toString().substr(0,5)?(o.default.Instance.close(),u.default.PopupWith2Buttons("您的部队已出发","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null),r.default.Instance.editSailDestinationMode=!1,e&&e()):u.default.PopupWith1Button("区块链交易失败",t,"确定",null)}},t.prototype.collectIslandMoney=function(t){if(window.webExtensionWallet)try{var e=new NebPay,a=s.BlockchainUrl,o=d.ContractAddress;console.log("调用钱包collect_island_money(",t);var n=JSON.stringify([t]);e.call(o,0,"collect_island_money",n,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:a,listener:this.collectIslandMoneyCallback})}catch(t){console.error(t)}else u.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.collectIslandMoneyCallback=function(t){console.log("collectIslandMoneyCallback: ",t),"Error"!=t.toString().substr(0,5)?(o.default.Instance.close(),u.default.PopupWith2Buttons("正在收取资源","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null)):u.default.PopupWith1Button("区块链交易失败",t,"确定",null)},t.prototype.sponsor=function(t,e,a,o){if(window.webExtensionWallet)try{var n=new NebPay,r=s.BlockchainUrl,i=d.ContractAddress,c=Math.ceil(1e6*o)/1e6;console.log("调用钱包sponsor(",t,e,a,o);var l=JSON.stringify([t,e,a]);n.call(i,c,"sponsor",l,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:r,listener:this.sponsorCallback})}catch(t){console.error(t)}else u.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.sponsorCallback=function(t){console.log("sponsorCallback: ",t),"Error"!=t.toString().substr(0,5)?u.default.PopupWith2Buttons("感谢您的赞助","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):a.default.Toast("交易失败:"+t)},t.encrypto=function(t,e,a){if("string"==typeof t&&"number"==typeof e&&"number"==typeof a){var o=[];a=a<=25?a:a%25;for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);r=(r=1*r^e).toString(a),o.push(r)}var i=String.fromCharCode(a+97);return o.join(i)}},t.BlockchainUrl="https://mainnet.nebulas.io",t.CheckWalletInterval=10,t.FetchAllDataInterval=10,t=s=__decorate([p],t);var s}(cc.Component);d.default=h,cc._RF.pop()},{"./ArkUI":"ArkUI","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./HomeUI":"HomeUI","./UI/AttackIslandPanel":"AttackIslandPanel","./UI/ToastPanel":"ToastPanel","./WorldUI":"WorldUI"}],BuildPanel:[function(t,e,a){"use strict";cc._RF.push(e,"5cf0290QotGfpJodxaDGNKp","BuildPanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./DataMgr"),n=t("./BuildingButton"),r=t("./ArkUI"),i=cc._decorator,c=i.ccclass,l=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonContainer=null,t.buttonTemplate=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1},t.prototype.start=function(){var a=this;o.DataMgr.BuildingConfig.forEach(function(t){var e=cc.instantiate(a.buttonTemplate);e.parent=a.buttonContainer,e.getComponent(n.default).setAndRefresh(t),e.active=!0}),this.buttonTemplate.active=!1},t.prototype.onEnable=function(){},t.prototype.refresh=function(){},t.Show=function(){a.Instance.node.active=!0},t.Hide=function(){a.Instance.node.active=!1},t.prototype.onBtnExpandClick=function(){r.default.Instance.onBtnExpandClick()},t.prototype.close=function(){this.node.active=!1},__decorate([l(cc.Node)],t.prototype,"buttonContainer",void 0),__decorate([l(cc.Node)],t.prototype,"buttonTemplate",void 0),t=a=__decorate([c],t);var a}(cc.Component);a.default=s,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildingButton":"BuildingButton","./DataMgr":"DataMgr"}],BuildingButton:[function(t,e,a){"use strict";cc._RF.push(e,"7884bIsfolMCKOoH+GiGik+","BuildingButton"),Object.defineProperty(a,"__esModule",{value:!0});var l=t("./BuildPanel"),s=t("./ArkUI"),d=t("./DataMgr"),u=t("./DialogPanel"),o=t("./UI/BuildingInfoPanel"),n=cc._decorator,r=n.ccclass,i=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblSize=null,t.sprSize=null,t.lblConsumption=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(n){this.info=n,this.lblName.string=n.Name,this.lblSize.string=n.Length+"*"+n.Width,this.sprSize.setContentSize(12*n.Length,12*n.Width);for(var r=[],t=function(t){var e=n["BuildMat"+t];if(e&&0<e.length){var a=n["BuildMat"+t+"Count"],o=d.DataMgr.CargoConfig.find(function(t){return t.id==e});r.push(o.Name+"*"+a)}},e=0;e<4;e++)t(e);if(0<r.length){var a=r[0];for(e=1;e<r.length;e++){a+="\n"+r[e]}this.lblConsumption.string=a}else this.lblConsumption.string=""},t.prototype.onClick=function(){o.default.Show(this.info)},t.prototype.onBuildClick=function(){for(var t=[],e=0;e<4;e++){var a=this.info["BuildMat"+e];if(a&&0<a.length){var o=this.info["BuildMat"+e+"Count"];t.push([a,o])}}var n=!0;if(t.forEach(function(e){d.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount<e[1]&&(n=!1)}),n){var r=[];for(e=0;e<4;e++){var i=this.info["NeedTech"+e];i&&0<i.length&&r.push(i)}n=!0;var c=[];r.forEach(function(e){if(!d.DataMgr.myTechData.find(function(t){return t.id==e}).finished){n=!1;var t=d.DataMgr.TechConfig.find(function(t){return t.id==e});c.push(t.Name)}}),n?(l.default.Hide(),s.default.Instance.enterBuildMode(this.info)):u.default.PopupWith1Button("尚未研究所需科技",c.join(", "),"确定",null)}else u.default.PopupWith1Button("建筑材料不足","","确定",null)},__decorate([i(cc.Label)],t.prototype,"lblName",void 0),__decorate([i(cc.Label)],t.prototype,"lblSize",void 0),__decorate([i(cc.Node)],t.prototype,"sprSize",void 0),__decorate([i(cc.Label)],t.prototype,"lblConsumption",void 0),t=__decorate([r],t)}(cc.Component);a.default=c,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildPanel":"BuildPanel","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./UI/BuildingInfoPanel":"BuildingInfoPanel"}],BuildingInfoPanel:[function(t,e,a){"use strict";cc._RF.push(e,"3a0f2BiXhFBZ7J7uLjk6n4I","BuildingInfoPanel"),Object.defineProperty(a,"__esModule",{value:!0});var i=t("../DataMgr"),o=cc._decorator,n=o.ccclass,r=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblBuildingMat=null,t.lblHuman=null,t.lblRaw=null,t.lblOut=null,t.sprPic=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1},t.prototype.refresh=function(n){this.lblName.string=n.Name;for(var r=[],t=function(t){var e=n["BuildMat"+t];if(e&&0<e.length){var a=n["BuildMat"+t+"Count"],o=i.DataMgr.CargoConfig.find(function(t){return t.id==e});r.push(o.Name+"*"+a)}},e=0;e<4;e++)t(e);this.lblBuildingMat.string=r.join("\n"),this.lblHuman.string=n.MaxHuman,r=[];var a=function(t){var e=n["Raw"+t];if(e&&0<e.length){var a=n["Raw"+t+"Rate"],o=i.DataMgr.CargoConfig.find(function(t){return t.id==e});r.push(o.Name+"*"+a)}};for(e=0;e<4;e++)a(e);this.lblRaw.string=r.join("\n"),r=[];var o=function(t){var e=n["Out"+t];if(e&&0<e.length){var a=n["Out"+t+"Rate"],o=i.DataMgr.CargoConfig.find(function(t){return t.id==e});r.push(o.Name+"*"+a)}};for(e=0;e<4;e++)o(e);this.lblOut.string=r.join("\n")},t.Show=function(e){var t;t="string"==typeof e?i.DataMgr.BuildingConfig.find(function(t){return t.id==e}):e,a.Instance.node.active=!0,a.Instance.refresh(t)},t.prototype.close=function(){this.node.active=!1},__decorate([r(cc.Label)],t.prototype,"lblName",void 0),__decorate([r(cc.Label)],t.prototype,"lblBuildingMat",void 0),__decorate([r(cc.Label)],t.prototype,"lblHuman",void 0),__decorate([r(cc.Label)],t.prototype,"lblRaw",void 0),__decorate([r(cc.Label)],t.prototype,"lblOut",void 0),__decorate([r(cc.Sprite)],t.prototype,"sprPic",void 0),t=a=__decorate([n],t);var a}(cc.Component);a.default=c,cc._RF.pop()},{"../DataMgr":"DataMgr"}],Building:[function(t,e,a){"use strict";cc._RF.push(e,"3d090TfsndH9pF8dNZnNchl","Building"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./ArkUI"),n=cc._decorator,r=n.ccclass,i=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t}return __extends(t,e),t.prototype.onClick=function(){o.default.Instance.selectBuilding(this)},t.prototype.setInfo=function(t,e){this.info=t,this.data=e,this.lblName&&(this.lblName.string=t.Name),this.node.setContentSize(100*t.Length,100*t.Width)},__decorate([i(cc.Label)],t.prototype,"lblName",void 0),t=__decorate([r],t)}(cc.Component);a.default=c,cc._RF.pop()},{"./ArkUI":"ArkUI"}],CurrencyFormatter:[function(t,e,a){"use strict";cc._RF.push(e,"4455937OnBAOLdRb9e7YASo","CurrencyFormatter"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=(o.property,function(){function t(){}return t.formatBTC=function(t){if(Math.abs(t)<1e-7)return"0";var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.max(0,5-e))},t.formatNAS=function(t){var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.min(3,Math.max(0,4-e)))},t.formatCNY=function(t){if(Math.abs(t)<.005)return"0";var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.min(2,Math.max(0,4-e)))},t=__decorate([n],t)}());a.default=r,cc._RF.pop()},{}],CvsMain:[function(t,e,a){"use strict";cc._RF.push(e,"69237yn4edJBK/5XvDAGlzX","CvsMain"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=o.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fitter=null,t.uiContainer=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).uiContainer.children.forEach(function(t){return t.active=!0})},t.EnterUI=function(e){this.Instance.uiContainer.children.forEach(function(t){t.getComponent(e)?t.active=!0:t.active=!1})},t.prototype.update=function(){var t=cc.view.getVisibleSize();this.lastVisibleSize&&t.equals(this.lastVisibleSize)||(t.width>=t.height?(this.fitter.rotation=0,this.fitter.scale=1,this.fitter.setContentSize(1080/t.height*t.width,1080)):(this.fitter.rotation=90,this.fitter.setContentSize(1080/t.width*t.height,1080),this.fitter.scale=t.width/1080),this.lastVisibleSize=t)},__decorate([r(cc.Node)],t.prototype,"fitter",void 0),__decorate([r(cc.Node)],t.prototype,"uiContainer",void 0),t=a=__decorate([n],t);var a}(cc.Component);a.default=i,cc._RF.pop()},{}],DataMgr:[function(t,e,a){"use strict";cc._RF.push(e,"c6c13KfXfRK06sYYQzi7BU0","DataMgr"),Object.defineProperty(a,"__esModule",{value:!0});var o=function(){function e(){}return e.getArkSpeedByTech=function(t){return t?500:200},e.GetArkSizeByRecharge=function(t){for(var e=this.RechargeToArkSize.length-1;0<=e;e--)if(t>=this.RechargeToArkSize[e][0])return this.RechargeToArkSize[e][1]},e.getMethaneCostOfAttack=function(t,e,a,o){return.01*t*(e+a+o)},e.calcCurrentMoneyInIsland=function(t){var e=t.occupant&&0<t.occupant.length;return t.money*(e?Math.exp(-t.miningRate*(Number(new Date)-t.lastMineTime)/36e5):1)},e.readData=function(){try{var t=JSON.parse(cc.sys.localStorage.getItem("user0"));e.myData=t,e.myBuildingData=JSON.parse(cc.sys.localStorage.getItem("user0Building")),e.myCargoData=JSON.parse(cc.sys.localStorage.getItem("user0Cargo")),e.myTechData=JSON.parse(cc.sys.localStorage.getItem("user0Tech")),e.currentWorkingTech=JSON.parse(cc.sys.localStorage.getItem("user0CurrentWorkingTech")),e.changed=!0,console.log("finish read data",t)}catch(t){console.error(t)}},e.writeData=function(){try{e.myData&&(cc.sys.localStorage.setItem("user0",JSON.stringify(e.myData)),cc.sys.localStorage.setItem("user0Building",JSON.stringify(e.myBuildingData)),cc.sys.localStorage.setItem("user0Cargo",JSON.stringify(e.myCargoData)),cc.sys.localStorage.setItem("user0Tech",JSON.stringify(e.myTechData)),cc.sys.localStorage.setItem("user0CurrentWorkingTech",JSON.stringify(e.currentWorkingTech)),this.autosaveCountdown+=15,console.log("finish write data",e.myData,e.myBuildingData))}catch(t){console.error(t)}},e.clearData=function(){cc.sys.localStorage.removeItem("user0"),cc.sys.localStorage.removeItem("user0Building")},e.idleWorkers=0,e.populationLimit=0,e.aboveIronMine=!1,e.othersData={},e.allIslandData={},e.changed=!1,e.populationGrowPerMin=0,e.researchRatePerMin=0,e.outputRates={},e.SmallArkSize=7,e.StdArkSize=9,e.LargeArkSize=21,e.MethaneCostPerKmPerSize=.005,e.RechargeToArkSize=[[0,9],[.001,13],[.006,17],[.01,21],[.1,25],[1,30],[4,35]],e.autosaveCountdown=15,e}();a.DataMgr=o;var n=function(){this.currentLocation=cc.Vec2.ZERO,this.population=8,this.speed=0};a.UserData=n;var r=function(){};a.BuildingInfo=r;var i=function(){this.workers=0,this.isWorking=!1};a.BuildingData=i;var c=function(){};a.CargoInfo=c;var l=function(){this.amount=0};a.CargoData=l;var s=function(){};a.TechInfo=s;var d=function(){};a.TechData=d;var u=function(){};a.MineInfo=u;var p=function(){this.tankPower=0,this.chopperPower=0,this.shipPower=0,this.money=0,this.sponsorName="",this.miningRate=.02,this.balanceMap=0};a.IslandData=p;var h=function(){function e(){this.i=0,this.j=0}return e.prototype.clone=function(){var t=new e;return t.i=this.i,t.j=this.j,t},Object.defineProperty(e,"ZERO",{get:function(){return new e},enumerable:!0,configurable:!0}),e}();a.IJ=h,cc._RF.pop()},{}],DialogPanel:[function(t,e,a){"use strict";cc._RF.push(e,"c0958fmSyFAp6wyHbHS0e10","DialogPanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=o.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblTitle=null,t.lblContext=null,t.btn0=null,t.lblBtn0=null,t.btn1=null,t.lblBtn1=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).hide()},t.PopupWithOKButton=function(t,e){a.PopupWith1Button(t,e,"确定",null)},t.PopupWith1Button=function(t,e,a,o){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=o,this.Instance.lblBtn0.string=a,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(0,0),this.Instance.btn1.active=!1},t.PopupWith2Buttons=function(t,e,a,o,n,r){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=o,this.Instance.lblBtn0.string=a,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(-150,0),this.Instance.func1=r,this.Instance.lblBtn1.string=n,this.Instance.btn1.active=!0,this.Instance.btn1.position=new cc.Vec2(150,0)},t.prototype.onBtn0Click=function(){this.func0&&this.func0(),this.hide()},t.prototype.onBtn1Click=function(){this.func1&&this.func1(),this.hide()},t.prototype.show=function(){this.node.active=!0},t.prototype.hide=function(){this.node.active=!1},__decorate([r(cc.Label)],t.prototype,"lblTitle",void 0),__decorate([r(cc.Label)],t.prototype,"lblContext",void 0),__decorate([r(cc.Node)],t.prototype,"btn0",void 0),__decorate([r(cc.Label)],t.prototype,"lblBtn0",void 0),__decorate([r(cc.Node)],t.prototype,"btn1",void 0),__decorate([r(cc.Label)],t.prototype,"lblBtn1",void 0),t=a=__decorate([n],t);var a}(cc.Component);a.default=i,cc._RF.pop()},{}],EditNicknamePanel:[function(t,e,a){"use strict";cc._RF.push(e,"abc4c7by+pEG49b6MBNEz6Y","EditNicknamePanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../DataMgr"),n=t("./ToastPanel"),r=t("../HomeUI"),i=t("./FlagMgr"),c=cc._decorator,l=c.ccclass,s=c.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edtNickname=null,t.flagContainer=null,t.flagTemplate=null,t.selectFrame=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1,this.init()},t.prototype.init=function(){var o=this;this.flagTemplate.active=!0,i.FlagMgr.flagNames.forEach(function(t){var e=cc.instantiate(o.flagTemplate);e.name=t,e.parent=o.flagContainer;var a=e.getComponent(cc.Sprite);i.FlagMgr.setFlag(a,t),e.on(cc.Node.EventType.TOUCH_END,function(){return o.onFlagClick(e)})}),this.flagTemplate.active=!1},t.prototype.onEnable=function(){var e=this;this.edtNickname.string=o.DataMgr.myData?o.DataMgr.myData.nickname:r.default.Instance.lblNickname.string,this.selectedCountry=r.default.Instance.country?r.default.Instance.country:o.DataMgr.myData?o.DataMgr.myData.country:null;var t=this.flagContainer.children.find(function(t){return t.name==e.selectedCountry});t?(this.selectFrame.active=!0,this.selectFrame.position=this.selectFrame.parent.convertToNodeSpaceAR(this.flagContainer.convertToWorldSpaceAR(t.position))):this.selectFrame.active=!1},t.prototype.onFlagClick=function(t){this.selectFrame.active=!0,this.selectFrame.position=this.selectFrame.parent.convertToNodeSpaceAR(this.flagContainer.convertToWorldSpaceAR(t.position)),this.selectedCountry=t.name},t.prototype.onConfirmClick=function(){o.DataMgr.myData&&(o.DataMgr.myData.nickname=this.edtNickname.string,o.DataMgr.myData.country=this.selectedCountry),r.default.Instance.lblNickname.string=this.edtNickname.string,r.default.Instance.country=this.selectedCountry,n.default.Toast("昵称、国家设置成功"),this.close()},t.prototype.close=function(){this.node.active=!1},__decorate([s(cc.EditBox)],t.prototype,"edtNickname",void 0),__decorate([s(cc.Node)],t.prototype,"flagContainer",void 0),__decorate([s(cc.Node)],t.prototype,"flagTemplate",void 0),__decorate([s(cc.Node)],t.prototype,"selectFrame",void 0),t=a=__decorate([l],t);var a}(cc.Component);a.default=d,cc._RF.pop()},{"../DataMgr":"DataMgr","../HomeUI":"HomeUI","./FlagMgr":"FlagMgr","./ToastPanel":"ToastPanel"}],FlagMgr:[function(t,e,a){"use strict";cc._RF.push(e,"25e0fkSAGlFqq0SWMH7sg7L","FlagMgr"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=(o.property,function(){function t(){}return(o=t).setFlag=function(a,e){try{o.flagNames.find(function(t){return t==e})?cc.loader.loadRes("flags/"+e,cc.SpriteFrame,function(t,e){t||(a.spriteFrame=e)}):a.spriteFrame=null}catch(t){console.error(t),a.spriteFrame=null}},t.flagNames=["cn","us","jp","kr","eng","ru","de","at","au","be","bg","br","ch","cl","co","cr","cs","dk","es","fr","gh","hr","ir","is","it","kp","ma","mx","ng","nir","nl","pa","pe","pl","pt","py","sa","sco","se","sk","sn","tn","uy","wal"],t=o=__decorate([n],t);var o}());a.FlagMgr=r,cc._RF.pop()},{}],Foreground:[function(t,e,a){"use strict";cc._RF.push(e,"c7a1eqdirtJGpHjde8W3SsV","Foreground"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.node.children.forEach(function(t){t.active||(t.active=!0,t.active=!1)})},e=__decorate([n],e)}(cc.Component));a.default=r,cc._RF.pop()},{}],HomeUI:[function(t,e,a){"use strict";cc._RF.push(e,"458fd6d6ChEGo+U+drv+haG","HomeUI"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./CvsMain"),n=t("./BaseUI"),r=t("./MainCtrl"),i=t("./DataMgr"),c=t("./WorldUI"),l=t("./UI/ToastPanel"),s=t("./BlockchainMgr"),d=t("./UI/EditNicknamePanel"),u=t("./UI/FlagMgr"),p=cc._decorator,h=p.ccclass,f=p.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblTotalArkCount=null,t.btnClaim0=null,t.btnClaim1=null,t.btnClaim2=null,t.lblNickname=null,t.sprFlag=null,t.lblMusicButton=null,t.lblBlockchainAddress=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1},t.prototype.start=function(){l.default.Toast("正在读取您的钱包信息，如果您在用钱包玩游戏，请稍候"),this.lblMusicButton.string=0<r.default.Instance.getComponent(cc.AudioSource).volume?"音乐：开":"音乐：关"},t.prototype.update=function(){this.lblBlockchainAddress.string=s.default.WalletAddress?s.default.WalletAddress:"未获取到钱包地址",i.DataMgr.myData?(this.btnClaim0.getComponentInChildren(cc.Label).string=i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize?"进入":"无法领取",this.btnClaim1.getComponentInChildren(cc.Label).string=i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize?"领取":i.DataMgr.myData.arkSize<i.DataMgr.LargeArkSize?"进入":"无法领取",this.btnClaim2.getComponentInChildren(cc.Label).string=i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize?"领取":i.DataMgr.myData.arkSize<i.DataMgr.LargeArkSize?"无法领取":"进入",this.btnClaim0.interactable=i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize,this.btnClaim1.interactable=i.DataMgr.myData.arkSize<i.DataMgr.LargeArkSize,this.btnClaim2.interactable=i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize||i.DataMgr.myData.arkSize>=i.DataMgr.LargeArkSize,i.DataMgr.myData.nickname&&(this.lblNickname.string=i.DataMgr.myData.nickname),i.DataMgr.myData.country&&(this.country=i.DataMgr.myData.country)):(this.btnClaim0.getComponentInChildren(cc.Label).string="领取",this.btnClaim1.getComponentInChildren(cc.Label).string="领取",this.btnClaim2.getComponentInChildren(cc.Label).string="领取");r.default.Ticks%50==0&&u.FlagMgr.setFlag(this.sprFlag,this.country),r.default.Ticks%100==0&&(this.lblTotalArkCount.string=(Object.keys(i.DataMgr.othersData).length+1).toFixed())},t.prototype.onClaim=function(t,e){if(!this.lblNickname.string||!this.country)return d.default.Instance.node.active=!0,void l.default.Toast("请先设置国旗和昵称");if(i.DataMgr.myData)switch(e){case"0":i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize&&o.default.EnterUI(c.default);break;case"1":i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize?s.default.Instance.claimArk(0):i.DataMgr.myData.arkSize<i.DataMgr.LargeArkSize&&o.default.EnterUI(c.default);break;case"2":i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize?s.default.Instance.claimArk(.01):i.DataMgr.myData.arkSize>=i.DataMgr.LargeArkSize&&o.default.EnterUI(c.default)}else switch(e){case"0":i.DataMgr.myData=r.default.Instance.generateSmallArkData(),l.default.Toast("领取成功，可进入方舟");break;case"1":s.default.Instance.claimArk(0);break;case"2":s.default.Instance.claimArk(.01)}},t.prototype.onBtnEditNicknameClick=function(){d.default.Instance.node.active=!0},t.prototype.onBtnSponsorClick=function(){},t.prototype.onAddressClick=function(){window.open("https://explorer.nebulas.io/address/"+s.default.WalletAddress)},t.prototype.onBookClick=function(){console.log("哪有白皮书")},t.prototype.onBtnClearStorageClick=function(){cc.sys.localStorage.clear(),setTimeout(function(){return location.reload()},100),console.log("成功清除存储")},t.prototype.onBtnSwitchMusicClick=function(){var t=r.default.Instance.getComponent(cc.AudioSource);t.volume=0<t.volume?0:.25,this.lblMusicButton.string=0<t.volume?"音乐：开":"音乐：关"},t.prototype.onTestCheat0Click=function(){i.DataMgr.myCargoData.forEach(function(t){return t.amount=1e6})},__decorate([f(cc.Label)],t.prototype,"lblTotalArkCount",void 0),__decorate([f(cc.Button)],t.prototype,"btnClaim0",void 0),__decorate([f(cc.Button)],t.prototype,"btnClaim1",void 0),__decorate([f(cc.Button)],t.prototype,"btnClaim2",void 0),__decorate([f(cc.Label)],t.prototype,"lblNickname",void 0),__decorate([f(cc.Sprite)],t.prototype,"sprFlag",void 0),__decorate([f(cc.Label)],t.prototype,"lblMusicButton",void 0),__decorate([f(cc.Label)],t.prototype,"lblBlockchainAddress",void 0),t=a=__decorate([h],t);var a}(n.default);a.default=g,cc._RF.pop()},{"./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./MainCtrl":"MainCtrl","./UI/EditNicknamePanel":"EditNicknamePanel","./UI/FlagMgr":"FlagMgr","./UI/ToastPanel":"ToastPanel","./WorldUI":"WorldUI"}],HouseBuilding:[function(t,e,a){"use strict";cc._RF.push(e,"4551bhwrptGmI96ad9hW5WZ","HouseBuilding"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./Building"),n=cc._decorator,r=n.ccclass,i=n.property,c=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.lblPopulation=null,t}return __extends(t,a),t.prototype.setInfo=function(t,e){a.prototype.setInfo.call(this,t,e),this.lblPopulation.string=t.Arg0},__decorate([i(cc.Label)],t.prototype,"lblPopulation",void 0),t=__decorate([r],t)}(o.default);a.default=c,cc._RF.pop()},{"./Building":"Building"}],IntroUI:[function(t,e,a){"use strict";cc._RF.push(e,"09076VctrZEVKhEeIiQ5hEn","IntroUI"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../CvsMain"),n=t("../HomeUI"),r=cc._decorator,i=r.ccclass,c=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onBtnStartClick=function(){o.default.EnterUI(n.default)},e=__decorate([i],e)}(cc.Component));a.default=c,cc._RF.pop()},{"../CvsMain":"CvsMain","../HomeUI":"HomeUI"}],IronMine:[function(t,e,a){"use strict";cc._RF.push(e,"ff0cb7j7qpO/Yov9EsIMZAo","IronMine"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){if(this.gra=this.getComponent(cc.Graphics),this.col=this.getComponent(cc.PolygonCollider),3<=this.col.points.length&&this.gra){this.gra.moveTo(this.col.points[0].x,this.col.points[0].y);for(var t=1;t<this.col.points.length;t++){var e=this.col.points[t];this.gra.lineTo(e.x,e.y)}this.gra.close(),this.gra.fill()}},e=__decorate([n],e)}(cc.Component));a.default=r,cc._RF.pop()},{}],IslandInfoFrame:[function(t,e,a){"use strict";cc._RF.push(e,"c2894Vc0LZARZptbw433jyZ","IslandInfoFrame"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("../DataMgr"),r=t("../Utils/CurrencyFormatter"),o=t("../WorldUI"),i=cc._decorator,c=i.ccclass,l=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblLeftMoney=null,t.lblMiningSpeed=null,t.lblOccupant=null,t.grpTitle=null,t.grpMore=null,t}return __extends(t,e),t.prototype.refresh=function(t){if(t){this.lblName.string=t.sponsorName;var e=n.DataMgr.calcCurrentMoneyInIsland(t);this.lblLeftMoney.string=r.default.formatNAS(e/1e18)+"NAS";var a=t.miningRate*e/1e18;if(this.lblMiningSpeed.string=r.default.formatNAS(a)+"NAS/小时",t.occupant&&0<t.occupant.length){var o=t.occupant==n.DataMgr.myData.address?n.DataMgr.myData:n.DataMgr.othersData[t.occupant];this.lblOccupant.string=o?o.nickname:t.occupant}else this.lblOccupant.string="(无)"}},t.prototype.refreshAsZoomScale=function(){this.grpMore.opacity=.18<o.default.Instance.zoomScale||o.default.Instance.selectedObjectNode==this.node.parent?255:0,this.grpTitle.opacity=.08<o.default.Instance.zoomScale||o.default.Instance.selectedObjectNode==this.node.parent?255:0},__decorate([l(cc.Label)],t.prototype,"lblName",void 0),__decorate([l(cc.Label)],t.prototype,"lblLeftMoney",void 0),__decorate([l(cc.Label)],t.prototype,"lblMiningSpeed",void 0),__decorate([l(cc.Label)],t.prototype,"lblOccupant",void 0),__decorate([l(cc.Node)],t.prototype,"grpTitle",void 0),__decorate([l(cc.Node)],t.prototype,"grpMore",void 0),t=__decorate([c],t)}(cc.Component);a.default=s,cc._RF.pop()},{"../DataMgr":"DataMgr","../Utils/CurrencyFormatter":"CurrencyFormatter","../WorldUI":"WorldUI"}],Island:[function(t,e,a){"use strict";cc._RF.push(e,"d5cb37wYS9LEY2kNMygFSvm","Island"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../MainCtrl"),n=t("../WorldUI"),r=cc._decorator,i=r.ccclass,c=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.btnNode=new cc.Node,this.btnNode.parent=this.node,this.btnNode.on(cc.Node.EventType.TOUCH_END,this.onClick.bind(this))},e.prototype.setData=function(t){this.data=t},e.prototype.update=function(){o.default.Ticks%60==0&&(this.infoFrame&&this.infoFrame.refresh(this.data),this.btnNode.setContentSize(this.node.width+5,this.node.height+5)),this.node.position=this.data.location.mul(n.default.Instance.zoomScale),this.infoFrame.refreshAsZoomScale()},e.prototype.onLinkClick=function(){var t=this.data.sponsorLink;t&&0<t.length&&window.open(t)},e.prototype.onClick=function(){n.default.Instance.selectIsland(this.node)},e=__decorate([i],e)}(cc.Component));a.default=c,cc._RF.pop()},{"../MainCtrl":"MainCtrl","../WorldUI":"WorldUI"}],MainCtrl:[function(t,e,a){"use strict";cc._RF.push(e,"162b9/mIe1LjqpHBpjQnzp+","MainCtrl"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./CvsMain"),n=t("./HomeUI"),f=t("./DataMgr"),r=t("./WorldUI"),i=t("./UI/IntroUI"),c=t("./World/Island"),g=t("./UI/ToastPanel"),l=cc._decorator,d=l.ccclass,s=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),(s=e).prototype.onLoad=function(){s.Instance=this,f.DataMgr.readData(),o.default.Instance.uiContainer.getChildByName("WorldUI").active=!0,cc.loader.loadRes("Building",function(t,e){console.log("Building loaded",e),f.DataMgr.BuildingConfig=e,f.DataMgr.myBuildingData||(f.DataMgr.myBuildingData=[])}.bind(this)),cc.loader.loadRes("Cargo",function(t,e){console.log("Cargo loaded",e,f.DataMgr.myCargoData),f.DataMgr.CargoConfig=e,f.DataMgr.myCargoData||(f.DataMgr.myCargoData=[],f.DataMgr.CargoConfig.forEach(function(t){var e=new f.CargoData;e.id=t.id,e.amount=0,f.DataMgr.myCargoData.push(e)}))}.bind(this)),cc.loader.loadRes("Tech",function(t,e){console.log("Tech loaded",e,f.DataMgr.myTechData),f.DataMgr.TechConfig=e,f.DataMgr.myTechData||(f.DataMgr.myTechData=[],f.DataMgr.TechConfig.forEach(function(t){var e=new f.TechData;e.id=t.id,e.filledWork=0,e.finished=!1,f.DataMgr.myTechData.push(e)}))}.bind(this))},e.prototype.start=function(){o.default.EnterUI(i.default),f.DataMgr.IronMineConfig=[],r.default.Instance.mineContainer.children.forEach(function(t){var e=t.getComponent(cc.PolygonCollider);if(e){var a=new f.MineInfo;a.polygonCollider=e;var o=[];e.points.forEach(function(t){o.push(e.node.position.add(e.offset).add(t))}),a.points=o,f.DataMgr.IronMineConfig.push(a)}}),r.default.Instance.islandContainer.children.forEach(function(t){var e=t.getComponent(c.default),a=new f.IslandData;a.id=parseInt(e.name),a.location=e.node.position,f.DataMgr.allIslandData[a.id]=a,e.setData(a)});var t=this.node.getComponent(cc.AudioSource);setTimeout(function(){t.play()},1e3)},e.prototype.gotoHome=function(){o.default.EnterUI(n.default)},e.prototype.generateSmallArkData=function(){var t=new f.UserData;t.arkSize=f.DataMgr.SmallArkSize;var e=Math.random()*Math.PI;return t.locationX=4e3*Math.cos(e),t.locationY=4e3*Math.sin(e),t.speed=0,t.nickname=n.default.Instance.lblNickname.string,t.country=n.default.Instance.country,this.calcSail(t),t},e.prototype.update=function(u){var p=this;if(f.DataMgr.BuildingConfig&&f.DataMgr.TechConfig&&f.DataMgr.CargoConfig){if(f.DataMgr.myData){f.DataMgr.populationLimit=0,f.DataMgr.researchRatePerMin=0,f.DataMgr.aboveIronMine=!1,f.DataMgr.outputRates={};var h=0;for(var t in this.calcSail(f.DataMgr.myData),f.DataMgr.othersData)this.calcSail(f.DataMgr.othersData[t]);if(f.DataMgr.IronMineConfig.forEach(function(t){cc.Intersection.pointInPolygon(f.DataMgr.myData.currentLocation,t.points)&&(f.DataMgr.aboveIronMine=!0)}),f.DataMgr.myBuildingData&&f.DataMgr.myBuildingData.forEach(function(n){if(n.isWorking=!1,h+=n.workers,p.isHouse(n.id)){var r=f.DataMgr.BuildingConfig.find(function(t){return t.id==n.id});f.DataMgr.populationLimit+=parseInt(r.Arg0)}else if("research239"==n.id){if(f.DataMgr.currentWorkingTech){r=f.DataMgr.BuildingConfig.find(function(t){return t.id==n.id});var t=f.DataMgr.TechConfig.find(function(t){return t.id==f.DataMgr.currentWorkingTech}),e=f.DataMgr.myTechData.find(function(t){return t.id==f.DataMgr.currentWorkingTech}),a=Math.min(t.Work-e.filledWork,n.workers/r.MaxHuman*10/60*u);e.filledWork+=a,e.filledWork>=t.Work&&(e.finished=!0,f.DataMgr.currentWorkingTech=null,g.default.Toast("新科技研究完成，请制定下一个研究计划")),f.DataMgr.researchRatePerMin+=1*n.workers}}else{if(n.workers<=0)return;r=f.DataMgr.BuildingConfig.find(function(t){return t.id==n.id});for(var o=[],i=0;i<4;i++){var c=r["Raw"+i];if(c&&0<c.length){var l=r["Raw"+i+"Rate"]/r.MaxHuman*n.workers;o.push([c,l/60*u]),f.DataMgr.outputRates[c]||(f.DataMgr.outputRates[c]=0),f.DataMgr.outputRates[c]-=l}}var s=!0;if(o.forEach(function(e){if(s){var t=f.DataMgr.myCargoData.find(function(t){return t.id==e[0]});t&&t.amount>e[1]?e.push(t):s=!1}}),s){o.forEach(function(t){t[2].amount-=t[1]});var d=function(t){var e=r["Out"+t];if(e&&0<e.length){var a=f.DataMgr.myCargoData.find(function(t){return t.id==e});a||((a=new f.CargoData).id=e,a.amount=0,f.DataMgr.myCargoData.push(a));var o=r["Out"+t+"Rate"]/r.MaxHuman*n.workers;a.amount+=o/60*u,f.DataMgr.outputRates[e]||(f.DataMgr.outputRates[e]=0),f.DataMgr.outputRates[e]+=o}};for(i=0;i<4;i++)d(i);n.isWorking=!0}}}),f.DataMgr.idleWorkers=f.DataMgr.myData.population-h,f.DataMgr.myData&&f.DataMgr.myCargoData){var e=1*f.DataMgr.myData.population,o=e/60*u;f.DataMgr.outputRates.fish34509||(f.DataMgr.outputRates.fish34509=0),f.DataMgr.outputRates.fish34509-=e;var a=o;if(f.DataMgr.CargoConfig.forEach(function(e){if("TRUE"==e.IsFood){var t=f.DataMgr.myCargoData.find(function(t){return t.id==e.id});if(t&&0<t.amount){var a=Math.min(o,t.amount);o-=a,t.amount-=a}}}),o<=0&&f.DataMgr.myData.population<f.DataMgr.populationLimit){var n=(10+Math.sqrt(f.DataMgr.myData.population))/10*30,r=n/60*u;Math.random()<r&&(f.DataMgr.myData.population+=1,f.DataMgr.idleWorkers+=1),f.DataMgr.populationGrowPerMin=n}else if(0<o){var i=o/a,c=Math.max(0,f.DataMgr.myData.population-10)*i;r=c/60*u;if(Math.random()<r)if(0<f.DataMgr.idleWorkers)f.DataMgr.myData.population-=1,f.DataMgr.idleWorkers-=1;else{var l=f.DataMgr.myBuildingData.filter(function(t){return 0<t.workers&&"fisher8032"!=t.id});if(0<l.length)l[Math.floor(Math.random()*l.length)].workers-=1,f.DataMgr.myData.population-=1}f.DataMgr.populationGrowPerMin=-c}else f.DataMgr.populationGrowPerMin=0}f.DataMgr.autosaveCountdown<=0&&f.DataMgr.writeData()}f.DataMgr.autosaveCountdown-=u,s.Ticks++}},e.prototype.calcSail=function(t){if(t.speed&&0<t.speed&&t.destinationX&&t.destinationY){var e=t.lastLocationTime,a=Number(new Date),o=new cc.Vec2(t.locationX,t.locationY),n=new cc.Vec2(t.destinationX,t.destinationY),r=n.sub(o).mag()/(t.speed/60)*1e3,i=s.lerpVec2(o,n,(a-e)/r,!0);t.currentLocation=i}else t.currentLocation=new cc.Vec2(t.locationX,t.locationY)},e.lerp=function(t,e,a,o){return o&&(a=Math.max(0,Math.min(1,a))),t*(1-a)+e*a},e.lerpVec2=function(t,e,a,o){return o&&(a=Math.max(0,Math.min(1,a))),t.mul(1-a).add(e.mul(a))},e.prototype.isHouse=function(t){return"dorm08821"==t||"house8523"==t},e.Ticks=0,e=s=__decorate([d],e);var s}(cc.Component));a.default=s,cc._RF.pop()},{"./CvsMain":"CvsMain","./DataMgr":"DataMgr","./HomeUI":"HomeUI","./UI/IntroUI":"IntroUI","./UI/ToastPanel":"ToastPanel","./World/Island":"Island","./WorldUI":"WorldUI"}],Road:[function(t,e,a){"use strict";cc._RF.push(e,"57853rAZexG4pEfR+Uh0ALl","Road"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./Building"),n=cc._decorator,r=n.ccclass,i=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([r],e)}(o.default));a.default=i,cc._RF.pop()},{"./Building":"Building"}],SpecialArk:[function(t,e,a){"use strict";cc._RF.push(e,"af740uwBhpJLINK3QpsTq54","SpecialArk"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../WorldUI"),n=t("../DialogPanel"),r=cc._decorator,i=r.ccclass,c=r.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.strName="",t.distanceThreshold=1e4,t.strTooFar="",t.strInfo="",t.grpInfo=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.location=this.node.position},t.prototype.onClick=function(){o.default.Instance.selectSpecialArk(this.node)},t.prototype.refreshZoom=function(t){this.node.position=this.location.mul(t),this.grpInfo.opacity=.08<o.default.Instance.zoomScale||o.default.Instance.selectedObjectNode==this.node.parent?255:0},t.prototype.update=function(t){this.refreshZoom(o.default.Instance.zoomScale)},t.prototype.showInfo=function(t){t>this.distanceThreshold?n.default.PopupWithOKButton(this.strName,this.strTooFar):n.default.PopupWithOKButton(this.strName,this.strInfo)},__decorate([c(String)],t.prototype,"strName",void 0),__decorate([c(cc.Float)],t.prototype,"distanceThreshold",void 0),__decorate([c(String)],t.prototype,"strTooFar",void 0),__decorate([c(String)],t.prototype,"strInfo",void 0),__decorate([c(cc.Node)],t.prototype,"grpInfo",void 0),t=__decorate([i],t)}(cc.Component);a.SpecialArk=l,cc._RF.pop()},{"../DialogPanel":"DialogPanel","../WorldUI":"WorldUI"}],SponsorIslandPanel:[function(t,e,a){"use strict";cc._RF.push(e,"6fe40yau5dLRKwAtiP/MgV8","SponsorIslandPanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../BlockchainMgr"),n=t("../Utils/CurrencyFormatter"),r=t("../DataMgr"),i=cc._decorator,c=i.ccclass,l=i.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edtName=null,t.edtLink=null,t.edtValue=null,t.lblCurMoney=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1},t.prototype.setData=function(t){if((this.island=t).data.sponsor==o.default.WalletAddress)this.lblCurMoney.string="0";else{var e=r.DataMgr.calcCurrentMoneyInIsland(t.data);this.lblCurMoney.string=n.default.formatNAS(1.101*e/1e18)}},t.prototype.onConfirmClick=function(){o.default.Instance.sponsor(this.island.data.id,this.edtName.string,this.edtLink.string,parseFloat(this.edtValue.string))},t.prototype.close=function(){this.node.active=!1},__decorate([l(cc.EditBox)],t.prototype,"edtName",void 0),__decorate([l(cc.EditBox)],t.prototype,"edtLink",void 0),__decorate([l(cc.EditBox)],t.prototype,"edtValue",void 0),__decorate([l(cc.Label)],t.prototype,"lblCurMoney",void 0),t=a=__decorate([c],t);var a}(cc.Component);a.default=s,cc._RF.pop()},{"../BlockchainMgr":"BlockchainMgr","../DataMgr":"DataMgr","../Utils/CurrencyFormatter":"CurrencyFormatter"}],TaskMgr:[function(t,e,a){"use strict";cc._RF.push(e,"8b016C7S51BeY/RKmLSDzh4","TaskMgr"),Object.defineProperty(a,"__esModule",{value:!0});var o=function(){function t(){}return t.list=[{description:"",func:function(){}}],t}();a.default=o,cc._RF.pop()},{}],TechButton:[function(t,e,a){"use strict";cc._RF.push(e,"381b4B+yDRNAIom8tWyu99R","TechButton"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./DataMgr"),n=cc._decorator,r=n.ccclass,i=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblWork=null,t.prgWork=null,t.gear=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(t,e){this.info=t,this.lblName.string=t.Name,this.data?this.lblWork.string=this.data.filledWork.toFixed()+" / "+t.Work:this.lblWork.string=t.Work.toString(),this.data=e,this.prgWork.progress=e.filledWork/t.Work},t.prototype.update=function(t){this.prgWork.progress=this.data.filledWork/this.info.Work,o.DataMgr.currentWorkingTech==this.info.id?(this.gear.active=!0,this.gear.rotation+=18*o.DataMgr.researchRatePerMin*t):this.gear.active=!1},t.prototype.onClick=function(){o.DataMgr.currentWorkingTech!=this.info.id?o.DataMgr.currentWorkingTech=this.info.id:o.DataMgr.currentWorkingTech=null},__decorate([i(cc.Label)],t.prototype,"lblName",void 0),__decorate([i(cc.Label)],t.prototype,"lblWork",void 0),__decorate([i(cc.ProgressBar)],t.prototype,"prgWork",void 0),__decorate([i(cc.Node)],t.prototype,"gear",void 0),t=__decorate([r],t)}(cc.Component);a.default=c,cc._RF.pop()},{"./DataMgr":"DataMgr"}],TechPanel:[function(t,e,a){"use strict";cc._RF.push(e,"3402dUp2TBLFIsk2dVlT1d5","TechPanel"),Object.defineProperty(a,"__esModule",{value:!0});var r=t("./DataMgr"),i=t("./TechButton"),o=cc._decorator,n=o.ccclass,c=o.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonContainer=null,t.buttonTemplate=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1},t.prototype.start=function(){var n=this;r.DataMgr.TechConfig.forEach(function(e){var t=cc.instantiate(n.buttonTemplate);t.parent=n.buttonContainer;var a=t.getComponent(i.default),o=r.DataMgr.myTechData.find(function(t){return t.id==e.id});a.setAndRefresh(e,o),t.active=!0}),this.buttonTemplate.active=!1},t.prototype.onEnable=function(){},t.prototype.refresh=function(){},t.Show=function(){a.Instance.node.active=!0},t.Hide=function(){a.Instance.node.active=!1},t.prototype.close=function(){this.node.active=!1},__decorate([c(cc.Node)],t.prototype,"buttonContainer",void 0),__decorate([c(cc.Node)],t.prototype,"buttonTemplate",void 0),t=a=__decorate([n],t);var a}(cc.Component);a.default=l,cc._RF.pop()},{"./DataMgr":"DataMgr","./TechButton":"TechButton"}],ToastPanel:[function(t,e,a){"use strict";cc._RF.push(e,"159ccmVx0JBF6iFx9aAYPqK","ToastPanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=o.property,i=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.toastTemplate=null,t.container=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).toastTemplate.active=!1},t.prototype.toast=function(t){var e=cc.instantiate(o.Instance.toastTemplate);e.parent=this.container,e.getComponent(cc.Label).string=t,e.active=!0;var a=cc.sequence(cc.delayTime(4.5),cc.fadeOut(.5));e.runAction(a),setTimeout(function(){e.destroy()},5e3)},t.Toast=function(t){o.Instance.toast(t)},__decorate([r(cc.Node)],t.prototype,"toastTemplate",void 0),__decorate([r(cc.Node)],t.prototype,"container",void 0),t=o=__decorate([n],t);var o}(cc.Component);a.default=i,cc._RF.pop()},{}],WorkshopBuilding:[function(t,e,a){"use strict";cc._RF.push(e,"2ffd4wRHIRBKbqpQioNYuQn","WorkshopBuilding"),Object.defineProperty(a,"__esModule",{value:!0});var s=t("./DataMgr"),o=t("./Building"),n=t("./MainCtrl"),r=cc._decorator,i=r.ccclass,c=r.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblConsumption=null,t.lblOutput=null,t.lblWorkers=null,t.nodeGear=null,t.btnDecWork=null,t.btnIncWork=null,t}return __extends(t,e),t.prototype.setInfo=function(t,e){this.info=t,this.data=e,this.lblName.string=t.Name,this.node.setContentSize(100*t.Length,100*t.Width),this.refresh()},t.prototype.changeWorkers=function(t,e){if("-"==e){var a=Math.min(this.data.workers,1);this.data.workers-=a,s.DataMgr.idleWorkers+=a}else if("+"==e){var o=Math.min(s.DataMgr.idleWorkers,1,this.info.MaxHuman-this.data.workers);this.data.workers+=o,s.DataMgr.idleWorkers-=o}this.refresh()},t.prototype.update=function(t){this.lblWorkers.string="人"+this.data.workers.toFixed()+"/"+this.info.MaxHuman,"research239"==this.data.id?0<this.data.workers&&s.DataMgr.currentWorkingTech&&(this.nodeGear.rotation+=360*this.data.workers/this.info.MaxHuman*t):this.data.isWorking&&(this.nodeGear.rotation+=360*this.data.workers/this.info.MaxHuman*t),this.btnDecWork.interactable=0<this.data.workers,this.btnIncWork.interactable=this.data.workers<this.info.MaxHuman,n.default.Ticks%200==0&&this.refresh()},t.prototype.refresh=function(){for(var r=this.info,i=[],t=function(t){var e=r["Raw"+t];if(e&&0<e.length){var a=r["Raw"+t+"Rate"],o=s.DataMgr.CargoConfig.find(function(t){return t.id==e}),n=Math.round(a*c.data.workers/c.info.MaxHuman*10)/10;i.push("消耗 "+n+o.Name+"/min")}},c=this,e=0;e<4;e++)t(e);var a=function(t){var e=r["Out"+t];if(e&&0<e.length){var a=r["Out"+t+"Rate"],o=s.DataMgr.CargoConfig.find(function(t){return t.id==e}),n=Math.round(a*l.data.workers/l.info.MaxHuman*10)/10;i.push("生产 "+n+o.Name+"/min")}},l=this;for(e=0;e<4;e++)a(e);if(0<i.length){var o=i[0];for(e=1;e<i.length;e++){o+="\n"+i[e]}this.lblConsumption.string=o}else this.lblConsumption.string=""},__decorate([c(cc.Label)],t.prototype,"lblConsumption",void 0),__decorate([c(cc.Label)],t.prototype,"lblOutput",void 0),__decorate([c(cc.Label)],t.prototype,"lblWorkers",void 0),__decorate([c(cc.Node)],t.prototype,"nodeGear",void 0),__decorate([c(cc.Button)],t.prototype,"btnDecWork",void 0),__decorate([c(cc.Button)],t.prototype,"btnIncWork",void 0),t=__decorate([i],t)}(o.default);a.default=l,cc._RF.pop()},{"./Building":"Building","./DataMgr":"DataMgr","./MainCtrl":"MainCtrl"}],WorldUI:[function(t,e,a){"use strict";cc._RF.push(e,"d2d4ehqPFVDS4fv9l1Oq7He","WorldUI"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./CvsMain"),n=t("./BaseUI"),m=t("./MainCtrl"),r=t("./ArkUI"),y=t("./ArkInWorld"),M=t("./DataMgr"),c=t("./BlockchainMgr"),i=t("./HomeUI"),D=t("./World/Island"),l=t("./UI/AttackIslandPanel"),s=t("./DialogPanel"),v=t("./Utils/CurrencyFormatter"),d=t("./UI/SponsorIslandPanel"),u=t("./UI/IslandInfoFrame"),p=t("./UI/ToastPanel"),k=t("./World/SpecialArk"),h=cc._decorator,f=h.ccclass,g=h.property,_=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mineContainer=null,t.islandContainer=null,t.arkContainer=null,t.arkTemplate=null,t.worldMap=null,t.earth=null,t.grpSelectObject=null,t.grpSelectSpeArk=null,t.selectFrame=null,t.btnSponsorLink=null,t.lblAttackButton=null,t.btnCollectIsland=null,t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=.1,t.lblAsideSelectFrame=null,t.editSailDestinationMode=!1,t.grpSail=null,t.sailDestinationIndicator=null,t.lblDestinationInfo=null,t.btnCancelSail=null,t.btnConfirmSail=null,t.islandInfoFrameTemplate=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1;var e=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.panPad.on(cc.Node.EventType.TOUCH_END,this.onPanPadTouchEnd,this),this.initIslandInfoFrames()},t.prototype.onEnable=function(){if(this.editSailDestinationMode=!1,this.selectedObjectNode=null,M.DataMgr.myData)try{this.refreshData(),this.refreshZoom()}catch(t){console.error(t)}},t.prototype.onBtnBackClick=function(){o.default.EnterUI(i.default)},t.prototype.refreshData=function(){for(var t=Object.keys(M.DataMgr.othersData).length+1,e=this.arkContainer.childrenCount;e<t;e++){cc.instantiate(this.arkTemplate).parent=this.arkContainer}for(var a=[],o=t;o<this.arkContainer.childrenCount;o++)a.push(this.arkContainer.children[o]);a.forEach(function(t){return t.destroy()}),this.arkContainer.children[0].getComponent(y.default).setAndRefresh(M.DataMgr.myData,this.zoomScale);var n=0;for(var r in M.DataMgr.othersData){var i=M.DataMgr.othersData[r];this.arkContainer.children[n+1].getComponent(y.default).setAndRefresh(i,this.zoomScale),n++}},t.prototype.refreshMyArk=function(){this.arkContainer.children[0].getComponent(y.default).setAndRefresh(M.DataMgr.myData,this.zoomScale)},t.prototype.refreshZoom=function(){this.earth.scale=this.zoomScale,this.editSailDestinationMode&&this.newDestination&&(this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale))},t.prototype.update=function(t){(M.DataMgr.changed||m.default.Ticks%100==0)&&(this.refreshData(),M.DataMgr.changed=!1);var e=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<e?((e-=5*t)<.5&&(e=.5),this.sldZoom.progress=e):e<.5&&(.5<(e+=5*t)&&(e=.5),this.sldZoom.progress=e)),.5!=e){var a=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(e-.5)*5*t),this.clampZoom();var o=this.zoomScale/a;this.worldMap.position=this.worldMap.position.mul(o),this.refreshZoom()}if(this.selectedObjectNode){this.selectFrame.active=!0,this.selectFrame.position=this.selectedObjectNode.position,this.selectFrame.setContentSize(2*this.selectedObjectNode.width,2*this.selectedObjectNode.height);var n=this.selectedObjectNode.getComponent(y.default),r=this.selectedObjectNode.getComponent(k.SpecialArk),i=this.selectedObjectNode.getComponent(D.default);if(n)this.grpSelectSpeArk.active=!1,this.grpSelectObject.active=!1;else if(i){if(this.btnSponsorLink.getComponentInChildren(cc.Label).string=i.data.sponsorName?i.data.sponsorName:"无赞助商",i.data.occupant&&i.data.occupant==M.DataMgr.myData.address){this.lblAttackButton.string="追加\n驻军";var c=i.data.lastMineTime,l=(Number(new Date)-c)/36e5,s=i.data.miningRate,d=i.data.money*(1-Math.exp(-s*l))/1e18;this.btnCollectIsland.node.active=!0,this.btnCollectIsland.getComponentInChildren(cc.Label).string="收取\n"+v.default.formatNAS(d)+"NAS"}else this.lblAttackButton.string="攻占",this.btnCollectIsland.node.active=!1;this.grpSelectSpeArk.active=!1,this.grpSelectObject.active=!0}else r&&(this.grpSelectObject.active=!1,this.grpSelectSpeArk.active=!0)}else this.grpSelectSpeArk.active=!1,this.selectFrame.active=!1,this.grpSelectObject.active=!1;if(this.editSailDestinationMode){if(this.grpSail.active=!0,this.sailDestinationIndicator.active=null!=this.newDestination,this.newDestination){var u=new cc.Vec2(M.DataMgr.myData.currentLocation.x,M.DataMgr.myData.currentLocation.y),p=this.newDestination.sub(u).mag(),h=p/M.DataMgr.getArkSpeedByTech(M.DataMgr.myTechData.find(function(t){return"arkspeed1011"==t.id}).finished),f=M.DataMgr.MethaneCostPerKmPerSize*p*M.DataMgr.myData.arkSize,g=p.toFixed()+"km\n"+h.toFixed()+"min\n"+f.toFixed()+"甲烷";this.lblDestinationInfo.string=g}}else this.grpSail.active=!1,this.sailDestinationIndicator.active=!1},t.prototype.onGotoArkClick=function(){o.default.EnterUI(r.default)},t.prototype.onCenterBtnClick=function(){var t=M.DataMgr.myData.currentLocation;t.mulSelf(this.zoomScale),this.worldMap.position=t.neg()},t.prototype.onPanPadTouchMove=function(t){var e=t.getDelta();this.worldMap.position=this.worldMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onPanPadTouchEnd=function(t){if(this.editSailDestinationMode){var e=t.getLocation();if(new cc.Vec2(e.x,e.y).sub(t.getStartLocation()).mag()<20){var a=this.worldMap.convertTouchToNodeSpaceAR(t.touch);this.newDestination=a.mul(1/this.zoomScale),this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale)}}if(this.selectedObjectNode){e=t.getLocation();new cc.Vec2(e.x,e.y).sub(t.getStartLocation()).mag()<20&&this.cancelSelectObject()}},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),a=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var o=this.zoomScale/a;this.worldMap.position=this.worldMap.position.mul(o),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){10<this.zoomScale&&(this.zoomScale=10),this.zoomScale<.01&&(this.zoomScale=.01)},t.prototype.selectArk=function(t){this.editSailDestinationMode||(this.selectedObjectNode=t)},t.prototype.selectSpecialArk=function(t){this.editSailDestinationMode||(this.selectedObjectNode=t)},t.prototype.selectIsland=function(t){this.editSailDestinationMode||(this.selectedObjectNode=t)},t.prototype.cancelSelectObject=function(){this.selectedObjectNode=null},t.prototype.onSelectObjectInfoClick=function(){var t=this.selectedObjectNode.getComponent(k.SpecialArk);if(t){var e=new cc.Vec2(M.DataMgr.myData.currentLocation.x,M.DataMgr.myData.currentLocation.y).sub(t.location).mag();t.showInfo(e)}},t.prototype.onBtnAttackIslandClick=function(){var t=this.selectedObjectNode?this.selectedObjectNode.getComponent(D.default):null;t&&(l.default.Instance.node.active=!0,l.default.Instance.setAndRefresh(t))},t.prototype.onBtnCollectIslandClick=function(){var t=this.selectedObjectNode?this.selectedObjectNode.getComponent(D.default):null;t&&t.data.occupant==M.DataMgr.myData.address&&c.default.Instance.collectIslandMoney(t.data.id)},t.prototype.onIslandSponsorLinkClick=function(){var t=this.selectedObjectNode?this.selectedObjectNode.getComponent(D.default):null;t&&t.data.sponsorLink&&window.open(t.data.sponsorLink)},t.prototype.onIslandIWantSponsorClick=function(){var t=this.selectedObjectNode?this.selectedObjectNode.getComponent(D.default):null;t&&(d.default.Instance.node.active=!0,d.default.Instance.setData(t))},t.prototype.onBtnSailClick=function(){this.selectedObjectNode=null,this.editSailDestinationMode=!0,this.newDestination=null;var t=M.DataMgr.myTechData.find(function(t){return"arkspeed1011"==t.id});M.DataMgr.myData.speed=M.DataMgr.getArkSpeedByTech(!!t&&t.finished)},t.prototype.onCancelSailClick=function(){this.editSailDestinationMode=!1,this.newDestination=null},t.prototype.onConfirmSailClick=function(){if(this.newDestination){var t=M.DataMgr.myData;if(t.arkSize<=M.DataMgr.SmallArkSize)s.default.PopupWith1Button("简陋方舟无法航行","您的方舟是简陋方舟，没有扩建功能，请原地呆着吧。\n想要功能完整的方舟？请回到主界面领取标准方舟或大型方舟。需要安装星云钱包哦！","知道了",null);else{var e=new cc.Vec2(M.DataMgr.myData.currentLocation.x,M.DataMgr.myData.currentLocation.y),a=this.newDestination.sub(e).mag(),o=M.DataMgr.MethaneCostPerKmPerSize*a*M.DataMgr.myData.arkSize,n=M.DataMgr.myCargoData.find(function(t){return"methane74"==t.id});if(o>n.amount)s.default.PopupWith1Button("燃料不足","方舟引擎的唯一动力来源是甲烷。如果你想要环球旅行，多造一些[甲烷采集器]吧！","知道了",null);else{var r=M.DataMgr.myTechData.find(function(t){return"arkspeed1011"==t.id});t.speed=M.DataMgr.getArkSpeedByTech(!!r&&r.finished);var i={};i.nickname=t.nickname,i.country=t.country,i.arkSize=t.arkSize,i.population=t.population,i.speed=t.speed,i.locationX=t.currentLocation.x,i.locationY=t.currentLocation.y,i.destinationX=this.newDestination.x,i.destinationY=this.newDestination.y,console.log("ConfirmSail",i),c.default.Instance.setSail(i,function(){n.amount=Math.max(0,n.amount-o)})}}}else p.default.Toast("请先点击地图空白位置，选择目的地，再点√")},t.prototype.initIslandInfoFrames=function(){var a=this;this.islandContainer.children.forEach(function(t){var e=cc.instantiate(a.islandInfoFrameTemplate);e.parent=t,e.position=a.islandInfoFrameTemplate.position,t.getComponent(D.default).infoFrame=e.getComponent(u.default),e.active=!0}),this.islandInfoFrameTemplate.active=!1},__decorate([g(cc.Node)],t.prototype,"mineContainer",void 0),__decorate([g(cc.Node)],t.prototype,"islandContainer",void 0),__decorate([g(cc.Node)],t.prototype,"arkContainer",void 0),__decorate([g(cc.Node)],t.prototype,"arkTemplate",void 0),__decorate([g(cc.Node)],t.prototype,"worldMap",void 0),__decorate([g(cc.Node)],t.prototype,"earth",void 0),__decorate([g(cc.Node)],t.prototype,"grpSelectObject",void 0),__decorate([g(cc.Node)],t.prototype,"grpSelectSpeArk",void 0),__decorate([g(cc.Node)],t.prototype,"selectFrame",void 0),__decorate([g(cc.Button)],t.prototype,"btnSponsorLink",void 0),__decorate([g(cc.Label)],t.prototype,"lblAttackButton",void 0),__decorate([g(cc.Button)],t.prototype,"btnCollectIsland",void 0),__decorate([g(cc.Node)],t.prototype,"panPad",void 0),__decorate([g(cc.Slider)],t.prototype,"sldZoom",void 0),__decorate([g(cc.Label)],t.prototype,"lblAsideSelectFrame",void 0),__decorate([g(cc.Node)],t.prototype,"grpSail",void 0),__decorate([g(cc.Node)],t.prototype,"sailDestinationIndicator",void 0),__decorate([g(cc.Label)],t.prototype,"lblDestinationInfo",void 0),__decorate([g(cc.Node)],t.prototype,"btnCancelSail",void 0),__decorate([g(cc.Node)],t.prototype,"btnConfirmSail",void 0),__decorate([g(cc.Node)],t.prototype,"islandInfoFrameTemplate",void 0),t=a=__decorate([f],t);var a}(n.default);a.default=_,cc._RF.pop()},{"./ArkInWorld":"ArkInWorld","./ArkUI":"ArkUI","./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./HomeUI":"HomeUI","./MainCtrl":"MainCtrl","./UI/AttackIslandPanel":"AttackIslandPanel","./UI/IslandInfoFrame":"IslandInfoFrame","./UI/SponsorIslandPanel":"SponsorIslandPanel","./UI/ToastPanel":"ToastPanel","./Utils/CurrencyFormatter":"CurrencyFormatter","./World/Island":"Island","./World/SpecialArk":"SpecialArk"}]},{},["ArkInWorld","ArkUI","BaseUI","BlockchainMgr","BuildPanel","Building","BuildingButton","CvsMain","DataMgr","DialogPanel","Foreground","HomeUI","HouseBuilding","MainCtrl","Road","TaskMgr","TechButton","TechPanel","AsyncLoadSprite","AttackIslandPanel","BuildingInfoPanel","EditNicknamePanel","FlagMgr","IntroUI","IslandInfoFrame","SponsorIslandPanel","ToastPanel","CurrencyFormatter","WorkshopBuilding","WorldUI","IronMine","Island","SpecialArk"]);