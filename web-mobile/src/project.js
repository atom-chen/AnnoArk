require=function t(e,o,n){function r(i,c){if(!o[i]){if(!e[i]){var l="function"==typeof require&&require;if(!c&&l)return l(i,!0);if(a)return a(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var u=o[i]={exports:{}};e[i][0].call(u.exports,function(t){var o=e[i][1][t];return r(o||t)},u,u.exports,t,e,o,n)}return o[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)r(n[i]);return r}({ArkInWorld:[function(t,e,o){"use strict";cc._RF.push(e,"dec21HFq/1BXrPvCkgOJBUs","ArkInWorld"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=n.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprArk=null,e.lblName=null,e}return __extends(e,t),e.prototype.setAndRefresh=function(t,e){console.log("sar",t),this.data=t,this.sprArk.node.setContentSize(t.arkSize,t.arkSize),this.lblName.string=t.nickname,this.refreshZoom(e)},e.prototype.refreshZoom=function(t){var e=new cc.Vec2(this.data.arkLocationX,this.data.arkLocationY);e.mulSelf(t),this.node.position=e},__decorate([a(cc.Sprite)],e.prototype,"sprArk",void 0),__decorate([a(cc.Label)],e.prototype,"lblName",void 0),e=__decorate([r],e)}(cc.Component);o.default=i,cc._RF.pop()},{}],ArkUI:[function(t,e,o){"use strict";cc._RF.push(e,"e7f42dM68VAz487nLcu3wTI","ArkUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./BaseUI"),a=t("./WorldUI"),i=t("./DataMgr"),c=t("./BuildPanel"),l=cc._decorator,s=l.ccclass,u=l.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arkMap=null,e.panPad=null,e.sldZoom=null,e.pressingZoomSlider=!1,e.zoomScale=1,e.blueprint=null,e.blueprintIndicator=null,e.currentHoldingBlueprint=null,e}return __extends(e,t),o=e,e.prototype.onLoad=function(){o.Instance=this;var t=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(e){t.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(e){t.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(e){t.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.cells=[];for(var e=-50;e<=50;e++){this.cells[e]=[];for(var n=-50;n<50;n++)this.cells[e][n]=new h}this.blueprint.on(cc.Node.EventType.TOUCH_MOVE,this.dragBlueprint.bind(this))},e.prototype.onEnable=function(){this.refreshZoom();for(var t=i.DataMgr.myData,e=-Math.floor(t.arkSize/2);e<t.arkSize/2;e++)for(var o=-Math.floor(t.arkSize/2);o<t.arkSize/2;o++){var n=this.cells[e][o];n.isLand=!0,n.building=null}i.DataMgr.myBuildingData.forEach(function(t){})},e.prototype.refreshZoom=function(){this.arkMap.scale=this.zoomScale},e.prototype.update=function(t){i.DataMgr.changed&&(this.refreshData(),i.DataMgr.changed=!1);var e=this.sldZoom.progress;if(this.pressingZoomSlider||(e>.5?((e-=5*t)<.5&&(e=.5),this.sldZoom.progress=e):e<.5&&((e+=5*t)>.5&&(e=.5),this.sldZoom.progress=e)),.5!=e){var o=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(e-.5)*5*t),this.clampZoom();var n=this.zoomScale/o;this.arkMap.position=this.arkMap.position.mul(n),this.refreshZoom()}if(this.currentHoldingBlueprint){this.blueprint.active=!0,this.blueprint.position=new cc.Vec2(100*this.currentBlueprintIJ.i-50,100*this.currentBlueprintIJ.j-50),this.blueprint.setContentSize(100*this.currentHoldingBlueprint.length,100*this.currentHoldingBlueprint.width);for(var r=0;r<this.currentHoldingBlueprint.length;r++)for(var a=0;a<this.currentHoldingBlueprint.width;a++){var c=this.cells[this.currentBlueprintIJ.i][this.currentBlueprintIJ.j];this.blueprintIndicator.fillColor=c.building?cc.Color.RED:cc.Color.GREEN,this.blueprintIndicator.fillRect(100*r,100*a,100,100)}}},e.prototype.refreshData=function(){},e.prototype.onGotoWorldClick=function(){n.default.EnterUI(a.default)},e.prototype.onBuildingClick=function(){c.default.Show()},e.prototype.onTechClick=function(){},e.prototype.onCenterBtnClick=function(){var t=i.DataMgr.myData,e=new cc.Vec2(t.arkLocationX,t.arkLocationY);e.mulSelf(this.zoomScale),this.arkMap.position=e.neg()},e.prototype.onPanPadTouchMove=function(t){console.log("drag map");var e=t.getDelta();this.arkMap.position=this.arkMap.position.add(new cc.Vec2(e.x,e.y))},e.prototype.onMouseWheel=function(t){var e=t.getScrollY(),o=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/o;this.arkMap.position=this.arkMap.position.mul(n),this.refreshZoom()},e.prototype.onZoomSliderChange=function(t){},e.prototype.clampZoom=function(){this.zoomScale>3&&(this.zoomScale=3),this.zoomScale<.3&&(this.zoomScale=.3)},e.prototype.enterBuildMode=function(t){this.currentHoldingBlueprint=t,this.currentBlueprintIJ=d.ZERO},e.prototype.dragBlueprint=function(t){var e=t.getLocation();console.log("loc",e);var o=this.arkMap.convertToNodeSpaceAR(e);this.currentBlueprintIJ.i=Math.round(o.x/100),this.currentBlueprintIJ.j=Math.round(o.y/100)},__decorate([u(cc.Node)],e.prototype,"arkMap",void 0),__decorate([u(cc.Node)],e.prototype,"panPad",void 0),__decorate([u(cc.Slider)],e.prototype,"sldZoom",void 0),__decorate([u(cc.Node)],e.prototype,"blueprint",void 0),__decorate([u(cc.Graphics)],e.prototype,"blueprintIndicator",void 0),e=o=__decorate([s],e);var o}(r.default);o.default=p;var d=function(){function t(){}return Object.defineProperty(t,"ZERO",{get:function(){return{i:0,j:0}},enumerable:!0,configurable:!0}),t}(),h=function(){this.isLand=!1,this.building=null};cc._RF.pop()},{"./BaseUI":"BaseUI","./BuildPanel":"BuildPanel","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./WorldUI":"WorldUI"}],BaseUI:[function(t,e,o){"use strict";cc._RF.push(e,"3b934a4EjZFs6JzaRDhWpVf","BaseUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([r],e)}(cc.Component));o.default=a,cc._RF.pop()},{}],BuildPanel:[function(t,e,o){"use strict";cc._RF.push(e,"5cf0290QotGfpJodxaDGNKp","BuildPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./DataMgr"),r=t("./BuildingButton"),a=cc._decorator,i=a.ccclass,c=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.buttonContainer=null,e.buttonTemplate=null,e}return __extends(e,t),o=e,e.prototype.onLoad=function(){o.Instance=this,this.node.active=!1,console.log("BP onL")},e.prototype.start=function(){var t=this;n.DataMgr.BuildingConfig.forEach(function(e){var o=cc.instantiate(t.buttonTemplate);o.parent=t.buttonContainer,o.getComponent(r.default).setAndRefresh(e),o.active=!0}),this.buttonTemplate.active=!1},e.prototype.onEnable=function(){},e.prototype.refresh=function(){},e.Show=function(){o.Instance.node.active=!0},e.Hide=function(){o.Instance.node.active=!1},__decorate([c(cc.Node)],e.prototype,"buttonContainer",void 0),__decorate([c(cc.Node)],e.prototype,"buttonTemplate",void 0),e=o=__decorate([i],e);var o}(cc.Component);o.default=l,cc._RF.pop()},{"./BuildingButton":"BuildingButton","./DataMgr":"DataMgr"}],BuildingButton:[function(t,e,o){"use strict";cc._RF.push(e,"7884bIsfolMCKOoH+GiGik+","BuildingButton"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./BuildPanel"),r=t("./ArkUI"),a=cc._decorator,i=a.ccclass,c=a.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblName=null,e.lblSize=null,e.lblRaws=null,e}return __extends(e,t),e.prototype.setAndRefresh=function(t){this.info=t,this.lblName.string=t.Name,this.lblSize.string=t.length+"*"+t.width},e.prototype.onClick=function(){n.default.Hide(),r.default.Instance.enterBuildMode(this.info)},__decorate([c(cc.Label)],e.prototype,"lblName",void 0),__decorate([c(cc.Label)],e.prototype,"lblSize",void 0),__decorate([c(cc.Label)],e.prototype,"lblRaws",void 0),e=__decorate([i],e)}(cc.Component);o.default=l,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildPanel":"BuildPanel"}],CvsMain:[function(t,e,o){"use strict";cc._RF.push(e,"69237yn4edJBK/5XvDAGlzX","CvsMain"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=n.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.uiContainer=null,e}return __extends(e,t),o=e,e.prototype.onLoad=function(){o.Instance=this,this.uiContainer.children.forEach(function(t){return t.active=!1})},e.EnterUI=function(t){this.Instance.uiContainer.children.forEach(function(e){e.getComponent(t)?e.active=!0:e.active=!1})},__decorate([a(cc.Node)],e.prototype,"uiContainer",void 0),e=o=__decorate([r],e);var o}(cc.Component);o.default=i,cc._RF.pop()},{}],DataMgr:[function(t,e,o){"use strict";cc._RF.push(e,"c6c13KfXfRK06sYYQzi7BU0","DataMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.readData=function(){try{var e=JSON.parse(cc.sys.localStorage.getItem("user0"));t.myData=e,t.myBuildingData=JSON.parse(cc.sys.localStorage.getItem("user0Building")),t.changed=!0,console.log("finish read data")}catch(t){console.error(t)}},t.writeData=function(){try{cc.sys.localStorage.setItem("user0",JSON.stringify(t.myData)),cc.sys.localStorage.setItem("user0Building",JSON.stringify(t.myBuildingData)),console.log("finish write data")}catch(t){console.error(t)}},t.clearData=function(){cc.sys.localStorage.removeItem("user0"),cc.sys.localStorage.removeItem("user0Building")},t.othersData=[],t.changed=!1,t}();o.DataMgr=n;var r=function(){};o.UserData=r;var a=function(){};o.BuildingInfo=a,cc._RF.pop()},{}],DialogPanel:[function(t,e,o){"use strict";cc._RF.push(e,"c0958fmSyFAp6wyHbHS0e10","DialogPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=n.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblTitle=null,e.lblContext=null,e.btn0=null,e.lblBtn0=null,e.btn1=null,e.lblBtn1=null,e}return __extends(e,t),o=e,e.prototype.onLoad=function(){o.Instance=this,this.hide()},e.PopupWith1Button=function(t,e,o,n){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=o,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(0,0),this.Instance.btn1.active=!1},e.PopupWith2Buttons=function(t,e,o,n,r,a){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=o,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(-150,0),this.Instance.func1=n,this.Instance.lblBtn1.string=o,this.Instance.btn1.active=!0,this.Instance.btn1.position=new cc.Vec2(150,0)},e.prototype.onBtn0Click=function(){this.func0&&this.func0()},e.prototype.onBtn1Click=function(){this.func1&&this.func1()},e.prototype.show=function(){this.node.active=!0},e.prototype.hide=function(){this.node.active=!1},__decorate([a(cc.Label)],e.prototype,"lblTitle",void 0),__decorate([a(cc.Label)],e.prototype,"lblContext",void 0),__decorate([a(cc.Node)],e.prototype,"btn0",void 0),__decorate([a(cc.Label)],e.prototype,"lblBtn0",void 0),__decorate([a(cc.Node)],e.prototype,"btn1",void 0),__decorate([a(cc.Label)],e.prototype,"lblBtn1",void 0),e=o=__decorate([r],e);var o}(cc.Component);o.default=i,cc._RF.pop()},{}],Foregroud:[function(t,e,o){"use strict";cc._RF.push(e,"c7a1eqdirtJGpHjde8W3SsV","Foregroud"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,r=n.ccclass,a=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.node.children.forEach(function(t){t.active||(t.active=!0,t.active=!1)})},e=__decorate([r],e)}(cc.Component));o.default=a,cc._RF.pop()},{}],HomeUI:[function(t,e,o){"use strict";cc._RF.push(e,"458fd6d6ChEGo+U+drv+haG","HomeUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./BaseUI"),a=t("./MainCtrl"),i=t("./DataMgr"),c=t("./WorldUI"),l=cc._decorator,s=l.ccclass,u=l.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.btnClaim0=null,e.btnClaim1=null,e.btnClaim2=null,e}return __extends(e,t),o=e,e.prototype.onLoad=function(){o.Instance=this},e.prototype.start=function(){i.DataMgr.myData&&(i.DataMgr.myData.arkSize||(i.DataMgr.myData=null)),i.DataMgr.myData&&n.default.EnterUI(c.default)},e.prototype.onClaim=function(t,e){switch(e){case"0":i.DataMgr.myData=a.default.Instance.generateNewArk(9),n.default.EnterUI(c.default)}i.DataMgr.myBuildingData=[]},__decorate([u(cc.Button)],e.prototype,"btnClaim0",void 0),__decorate([u(cc.Button)],e.prototype,"btnClaim1",void 0),__decorate([u(cc.Button)],e.prototype,"btnClaim2",void 0),e=o=__decorate([s],e);var o}(r.default);o.default=p,cc._RF.pop()},{"./BaseUI":"BaseUI","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./MainCtrl":"MainCtrl","./WorldUI":"WorldUI"}],MainCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"162b9/mIe1LjqpHBpjQnzp+","MainCtrl"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./HomeUI"),a=t("./DataMgr"),i=cc._decorator,c=i.ccclass,l=(i.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),o=e,e.prototype.onLoad=function(){o.Instance=this,a.DataMgr.readData(),this.fetchRemoteData()},e.prototype.start=function(){n.default.EnterUI(r.default),console.log("goto home"),cc.loader.loadRes("Building",function(t,e){console.log("Building loaded"),a.DataMgr.BuildingConfig=e}.bind(this)),cc.loader.loadRes("Cargo",function(t,e){console.log("Cargo loaded"),a.DataMgr.CargoConfig=e}.bind(this)),cc.loader.loadRes("Tech",function(t,e){console.log("Tech loaded"),a.DataMgr.TechConfig=e}.bind(this))},e.prototype.gotoHome=function(){n.default.EnterUI(r.default)},e.prototype.generateNewArk=function(t){var e=new a.UserData;e.arkSize=t;var o=Math.random()*Math.PI;return e.arkLocationX=4e3*Math.cos(o),e.arkLocationY=4e3*Math.sin(o),e.speed=0,e.population=2,e.nickname="新玩家",e},e.prototype.fetchRemoteData=function(){var t=[],e=new a.UserData;e.arkSize=41,e.arkLocationX=0,e.arkLocationY=0,e.speed=0,e.population=2251,e.nickname="星云号交易所方舟",t.push(e),a.DataMgr.othersData=t,a.DataMgr.changed=!0},e=o=__decorate([c],e);var o}(cc.Component));o.default=l,cc._RF.pop()},{"./CvsMain":"CvsMain","./DataMgr":"DataMgr","./HomeUI":"HomeUI"}],TaskMgr:[function(t,e,o){"use strict";cc._RF.push(e,"8b016C7S51BeY/RKmLSDzh4","TaskMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.list=[{description:"",func:function(){}}],t}();o.default=n,cc._RF.pop()},{}],WorldUI:[function(t,e,o){"use strict";cc._RF.push(e,"d2d4ehqPFVDS4fv9l1Oq7He","WorldUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),r=t("./BaseUI"),a=t("./ArkUI"),i=t("./ArkInWorld"),c=t("./DataMgr"),l=cc._decorator,s=l.ccclass,u=l.property,p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblEnergy=null,e.btnPause=null,e.ingameRange=null,e.arkContainer=null,e.arkTemplate=null,e.worldMap=null,e.earth=null,e.panPad=null,e.sldZoom=null,e.pressingZoomSlider=!1,e.zoomScale=.1,e}return __extends(e,t),o=e,e.prototype.onLoad=function(){o.Instance=this;var t=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(e){t.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(e){t.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(e){t.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this)},e.prototype.start=function(){},e.prototype.onEnable=function(){this.refreshData(),this.refreshZoom()},e.prototype.refreshData=function(){for(var t=c.DataMgr.othersData.length+1,e=this.arkContainer.childrenCount;e<t;e++){cc.instantiate(this.arkTemplate).parent=this.arkContainer}var o=[];for(e=t;e<this.arkContainer.childrenCount;e++)o.push(this.arkContainer.children[e]);o.forEach(function(t){return t.destroy()}),this.arkContainer.children[0].getComponent(i.default).setAndRefresh(c.DataMgr.myData,this.zoomScale);for(e=0;e<c.DataMgr.othersData.length;e++){c.DataMgr.othersData[e];this.arkContainer.children[e+1].getComponent(i.default).setAndRefresh(c.DataMgr.othersData[e],this.zoomScale)}},e.prototype.refreshZoom=function(){var t=this,e=12e3*this.zoomScale;this.earth.setContentSize(e,e),this.arkContainer.children.forEach(function(e){e.getComponent(i.default).refreshZoom(t.zoomScale)})},e.prototype.update=function(t){c.DataMgr.changed&&(this.refreshData(),c.DataMgr.changed=!1);var e=this.sldZoom.progress;if(this.pressingZoomSlider||(e>.5?((e-=5*t)<.5&&(e=.5),this.sldZoom.progress=e):e<.5&&((e+=5*t)>.5&&(e=.5),this.sldZoom.progress=e)),.5!=e){var o=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(e-.5)*5*t),this.clampZoom();var n=this.zoomScale/o;this.worldMap.position=this.worldMap.position.mul(n),this.refreshZoom()}},e.prototype.onGotoArkClick=function(){n.default.EnterUI(a.default)},e.prototype.onCenterBtnClick=function(){var t=c.DataMgr.myData,e=new cc.Vec2(t.arkLocationX,t.arkLocationY);e.mulSelf(this.zoomScale),this.worldMap.position=e.neg()},e.prototype.onPanPadTouchMove=function(t){console.log("drag map");var e=t.getDelta();this.worldMap.position=this.worldMap.position.add(new cc.Vec2(e.x,e.y))},e.prototype.onMouseWheel=function(t){var e=t.getScrollY(),o=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/o;this.worldMap.position=this.worldMap.position.mul(n),this.refreshZoom()},e.prototype.onZoomSliderChange=function(t){},e.prototype.clampZoom=function(){this.zoomScale>10&&(this.zoomScale=10),this.zoomScale<.01&&(this.zoomScale=.01)},__decorate([u(cc.Label)],e.prototype,"lblEnergy",void 0),__decorate([u(cc.Button)],e.prototype,"btnPause",void 0),__decorate([u(cc.Node)],e.prototype,"ingameRange",void 0),__decorate([u(cc.Node)],e.prototype,"arkContainer",void 0),__decorate([u(cc.Node)],e.prototype,"arkTemplate",void 0),__decorate([u(cc.Node)],e.prototype,"worldMap",void 0),__decorate([u(cc.Node)],e.prototype,"earth",void 0),__decorate([u(cc.Node)],e.prototype,"panPad",void 0),__decorate([u(cc.Slider)],e.prototype,"sldZoom",void 0),e=o=__decorate([s],e);var o}(r.default);o.default=p,cc._RF.pop()},{"./ArkInWorld":"ArkInWorld","./ArkUI":"ArkUI","./BaseUI":"BaseUI","./CvsMain":"CvsMain","./DataMgr":"DataMgr"}]},{},["ArkInWorld","ArkUI","BaseUI","BuildPanel","BuildingButton","CvsMain","DataMgr","DialogPanel","Foregroud","HomeUI","MainCtrl","TaskMgr","WorldUI"]);