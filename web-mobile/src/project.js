require=function i(r,c,l){function s(e,t){if(!c[e]){if(!r[e]){var a="function"==typeof require&&require;if(!t&&a)return a(e,!0);if(d)return d(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var o=c[e]={exports:{}};r[e][0].call(o.exports,function(t){return s(r[e][1][t]||t)},o,o.exports,i,r,c,l)}return c[e].exports}for(var d="function"==typeof require&&require,t=0;t<l.length;t++)s(l[t]);return s}({ArkInWorld:[function(t,e,a){"use strict";cc._RF.push(e,"dec21HFq/1BXrPvCkgOJBUs","ArkInWorld"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("./WorldUI"),o=cc._decorator,i=o.ccclass,r=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprArk=null,t.lblName=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.btnNode=new cc.Node,this.btnNode.parent=this.node,this.btnNode.on(cc.Node.EventType.TOUCH_END,this.onClick)},t.prototype.setAndRefresh=function(t,e){this.data=t,this.sprArk.node.setContentSize(t.arkSize,t.arkSize),this.lblName.string=t.nickname,this.refreshZoom(e)},t.prototype.refreshZoom=function(t){this.node.position=new cc.Vec2(this.data.currentLocation.x,this.data.currentLocation.y).mul(t),this.btnNode.setContentSize(this.node.width+50,this.node.height+50)},t.prototype.update=function(t){this.refreshZoom(n.default.Instance.zoomScale)},t.prototype.onClick=function(){n.default.Instance.selectArk(this.node)},__decorate([r(cc.Sprite)],t.prototype,"sprArk",void 0),__decorate([r(cc.Label)],t.prototype,"lblName",void 0),t=__decorate([i],t)}(cc.Component);a.default=c,cc._RF.pop()},{"./WorldUI":"WorldUI"}],ArkUI:[function(t,e,a){"use strict";cc._RF.push(e,"e7f42dM68VAz487nLcu3wTI","ArkUI"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("./CvsMain"),o=t("./BaseUI"),i=t("./WorldUI"),d=t("./DataMgr"),c=t("./BuildPanel"),l=t("./Building"),s=t("./TechPanel"),u=t("./DialogPanel"),p=t("./UI/BuildingInfoPanel"),h=t("./Utils/CurrencyFormatter"),f=t("./BlockchainMgr"),r=cc._decorator,g=r.ccclass,m=r.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.arkMap=null,t.ark=null,t.cargoLabelContainer=null,t.cargoLabelTemplate=null,t.cargoLabels={},t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=1,t.workshopTemplate=null,t.houseTemplate=null,t.roadTemplate=null,t.buildingContainer=null,t.blueprint=null,t.blueprintIndicator=null,t.currentHoldingBlueprint=null,t.grpBuild=null,t.btnConfirmBuild=null,t.selectedBuilding=null,t.grpBuildingInfo=null,t}return __extends(t,e),(r=t).prototype.onLoad=function(){var n=this,e=r.Instance=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.panPad.on(cc.Node.EventType.TOUCH_END,this.deselectBuilding,this),this.cells=[];for(var t=-50;t<=50;t++){this.cells[t]=[];for(var a=-50;a<50;a++)this.cells[t][a]=new M}this.blueprint.on(cc.Node.EventType.TOUCH_MOVE,this.dragBlueprint.bind(this)),this.workshopTemplate.active=!1,this.roadTemplate.active=!1,this.houseTemplate.active=!1;var o=cc.instantiate(this.cargoLabelTemplate);o.parent=this.cargoLabelContainer;var i=o.getComponent(cc.Label);i.string="人口",this.cargoLabels.population=i,d.DataMgr.CargoConfig.forEach(function(t){var e=cc.instantiate(n.cargoLabelTemplate);e.parent=n.cargoLabelContainer;var a=e.getComponent(cc.Label);a.string=t.Name,n.cargoLabels[t.id]=a}),this.cargoLabelTemplate.active=!1},t.prototype.onEnable=function(){var a=this;this.refreshZoom();var t=d.DataMgr.myData;console.log("size",t.arkSize);for(var e=-Math.floor(t.arkSize/2);e<t.arkSize/2;e++)for(var n=-Math.floor(t.arkSize/2);n<t.arkSize/2;n++){var o=this.cells[e][n];o.isLand=!0,o.building=null}this.buildingContainer.destroyAllChildren();var i=0;d.DataMgr.myBuildingData.forEach(function(e){var t=d.DataMgr.BuildingConfig.find(function(t){return t.id==e.id});console.log("precreatebuilding",e),a.createBuilding(t,e),i+=e.workers}),d.DataMgr.idleWorkers=t.population-i,this.deselectBuilding()},t.prototype.refreshZoom=function(){this.arkMap.scale=this.zoomScale},t.prototype.update=function(t){d.DataMgr.changed&&(this.refreshData(),d.DataMgr.changed=!1),this.updateCheckExpand(),this.cargoLabels.population.string="人口 "+d.DataMgr.myData.population+"/"+d.DataMgr.populationLimit+" (闲置 "+d.DataMgr.idleWorkers+") 增长"+d.DataMgr.populationGrowPerMin.toFixed(0)+"/min";for(var e=function(t){var e=d.DataMgr.CargoConfig[t],a=d.DataMgr.myCargoData.find(function(t){return t.id==e.id}),n=d.DataMgr.outputRates[e.id];n||(n=0);var o=e.Name+"   "+Math.floor(a?a.amount:0).toFixed()+"("+(0<n?"+":"")+n.toFixed()+")";"fish34509"==e.id&&a.amount<=0&&n<0&&(o+=" 食物短缺"),i.cargoLabels[e.id].string=o},i=this,a=0;a<d.DataMgr.CargoConfig.length;a++)e(a);var n=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<n?((n-=5*t)<.5&&(n=.5),this.sldZoom.progress=n):n<.5&&(.5<(n+=5*t)&&(n=.5),this.sldZoom.progress=n)),.5!=n){var o=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(n-.5)*5*t),this.clampZoom();var r=this.zoomScale/o;this.arkMap.position=this.arkMap.position.mul(r),this.refreshZoom()}if(this.currentHoldingBlueprint){this.blueprint.active=!0,this.blueprint.position=new cc.Vec2(100*this.currentBlueprintIJ.i-50,100*this.currentBlueprintIJ.j-50),this.blueprint.setContentSize(100*this.currentHoldingBlueprint.Length,100*this.currentHoldingBlueprint.Width);var c=!0;this.blueprintIndicator.clear();for(a=0;a<this.currentHoldingBlueprint.Length;a++)for(var l=0;l<this.currentHoldingBlueprint.Width;l++){var s=this.cells[this.currentBlueprintIJ.i+a][this.currentBlueprintIJ.j+l];this.blueprintIndicator.fillColor=s.building?cc.Color.RED:s.isLand?cc.Color.GREEN:cc.Color.RED,s.building&&(c=!1),s.isLand||(c=!1),this.blueprintIndicator.fillRect(100*a,100*l,100,100)}this.grpBuild.active=!0,this.btnConfirmBuild.interactable=c}else this.blueprint.active=!1,this.grpBuild.active=!1;this.selectedBuilding?this.grpBuildingInfo.active=!0:this.grpBuildingInfo.active=!1,this.ark.setContentSize(100*d.DataMgr.myData.arkSize,100*d.DataMgr.myData.arkSize)},t.prototype.refreshData=function(){},t.prototype.onGotoWorldClick=function(){this.deselectBuilding(),n.default.EnterUI(i.default)},t.prototype.onBuildBtnClick=function(){this.deselectBuilding(),c.default.Show()},t.prototype.onTechClick=function(){this.deselectBuilding(),d.DataMgr.myBuildingData.find(function(t){return"research239"==t.id})||u.default.PopupWith1Button("没有研究院","建造研究院并指派工作人员进行研究","确定",null),s.default.Show()},t.prototype.onCenterBtnClick=function(){var t=d.DataMgr.myData,e=new cc.Vec2(t.currentLocation.x,t.currentLocation.y);e.mulSelf(this.zoomScale),this.arkMap.position=e.neg()},t.prototype.onPanPadTouchMove=function(t){var e=t.getDelta();this.arkMap.position=this.arkMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),a=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/a;this.arkMap.position=this.arkMap.position.mul(n),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){3<this.zoomScale&&(this.zoomScale=3),this.zoomScale<.3&&(this.zoomScale=.3)},t.prototype.enterBuildMode=function(t){this.currentHoldingBlueprint=t,this.currentBlueprintIJ=d.IJ.ZERO},t.prototype.dragBlueprint=function(t){var e=t.getLocation(),a=this.arkMap.convertToNodeSpaceAR(e);this.currentBlueprintIJ.i=Math.round(a.x/100),this.currentBlueprintIJ.j=Math.round(a.y/100)},t.prototype.onBtnConfirmBuildClick=function(){for(var t=!0,e=0;e<this.currentHoldingBlueprint.Length;e++)for(var a=0;a<this.currentHoldingBlueprint.Width;a++){var n=this.cells[this.currentBlueprintIJ.i+e][this.currentBlueprintIJ.j+a];n.building&&(t=!1),n.isLand||(t=!1)}if(t){var o=[];for(e=0;e<4;e++){var i=this.currentHoldingBlueprint["BuildMat"+e];if(i&&0<i.length){var r=this.currentHoldingBlueprint["BuildMat"+e+"Count"];o.push([i,r])}}var c=!0;if(o.forEach(function(e){d.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount<e[1]&&(c=!1)}),c){o.forEach(function(e){d.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount-=e[1]});var l=new d.BuildingData;l.id=this.currentHoldingBlueprint.id,l.ij=this.currentBlueprintIJ.clone(),l.workers=0,d.DataMgr.myBuildingData.push(l),this.createBuilding(this.currentHoldingBlueprint,l),"road00001"==this.currentHoldingBlueprint.id?this.currentBlueprintIJ.j+=1:this.currentHoldingBlueprint=null}}},t.prototype.onBtnCancelBuildClick=function(){this.currentHoldingBlueprint=null},t.prototype.createBuilding=function(t,e){var a=t.prefab,n=cc.instantiate(this[a+"Template"]);n.parent=this.buildingContainer;var o=n.getComponent(l.default);o.setInfo(t,e),n.position=new cc.Vec2(100*e.ij.i-50,100*e.ij.j-50),n.active=!0;for(var i=0;i<t.Length;i++)for(var r=0;r<t.Width;r++){this.cells[e.ij.i+i][e.ij.j+r].building=o}},t.prototype.selectBuilding=function(t){console.log("选中建筑"),this.selectedBuilding=t},t.prototype.deselectBuilding=function(){this.selectedBuilding=null},t.prototype.onDemolishBtnClick=function(){var t=r.Instance;this.selectedBuilding&&u.default.PopupWith2Buttons("确定拆除建筑吗",t.selectedBuilding.info.Name+"\n建筑材料不予返还","取消",null,"拆除",function(){t.demolishBuilding(t.selectedBuilding),t.deselectBuilding()})},t.prototype.demolishBuilding=function(e){if(e){console.log("拆除建筑");var t=d.DataMgr.myBuildingData.findIndex(function(t){return t==e.data});if(0<=t){var a=e.data.workers;d.DataMgr.myBuildingData.splice(t,1),d.DataMgr.idleWorkers+=a;var n=d.DataMgr.BuildingConfig.find(function(t){return t.id==e.data.id});console.log("info.Length",n.Length);for(var o=0;o<n.Length;o++)for(var i=0;i<n.Width;i++)console.log("cells",e.data.ij.i+o,e.data.ij.j+i),this.cells[e.data.ij.i+o][e.data.ij.j+i].building=null;e.node.destroy()}}},t.prototype.onBuildingInfoBtnClick=function(){this.selectedBuilding&&(p.default.Show(this.selectedBuilding.info),this.deselectBuilding())},t.prototype.onBtnExpandClick=function(){if(d.DataMgr.myData.arkSize<=d.DataMgr.SmallArkSize)u.default.PopupWith1Button("简陋方舟无法扩建","您的方舟是简陋方舟，没有扩建功能。\n想要功能完整的方舟？请回到主界面领取标准方舟或大型方舟。需要安装星云钱包哦！","知道了",null);else{for(var t=null,e=0;e<d.DataMgr.RechargeToArkSize.length;e++){var a=d.DataMgr.RechargeToArkSize[e];if(d.DataMgr.myData.rechargeOnExpand/1e18<a[0]){t=a;break}}if(t){var n=t[0]-d.DataMgr.myData.rechargeOnExpand/1e18,o=t[1];u.default.PopupWith2Buttons("扩建方舟","支付 "+h.default.formatNAS(n)+"NAS 扩建方舟到 "+o+"×"+o+" 吗","取消",null,"支付",function(){f.default.Instance.expandArk(n)})}else u.default.PopupWith1Button("方舟已经最大","非常感谢您的支持！区块链首款SLG必将越做越好！","支持！！！",null)}},t.prototype.updateCheckExpand=function(){var t=d.DataMgr.GetArkSizeByRecharge(d.DataMgr.myData.rechargeOnExpand/1e18);if(this.lastTickArkSize!=t){console.log("检测到方舟成功扩建了",this.lastTickArkSize,t),this.lastTickArkSize=t;var e=d.DataMgr.myData;e.arkSize=t;for(var a=-Math.floor(e.arkSize/2);a<e.arkSize/2;a++)for(var n=-Math.floor(e.arkSize/2);n<e.arkSize/2;n++){this.cells[a][n].isLand=!0}}},__decorate([m(cc.Node)],t.prototype,"arkMap",void 0),__decorate([m(cc.Node)],t.prototype,"ark",void 0),__decorate([m(cc.Node)],t.prototype,"cargoLabelContainer",void 0),__decorate([m(cc.Node)],t.prototype,"cargoLabelTemplate",void 0),__decorate([m(cc.Node)],t.prototype,"panPad",void 0),__decorate([m(cc.Slider)],t.prototype,"sldZoom",void 0),__decorate([m(cc.Node)],t.prototype,"workshopTemplate",void 0),__decorate([m(cc.Node)],t.prototype,"houseTemplate",void 0),__decorate([m(cc.Node)],t.prototype,"roadTemplate",void 0),__decorate([m(cc.Node)],t.prototype,"buildingContainer",void 0),__decorate([m(cc.Node)],t.prototype,"blueprint",void 0),__decorate([m(cc.Graphics)],t.prototype,"blueprintIndicator",void 0),__decorate([m(cc.Node)],t.prototype,"grpBuild",void 0),__decorate([m(cc.Button)],t.prototype,"btnConfirmBuild",void 0),__decorate([m(cc.Node)],t.prototype,"grpBuildingInfo",void 0),t=r=__decorate([g],t);var r}(o.default);a.default=y;var M=function(){this.isLand=!1,this.building=null};cc._RF.pop()},{"./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./BuildPanel":"BuildPanel","./Building":"Building","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./TechPanel":"TechPanel","./UI/BuildingInfoPanel":"BuildingInfoPanel","./Utils/CurrencyFormatter":"CurrencyFormatter","./WorldUI":"WorldUI"}],AttackIslandPanel:[function(t,e,a){"use strict";cc._RF.push(e,"820acbSeDlEZbUkJ5dGpgYt","AttackIslandPanel"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("../DataMgr"),o=t("../BlockchainMgr"),i=cc._decorator,r=i.ccclass,c=i.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblOccupant=null,t.lblDefTank=null,t.lblDefChopper=null,t.lblDefShip=null,t.lblAtkTankMax=null,t.lblAtkChopperMax=null,t.lblAtkShipMax=null,t.edtAtkTank=null,t.edtAtkChopper=null,t.edtAtkShip=null,t.SldAtkTank=null,t.SldAtkChopper=null,t.SldAtkShip=null,t.tankMax=0,t.chopperMax=0,t.shipMax=0,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1},t.prototype.setAndRefresh=function(t){this.island=t,this.lblDefTank.string=t.data.tankPower.toFixed(),this.lblDefChopper.string=t.data.chopperPower.toFixed(),this.lblDefShip.string=t.data.shipPower.toFixed()},t.prototype.onSliderChange=function(t,e){switch(e){case"Tank":this.edtAtkTank.string=(this.SldAtkTank.progress*this.tankMax).toFixed();break;case"Chopper":this.edtAtkChopper.string=(this.SldAtkChopper.progress*this.chopperMax).toFixed();break;case"Ship":this.edtAtkShip.string=(this.SldAtkShip.progress*this.shipMax).toFixed()}},t.prototype.onEditBoxChange=function(t,e){switch(e){case"Tank":var a=parseInt(this.edtAtkTank.string);a=Math.max(0,Math.min(this.tankMax,a)),this.edtAtkTank.string=a.toFixed(),this.SldAtkTank.progress=a/this.tankMax;break;case"Chopper":a=parseInt(this.edtAtkChopper.string),a=Math.max(0,Math.min(this.chopperMax,a)),this.edtAtkChopper.string=a.toFixed(),this.SldAtkChopper.progress=a/this.chopperMax;break;case"Ship":a=parseInt(this.edtAtkShip.string),a=Math.max(0,Math.min(this.shipMax,a)),this.edtAtkShip.string=a.toFixed(),this.SldAtkShip.progress=a/this.shipMax}},t.prototype.update=function(t){this.tankMax=Math.floor(n.DataMgr.myCargoData.find(function(t){return"tank23532"==t.id}).amount),this.lblAtkTankMax.string="/"+this.tankMax.toFixed(),this.chopperMax=Math.floor(n.DataMgr.myCargoData.find(function(t){return"chopper424"==t.id}).amount),this.lblAtkChopperMax.string="/"+this.chopperMax.toFixed(),this.shipMax=Math.floor(n.DataMgr.myCargoData.find(function(t){return"ship40342"==t.id}).amount),this.lblAtkShipMax.string="/"+this.shipMax.toFixed()},t.prototype.onConfirmClick=function(){console.log("准备攻占资源岛",this.island);var t=Math.round(this.SldAtkTank.progress*this.tankMax),e=Math.round(this.SldAtkChopper.progress*this.chopperMax),a=Math.round(this.SldAtkShip.progress*this.shipMax);o.default.Instance.attackIsland(this.island.data.id,t,e,a)},t.prototype.close=function(){this.node.active=!1},__decorate([c(cc.Label)],t.prototype,"lblOccupant",void 0),__decorate([c(cc.Label)],t.prototype,"lblDefTank",void 0),__decorate([c(cc.Label)],t.prototype,"lblDefChopper",void 0),__decorate([c(cc.Label)],t.prototype,"lblDefShip",void 0),__decorate([c(cc.Label)],t.prototype,"lblAtkTankMax",void 0),__decorate([c(cc.Label)],t.prototype,"lblAtkChopperMax",void 0),__decorate([c(cc.Label)],t.prototype,"lblAtkShipMax",void 0),__decorate([c(cc.EditBox)],t.prototype,"edtAtkTank",void 0),__decorate([c(cc.EditBox)],t.prototype,"edtAtkChopper",void 0),__decorate([c(cc.EditBox)],t.prototype,"edtAtkShip",void 0),__decorate([c(cc.Slider)],t.prototype,"SldAtkTank",void 0),__decorate([c(cc.Slider)],t.prototype,"SldAtkChopper",void 0),__decorate([c(cc.Slider)],t.prototype,"SldAtkShip",void 0),t=a=__decorate([r],t);var a}(cc.Component);a.default=l,cc._RF.pop()},{"../BlockchainMgr":"BlockchainMgr","../DataMgr":"DataMgr"}],BaseUI:[function(t,e,a){"use strict";cc._RF.push(e,"3b934a4EjZFs6JzaRDhWpVf","BaseUI"),Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,i=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([o],e)}(cc.Component));a.default=i,cc._RF.pop()},{}],BlockchainMgr:[function(t,e,s){"use strict";cc._RF.push(e,"3ffefed5pBCD40DXf/kM6bs","BlockchainMgr"),Object.defineProperty(s,"__esModule",{value:!0});var o=t("./DataMgr"),d=t("./DialogPanel"),a=t("./WorldUI"),n=t("./UI/ToastPanel"),i=t("./ArkUI"),r=t("./CvsMain"),c=t("./HomeUI"),u=t("./UI/AttackIslandPanel"),l=cc._decorator,p=l.ccclass;l.property;s.ContractAddress="n22y8Bg9WyGJUr2hLf33SnSwdkuiKX5VonV",s.EncKey=37234;var h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.checkWalletCountdown=1e9,t.fetchAllDataCountdown=1e9,t}return __extends(t,e),(l=t).prototype.onLoad=function(){l.Instance=this},t.prototype.start=function(){this.checkWalletCountdown=1,this.fetchAllDataCountdown=1,console.log("======test");var t=new o.UserData;t.nickname="你好呀",t.speed=1e3,console.log("1",JSON.stringify(t)),console.log("2",JSON.stringify(JSON.stringify(t))),console.log("3",JSON.stringify(JSON.stringify(JSON.stringify(t))))},t.prototype.update=function(t){try{Neb,NebPay}catch(t){return}if(this.checkWalletCountdown-=t,this.fetchAllDataCountdown-=t,this.checkWalletCountdown<=0){try{var e=this;(a=new Neb).setRequest(new HttpRequest(l.BlockchainUrl)),a.api.getNebState().then(function(t){window.addEventListener("message",e.onGetWalletData),window.postMessage({target:"contentscript",data:{},method:"getAccount"},"*")})}catch(t){console.error(t)}this.checkWalletCountdown=l.CheckWalletInterval}if(this.fetchAllDataCountdown<=0){var a;(a=new Neb).setRequest(new HttpRequest(l.BlockchainUrl));var n=l.WalletAddress?l.WalletAddress:Account.NewAccount().getAddressString(),o={function:"get_map_info",args:"[]"};a.api.call(n,s.ContractAddress,"0","0","1000000","2000000",o).then(this.onGetAllMapData).catch(function(t){console.log("call get_map_info error:"+t.message)}),this.fetchAllDataCountdown=l.FetchAllDataInterval}},t.prototype.onGetWalletData=function(t){if(t.data&&t.data.data&&t.data.data.account&&0<t.data.data.account.length){var e=t.data.data.account;l.WalletAddress!=e&&(console.log("Change wallet address:",e),l.WalletAddress=e,this.fetchAllDataCountdown=0,o.DataMgr.myData&&o.DataMgr.myData.address!=e&&(a.default.Instance.node.active||i.default.Instance.node.active)&&r.default.EnterUI(c.default))}},t.prototype.onGetAllMapData=function(t){console.log("onGetAllMapData",t);var e=JSON.parse(t.result).result_data,a=e.ark_info,n=e.island_info;o.DataMgr.othersData=[],a.forEach(function(t){t.address==l.WalletAddress?(o.DataMgr.myData||(o.DataMgr.myData=new o.UserData),o.DataMgr.myData.arkSize=o.DataMgr.GetArkSizeByRecharge(t.rechargeOnExpand/1e18),o.DataMgr.myData.nickname||(o.DataMgr.myData.nickname=t.nickname),o.DataMgr.myData.address=t.address,o.DataMgr.myData.country||(o.DataMgr.myData.country=t.country),o.DataMgr.myData.speed=t.speed,o.DataMgr.myData.locationX=t.locationX,o.DataMgr.myData.locationY=t.locationY,o.DataMgr.myData.lastLocationTime=t.lastLocationTime,o.DataMgr.myData.destinationX=t.destinationX,o.DataMgr.myData.destinationY=t.destinationY,o.DataMgr.myData.rechargeOnExpand=t.rechargeOnExpand,o.DataMgr.writeData()):(o.DataMgr.othersData[t.address]=t,o.DataMgr.othersData[t.address].currentLocation=new cc.Vec2(t.locationX,t.locationY))}),n.forEach(function(t){var e=o.DataMgr.allIslandData[t.id];if(e)for(var a in t)e[a]=t[a];else console.error("从区块链获取到未知id的island:",t)})},t.prototype.claimArk=function(t){if(window.webExtensionWallet)try{var e=c.default.Instance.lblNickname.string,a=c.default.Instance.country,n=new NebPay,o=l.BlockchainUrl,i=s.ContractAddress;console.log("调用钱包claim_ark(",e);var r='["'+e+'","'+a+'"]';n.call(i,t,"claim_ark",r,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:o,listener:this.claimArkCallback})}catch(t){console.error(t)}else d.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.claimArkCallback=function(t){console.log("claimArkCallback: ",t),"Error"!=t.toString().substr(0,5)?n.default.Toast("交易发送成功，请等待区块链出块"):n.default.Toast("交易失败:"+t)},t.prototype.setSail=function(t,e){if(window.webExtensionWallet)try{var a=new NebPay,n=l.BlockchainUrl,o=s.ContractAddress;console.log("调用钱包update_ark",t);var i='["'+encodeURIComponent(JSON.stringify(t))+'"]';a.call(o,0,"update_ark",i,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:n,listener:this.setSailCallback(e)})}catch(t){console.error(t)}else d.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.setSailCallback=function(e){return function(t){console.log("setSailCallback: ",e,t),"Error"!=t.toString().substr(0,5)?(d.default.PopupWith2Buttons("方舟引擎开始预热，预计1分钟内出发","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null),a.default.Instance.editSailDestinationMode=!1,e&&e()):n.default.Toast("交易失败:"+t)}},t.prototype.expandArk=function(t){if(window.webExtensionWallet)try{var e=new NebPay,a=l.BlockchainUrl,n=s.ContractAddress,o=Math.ceil(1e6*t)/1e6;console.log("调用钱包recharge_expand(valueNas",t,"value",o),e.call(n,o,"recharge_expand",null,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:a,listener:this.expandArkCallback})}catch(t){console.error(t)}else d.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.expandArkCallback=function(t){console.log("expandArkCallback: ",t),"Error"!=t.toString().substr(0,5)?d.default.PopupWith2Buttons("扩建计划已启动，请稍候","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):n.default.Toast("交易失败:"+t)},t.prototype.attackIsland=function(t,e,a,n){if(window.webExtensionWallet)try{var o=new NebPay,i=l.BlockchainUrl,r=s.ContractAddress;console.log("调用钱包attack_island(",t,e,a,n);var c=JSON.stringify([t,e,a,n]);o.call(r,0,"attack_island",c,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:i,listener:this.attackIslandCallback})}catch(t){console.error(t)}else d.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.attackIslandCallback=function(t){console.log("attackIslandCallback: ",t),"Error"!=t.toString().substr(0,5)?(u.default.Instance.close(),d.default.PopupWith2Buttons("您的部队已出发","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null)):d.default.PopupWith1Button("区块链交易失败",t,"确定",null)},t.prototype.collectIslandMoney=function(t){if(window.webExtensionWallet)try{var e=new NebPay,a=l.BlockchainUrl,n=s.ContractAddress;console.log("调用钱包collect_island_money(",t);var o=JSON.stringify([t]);e.call(n,0,"collect_island_money",o,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:a,listener:this.collectIslandMoneyCallback})}catch(t){console.error(t)}else d.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.collectIslandMoneyCallback=function(t){console.log("collectIslandMoneyCallback: ",t),"Error"!=t.toString().substr(0,5)?(u.default.Instance.close(),d.default.PopupWith2Buttons("正在收取资源","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null)):d.default.PopupWith1Button("区块链交易失败",t,"确定",null)},t.encrypto=function(t,e,a){if("string"==typeof t&&"number"==typeof e&&"number"==typeof a){var n=[];a=a<=25?a:a%25;for(var o=0;o<t.length;o++){var i=t.charCodeAt(o);i=(i=1*i^e).toString(a),n.push(i)}var r=String.fromCharCode(a+97);return n.join(r)}},t.BlockchainUrl="https://testnet.nebulas.io",t.CheckWalletInterval=10,t.FetchAllDataInterval=10,t=l=__decorate([p],t);var l}(cc.Component);s.default=h,cc._RF.pop()},{"./ArkUI":"ArkUI","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./HomeUI":"HomeUI","./UI/AttackIslandPanel":"AttackIslandPanel","./UI/ToastPanel":"ToastPanel","./WorldUI":"WorldUI"}],BuildPanel:[function(t,e,a){"use strict";cc._RF.push(e,"5cf0290QotGfpJodxaDGNKp","BuildPanel"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("./DataMgr"),o=t("./BuildingButton"),i=t("./ArkUI"),r=cc._decorator,c=r.ccclass,l=r.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonContainer=null,t.buttonTemplate=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1},t.prototype.start=function(){var a=this;n.DataMgr.BuildingConfig.forEach(function(t){var e=cc.instantiate(a.buttonTemplate);e.parent=a.buttonContainer,e.getComponent(o.default).setAndRefresh(t),e.active=!0}),this.buttonTemplate.active=!1},t.prototype.onEnable=function(){},t.prototype.refresh=function(){},t.Show=function(){a.Instance.node.active=!0},t.Hide=function(){a.Instance.node.active=!1},t.prototype.onBtnExpandClick=function(){i.default.Instance.onBtnExpandClick()},t.prototype.close=function(){this.node.active=!1},__decorate([l(cc.Node)],t.prototype,"buttonContainer",void 0),__decorate([l(cc.Node)],t.prototype,"buttonTemplate",void 0),t=a=__decorate([c],t);var a}(cc.Component);a.default=s,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildingButton":"BuildingButton","./DataMgr":"DataMgr"}],BuildingButton:[function(t,e,a){"use strict";cc._RF.push(e,"7884bIsfolMCKOoH+GiGik+","BuildingButton"),Object.defineProperty(a,"__esModule",{value:!0});var l=t("./BuildPanel"),s=t("./ArkUI"),d=t("./DataMgr"),u=t("./DialogPanel"),n=t("./UI/BuildingInfoPanel"),o=cc._decorator,i=o.ccclass,r=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblSize=null,t.sprSize=null,t.lblConsumption=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(o){this.info=o,this.lblName.string=o.Name,this.lblSize.string=o.Length+"*"+o.Width,this.sprSize.setContentSize(12*o.Length,12*o.Width);for(var i=[],t=function(t){var e=o["BuildMat"+t];if(e&&0<e.length){var a=o["BuildMat"+t+"Count"],n=d.DataMgr.CargoConfig.find(function(t){return t.id==e});i.push(n.Name+"*"+a)}},e=0;e<4;e++)t(e);if(0<i.length){var a=i[0];for(e=1;e<i.length;e++){a+="\n"+i[e]}this.lblConsumption.string=a}else this.lblConsumption.string=""},t.prototype.onClick=function(){n.default.Show(this.info)},t.prototype.onBuildClick=function(){for(var t=[],e=0;e<4;e++){var a=this.info["BuildMat"+e];if(a&&0<a.length){var n=this.info["BuildMat"+e+"Count"];t.push([a,n])}}var o=!0;if(t.forEach(function(e){d.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount<e[1]&&(o=!1)}),o){var i=[];for(e=0;e<4;e++){var r=this.info["NeedTech"+e];r&&0<r.length&&i.push(r)}o=!0;var c=[];i.forEach(function(e){if(!d.DataMgr.myTechData.find(function(t){return t.id==e}).finished){o=!1;var t=d.DataMgr.TechConfig.find(function(t){return t.id==e});c.push(t.Name)}}),o?(l.default.Hide(),s.default.Instance.enterBuildMode(this.info)):u.default.PopupWith1Button("尚未研究所需科技",c.join(", "),"确定",null)}else u.default.PopupWith1Button("建筑材料不足","","确定",null)},__decorate([r(cc.Label)],t.prototype,"lblName",void 0),__decorate([r(cc.Label)],t.prototype,"lblSize",void 0),__decorate([r(cc.Node)],t.prototype,"sprSize",void 0),__decorate([r(cc.Label)],t.prototype,"lblConsumption",void 0),t=__decorate([i],t)}(cc.Component);a.default=c,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildPanel":"BuildPanel","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./UI/BuildingInfoPanel":"BuildingInfoPanel"}],BuildingInfoPanel:[function(t,e,a){"use strict";cc._RF.push(e,"3a0f2BiXhFBZ7J7uLjk6n4I","BuildingInfoPanel"),Object.defineProperty(a,"__esModule",{value:!0});var r=t("../DataMgr"),n=cc._decorator,o=n.ccclass,i=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblBuildingMat=null,t.lblHuman=null,t.lblRaw=null,t.lblOut=null,t.sprPic=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1},t.prototype.refresh=function(o){this.lblName.string=o.Name;for(var i=[],t=function(t){var e=o["BuildMat"+t];if(e&&0<e.length){var a=o["BuildMat"+t+"Count"],n=r.DataMgr.CargoConfig.find(function(t){return t.id==e});i.push(n.Name+"*"+a)}},e=0;e<4;e++)t(e);this.lblBuildingMat.string=i.join("\n"),this.lblHuman.string=o.MaxHuman,i=[];var a=function(t){var e=o["Raw"+t];if(e&&0<e.length){var a=o["Raw"+t+"Rate"],n=r.DataMgr.CargoConfig.find(function(t){return t.id==e});i.push(n.Name+"*"+a)}};for(e=0;e<4;e++)a(e);this.lblRaw.string=i.join("\n"),i=[];var n=function(t){var e=o["Out"+t];if(e&&0<e.length){var a=o["Out"+t+"Rate"],n=r.DataMgr.CargoConfig.find(function(t){return t.id==e});i.push(n.Name+"*"+a)}};for(e=0;e<4;e++)n(e);this.lblOut.string=i.join("\n")},t.Show=function(e){var t;t="string"==typeof e?r.DataMgr.BuildingConfig.find(function(t){return t.id==e}):e,a.Instance.node.active=!0,a.Instance.refresh(t)},t.prototype.close=function(){this.node.active=!1},__decorate([i(cc.Label)],t.prototype,"lblName",void 0),__decorate([i(cc.Label)],t.prototype,"lblBuildingMat",void 0),__decorate([i(cc.Label)],t.prototype,"lblHuman",void 0),__decorate([i(cc.Label)],t.prototype,"lblRaw",void 0),__decorate([i(cc.Label)],t.prototype,"lblOut",void 0),__decorate([i(cc.Sprite)],t.prototype,"sprPic",void 0),t=a=__decorate([o],t);var a}(cc.Component);a.default=c,cc._RF.pop()},{"../DataMgr":"DataMgr"}],Building:[function(t,e,a){"use strict";cc._RF.push(e,"3d090TfsndH9pF8dNZnNchl","Building"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("./ArkUI"),o=cc._decorator,i=o.ccclass,r=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t}return __extends(t,e),t.prototype.onClick=function(){n.default.Instance.selectBuilding(this)},t.prototype.setInfo=function(t,e){this.info=t,this.data=e,this.lblName&&(this.lblName.string=t.Name),this.node.setContentSize(100*t.Length,100*t.Width)},__decorate([r(cc.Label)],t.prototype,"lblName",void 0),t=__decorate([i],t)}(cc.Component);a.default=c,cc._RF.pop()},{"./ArkUI":"ArkUI"}],CurrencyFormatter:[function(t,e,a){"use strict";cc._RF.push(e,"4455937OnBAOLdRb9e7YASo","CurrencyFormatter"),Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,i=(n.property,function(){function t(){}return t.formatBTC=function(t){if(Math.abs(t)<1e-7)return"0";var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.max(0,5-e))},t.formatNAS=function(t){var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.min(4,Math.max(0,4-e)))},t.formatCNY=function(t){if(Math.abs(t)<.005)return"0";var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.min(2,Math.max(0,4-e)))},t=__decorate([o],t)}());a.default=i,cc._RF.pop()},{}],CvsMain:[function(t,e,a){"use strict";cc._RF.push(e,"69237yn4edJBK/5XvDAGlzX","CvsMain"),Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,i=n.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fitter=null,t.uiContainer=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).uiContainer.children.forEach(function(t){return t.active=!1})},t.EnterUI=function(e){this.Instance.uiContainer.children.forEach(function(t){t.getComponent(e)?t.active=!0:t.active=!1})},t.prototype.update=function(){var t=cc.view.getVisibleSize();this.lastVisibleSize&&t.equals(this.lastVisibleSize)||(t.width>=t.height?(this.fitter.rotation=0,this.fitter.scale=1,this.fitter.setContentSize(1080/t.height*t.width,1080)):(this.fitter.rotation=90,this.fitter.setContentSize(1080/t.width*t.height,1080),this.fitter.scale=t.width/1080),this.lastVisibleSize=t)},__decorate([i(cc.Node)],t.prototype,"fitter",void 0),__decorate([i(cc.Node)],t.prototype,"uiContainer",void 0),t=a=__decorate([o],t);var a}(cc.Component);a.default=r,cc._RF.pop()},{}],DataMgr:[function(t,e,a){"use strict";cc._RF.push(e,"c6c13KfXfRK06sYYQzi7BU0","DataMgr"),Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function e(){}return e.getArkSpeedByTech=function(t){return t?200:100},e.GetArkSizeByRecharge=function(t){for(var e=this.RechargeToArkSize.length-1;0<=e;e--)if(t>=this.RechargeToArkSize[e][0])return this.RechargeToArkSize[e][1]},e.readData=function(){try{var t=JSON.parse(cc.sys.localStorage.getItem("user0"));e.myData=t,e.myBuildingData=JSON.parse(cc.sys.localStorage.getItem("user0Building")),e.myCargoData=JSON.parse(cc.sys.localStorage.getItem("user0Cargo")),e.myTechData=JSON.parse(cc.sys.localStorage.getItem("user0Tech")),e.currentWorkingTech=JSON.parse(cc.sys.localStorage.getItem("user0CurrentWorkingTech")),e.changed=!0,console.log("finish read data",t)}catch(t){console.error(t)}},e.writeData=function(){try{e.myData&&(cc.sys.localStorage.setItem("user0",JSON.stringify(e.myData)),cc.sys.localStorage.setItem("user0Building",JSON.stringify(e.myBuildingData)),cc.sys.localStorage.setItem("user0Cargo",JSON.stringify(e.myCargoData)),cc.sys.localStorage.setItem("user0Tech",JSON.stringify(e.myTechData)),cc.sys.localStorage.setItem("user0CurrentWorkingTech",JSON.stringify(e.currentWorkingTech)),this.autosaveCountdown+=15,console.log("finish write data",e.myBuildingData))}catch(t){console.error(t)}},e.clearData=function(){cc.sys.localStorage.removeItem("user0"),cc.sys.localStorage.removeItem("user0Building")},e.idleWorkers=0,e.populationLimit=0,e.aboveIronMine=!1,e.othersData={},e.allIslandData={},e.changed=!1,e.populationGrowPerMin=0,e.researchRatePerMin=0,e.outputRates={},e.SmallArkSize=7,e.StdArkSize=9,e.LargeArkSize=21,e.MethaneCostPerKmPerSize=.01,e.RechargeToArkSize=[[0,9],[.001,13],[.006,17],[.01,21],[.1,25],[1,30],[4,35]],e.autosaveCountdown=15,e}();a.DataMgr=n;var o=function(){this.currentLocation=cc.Vec2.ZERO,this.population=8,this.speed=0};a.UserData=o;var i=function(){};a.BuildingInfo=i;var r=function(){this.workers=0,this.isWorking=!1};a.BuildingData=r;var c=function(){};a.CargoInfo=c;var l=function(){this.amount=0};a.CargoData=l;var s=function(){};a.TechInfo=s;var d=function(){};a.TechData=d;var u=function(){};a.MineInfo=u;var p=function(){this.tankPower=0,this.chopperPower=0,this.shipPower=0,this.money=0,this.sponsorName="",this.miningRate=.02,this.balanceMap=0};a.IslandData=p;var h=function(){function e(){this.i=0,this.j=0}return e.prototype.clone=function(){var t=new e;return t.i=this.i,t.j=this.j,t},Object.defineProperty(e,"ZERO",{get:function(){return new e},enumerable:!0,configurable:!0}),e}();a.IJ=h,cc._RF.pop()},{}],DialogPanel:[function(t,e,a){"use strict";cc._RF.push(e,"c0958fmSyFAp6wyHbHS0e10","DialogPanel"),Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,i=n.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblTitle=null,t.lblContext=null,t.btn0=null,t.lblBtn0=null,t.btn1=null,t.lblBtn1=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).hide()},t.PopupWith1Button=function(t,e,a,n){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=a,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(0,0),this.Instance.btn1.active=!1},t.PopupWith2Buttons=function(t,e,a,n,o,i){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=a,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(-150,0),this.Instance.func1=i,this.Instance.lblBtn1.string=o,this.Instance.btn1.active=!0,this.Instance.btn1.position=new cc.Vec2(150,0)},t.prototype.onBtn0Click=function(){this.func0&&this.func0(),this.hide()},t.prototype.onBtn1Click=function(){this.func1&&this.func1(),this.hide()},t.prototype.show=function(){this.node.active=!0},t.prototype.hide=function(){this.node.active=!1},__decorate([i(cc.Label)],t.prototype,"lblTitle",void 0),__decorate([i(cc.Label)],t.prototype,"lblContext",void 0),__decorate([i(cc.Node)],t.prototype,"btn0",void 0),__decorate([i(cc.Label)],t.prototype,"lblBtn0",void 0),__decorate([i(cc.Node)],t.prototype,"btn1",void 0),__decorate([i(cc.Label)],t.prototype,"lblBtn1",void 0),t=a=__decorate([o],t);var a}(cc.Component);a.default=r,cc._RF.pop()},{}],EditNicknamePanel:[function(t,e,a){"use strict";cc._RF.push(e,"abc4c7by+pEG49b6MBNEz6Y","EditNicknamePanel"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("../DataMgr"),o=t("./ToastPanel"),i=t("../HomeUI"),r=cc._decorator,c=r.ccclass,l=r.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.edtNickname=null,t.flagContainer=null,t.flagTemplate=null,t.selectFrame=null,t.flagNames=["chn","usa","jap","kor"],t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1,this.init()},t.prototype.init=function(){var n=this;this.flagTemplate.active=!0,this.flagNames.forEach(function(t){var e=cc.instantiate(n.flagTemplate);e.name=t,e.parent=n.flagContainer;var a=e.getComponent(cc.Sprite);cc.loader.loadRes("flags/"+t,cc.SpriteFrame,function(t,e){a.spriteFrame=e}),e.on(cc.Node.EventType.TOUCH_END,function(){return n.onFlagClick(e)})}),this.flagTemplate.active=!1},t.prototype.onEnable=function(){var e=this;this.edtNickname.string=n.DataMgr.myData?n.DataMgr.myData.nickname:i.default.Instance.lblNickname.string,this.selectedCountry=i.default.Instance.country?i.default.Instance.country:n.DataMgr.myData?n.DataMgr.myData.country:null;var t=this.flagContainer.children.find(function(t){return t.name==e.selectedCountry});t?(this.selectFrame.active=!0,this.selectFrame.position=this.selectFrame.parent.convertToNodeSpaceAR(this.flagContainer.convertToWorldSpaceAR(t.position))):this.selectFrame.active=!1},t.prototype.onFlagClick=function(t){this.selectFrame.active=!0,this.selectFrame.position=this.selectFrame.parent.convertToNodeSpaceAR(this.flagContainer.convertToWorldSpaceAR(t.position)),this.selectedCountry=t.name},t.prototype.onConfirmClick=function(){n.DataMgr.myData&&(n.DataMgr.myData.nickname=this.edtNickname.string,n.DataMgr.myData.country=this.selectedCountry),i.default.Instance.lblNickname.string=this.edtNickname.string,i.default.Instance.country=this.selectedCountry,o.default.Toast("昵称、国家设置成功"),this.close()},t.prototype.close=function(){this.node.active=!1},__decorate([l(cc.EditBox)],t.prototype,"edtNickname",void 0),__decorate([l(cc.Node)],t.prototype,"flagContainer",void 0),__decorate([l(cc.Node)],t.prototype,"flagTemplate",void 0),__decorate([l(cc.Node)],t.prototype,"selectFrame",void 0),t=a=__decorate([c],t);var a}(cc.Component);a.default=s,cc._RF.pop()},{"../DataMgr":"DataMgr","../HomeUI":"HomeUI","./ToastPanel":"ToastPanel"}],Foreground:[function(t,e,a){"use strict";cc._RF.push(e,"c7a1eqdirtJGpHjde8W3SsV","Foreground"),Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,i=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.node.children.forEach(function(t){t.active||(t.active=!0,t.active=!1)})},e=__decorate([o],e)}(cc.Component));a.default=i,cc._RF.pop()},{}],HomeUI:[function(t,e,a){"use strict";cc._RF.push(e,"458fd6d6ChEGo+U+drv+haG","HomeUI"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("./CvsMain"),o=t("./BaseUI"),i=t("./MainCtrl"),r=t("./DataMgr"),c=t("./WorldUI"),l=t("./UI/ToastPanel"),s=t("./BlockchainMgr"),d=t("./DialogPanel"),u=t("./UI/EditNicknamePanel"),p=cc._decorator,h=p.ccclass,f=p.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnClaim0=null,t.btnClaim1=null,t.btnClaim2=null,t.lblNickname=null,t.sprFlag=null,t.lblBlockchainAddress=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){a.Instance=this},t.prototype.start=function(){l.default.Toast("正在读取您的钱包信息，如果您在用钱包玩游戏，请稍候")},t.prototype.update=function(){this.lblBlockchainAddress.string=s.default.WalletAddress?s.default.WalletAddress:"未获取到钱包地址",r.DataMgr.myData?(this.btnClaim0.getComponentInChildren(cc.Label).string=r.DataMgr.myData.arkSize<r.DataMgr.StdArkSize?"进入":"无法领取",this.btnClaim1.getComponentInChildren(cc.Label).string=r.DataMgr.myData.arkSize<r.DataMgr.StdArkSize?"领取":r.DataMgr.myData.arkSize<r.DataMgr.LargeArkSize?"进入":"无法领取",this.btnClaim2.getComponentInChildren(cc.Label).string=r.DataMgr.myData.arkSize<r.DataMgr.StdArkSize?"领取":r.DataMgr.myData.arkSize<r.DataMgr.LargeArkSize?"无法领取":"进入",this.btnClaim0.interactable=r.DataMgr.myData.arkSize<r.DataMgr.StdArkSize,this.btnClaim1.interactable=r.DataMgr.myData.arkSize<r.DataMgr.LargeArkSize,this.btnClaim2.interactable=r.DataMgr.myData.arkSize<r.DataMgr.StdArkSize||r.DataMgr.myData.arkSize>=r.DataMgr.LargeArkSize,r.DataMgr.myData.nickname&&(this.lblNickname.string=r.DataMgr.myData.nickname),r.DataMgr.myData.country&&(this.country=r.DataMgr.myData.country)):(this.btnClaim0.getComponentInChildren(cc.Label).string="领取",this.btnClaim1.getComponentInChildren(cc.Label).string="领取",this.btnClaim2.getComponentInChildren(cc.Label).string="领取");var a=this;this.country&&this.sprFlag.spriteFrame.name!=this.country&&cc.loader.loadRes("flags/"+this.country,cc.SpriteFrame,function(t,e){a.sprFlag.spriteFrame=e})},t.prototype.onClaim=function(t,e){if(this.lblNickname.string&&this.country)if(r.DataMgr.myData)switch(e){case"0":r.DataMgr.myData.arkSize<r.DataMgr.StdArkSize&&n.default.EnterUI(c.default);break;case"1":r.DataMgr.myData.arkSize<r.DataMgr.StdArkSize?s.default.Instance.claimArk(0):r.DataMgr.myData.arkSize<r.DataMgr.LargeArkSize&&n.default.EnterUI(c.default);break;case"2":r.DataMgr.myData.arkSize<r.DataMgr.StdArkSize?s.default.Instance.claimArk(.1):r.DataMgr.myData.arkSize>=r.DataMgr.LargeArkSize&&n.default.EnterUI(c.default)}else switch(e){case"0":r.DataMgr.myData=i.default.Instance.generateSmallArkData(),l.default.Toast("领取成功，可进入方舟");break;case"1":s.default.Instance.claimArk(0);break;case"2":s.default.Instance.claimArk(.01)}else d.default.PopupWith1Button("请设置国旗和昵称","找不到自己的国家？可以用联合国的旗帜哦。","确定",null)},t.prototype.onBtnEditNicknameClick=function(){u.default.Instance.node.active=!0},t.prototype.onBtnSponsorClick=function(){},t.prototype.onAddressClick=function(){window.open("https://explorer.nebulas.io/address/"+s.default.WalletAddress)},t.prototype.onBookClick=function(){console.log("哪有白皮书")},t.prototype.onBtnClearStorageClick=function(){cc.sys.localStorage.clear(),console.log("成功清除存储")},__decorate([f(cc.Button)],t.prototype,"btnClaim0",void 0),__decorate([f(cc.Button)],t.prototype,"btnClaim1",void 0),__decorate([f(cc.Button)],t.prototype,"btnClaim2",void 0),__decorate([f(cc.Label)],t.prototype,"lblNickname",void 0),__decorate([f(cc.Sprite)],t.prototype,"sprFlag",void 0),__decorate([f(cc.Label)],t.prototype,"lblBlockchainAddress",void 0),t=a=__decorate([h],t);var a}(o.default);a.default=g,cc._RF.pop()},{"./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./MainCtrl":"MainCtrl","./UI/EditNicknamePanel":"EditNicknamePanel","./UI/ToastPanel":"ToastPanel","./WorldUI":"WorldUI"}],HouseBuilding:[function(t,e,a){"use strict";cc._RF.push(e,"4551bhwrptGmI96ad9hW5WZ","HouseBuilding"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("./Building"),o=cc._decorator,i=o.ccclass,r=o.property,c=function(a){function t(){var t=null!==a&&a.apply(this,arguments)||this;return t.lblPopulation=null,t}return __extends(t,a),t.prototype.setInfo=function(t,e){a.prototype.setInfo.call(this,t,e),this.lblPopulation.string=t.Arg0},__decorate([r(cc.Label)],t.prototype,"lblPopulation",void 0),t=__decorate([i],t)}(n.default);a.default=c,cc._RF.pop()},{"./Building":"Building"}],IntroUI:[function(t,e,a){"use strict";cc._RF.push(e,"09076VctrZEVKhEeIiQ5hEn","IntroUI"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("../CvsMain"),o=t("../HomeUI"),i=cc._decorator,r=i.ccclass,c=(i.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onBtnStartClick=function(){n.default.EnterUI(o.default)},e=__decorate([r],e)}(cc.Component));a.default=c,cc._RF.pop()},{"../CvsMain":"CvsMain","../HomeUI":"HomeUI"}],IronMine:[function(t,e,a){"use strict";cc._RF.push(e,"ff0cb7j7qpO/Yov9EsIMZAo","IronMine"),Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,i=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){if(this.gra=this.getComponent(cc.Graphics),this.col=this.getComponent(cc.PolygonCollider),3<=this.col.points.length&&this.gra){this.gra.moveTo(this.col.points[0].x,this.col.points[0].y);for(var t=1;t<this.col.points.length;t++){var e=this.col.points[t];this.gra.lineTo(e.x,e.y)}this.gra.close(),this.gra.fill()}},e=__decorate([o],e)}(cc.Component));a.default=i,cc._RF.pop()},{}],Island:[function(t,e,a){"use strict";cc._RF.push(e,"d5cb37wYS9LEY2kNMygFSvm","Island"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("../DataMgr"),o=t("../MainCtrl"),i=t("../Utils/CurrencyFormatter"),r=t("../WorldUI"),c=cc._decorator,l=c.ccclass,s=c.property,d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblLeftMoney=null,t.lblMiningSpeed=null,t.lblOccupant=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.btnNode=new cc.Node,this.btnNode.parent=this.node,this.btnNode.on(cc.Node.EventType.TOUCH_END,this.onClick.bind(this))},t.prototype.setData=function(t){this.data=t},t.prototype.update=function(){o.default.Ticks%60==0&&this.refresh(),this.node.position=this.data.location.mul(r.default.Instance.zoomScale)},t.prototype.refresh=function(){if(this.data){this.lblName.string=this.data.sponsorName+" 资源岛",this.lblLeftMoney.string="当前储量"+i.default.formatNAS(this.data.money/1e18)+"NAS";var t=this.data.miningRate*this.data.money/1e18;if(this.lblMiningSpeed.string="采集速度"+i.default.formatNAS(t)+"NAS/小时",this.data.occupant&&0<this.data.occupant.length){var e=this.data.occupant==n.DataMgr.myData.address?n.DataMgr.myData:n.DataMgr.othersData[this.data.occupant];this.lblOccupant.string="占领者 "+(e?e.nickname:this.data.occupant)}else this.lblOccupant.string="无人占领";this.btnNode.setContentSize(this.node.width+50,this.node.height+50)}},t.prototype.onLinkClick=function(){var t=this.data.sponsorLink;t&&0<t.length&&window.open(t)},t.prototype.onClick=function(){r.default.Instance.selectIsland(this.node)},__decorate([s(cc.Label)],t.prototype,"lblName",void 0),__decorate([s(cc.Label)],t.prototype,"lblLeftMoney",void 0),__decorate([s(cc.Label)],t.prototype,"lblMiningSpeed",void 0),__decorate([s(cc.Label)],t.prototype,"lblOccupant",void 0),t=__decorate([l],t)}(cc.Component);a.default=d,cc._RF.pop()},{"../DataMgr":"DataMgr","../MainCtrl":"MainCtrl","../Utils/CurrencyFormatter":"CurrencyFormatter","../WorldUI":"WorldUI"}],MainCtrl:[function(t,e,a){"use strict";cc._RF.push(e,"162b9/mIe1LjqpHBpjQnzp+","MainCtrl"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("./CvsMain"),o=t("./HomeUI"),f=t("./DataMgr"),i=t("./WorldUI"),r=t("./UI/IntroUI"),c=t("./World/Island"),g=t("./UI/ToastPanel"),l=cc._decorator,d=l.ccclass,s=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),(s=e).prototype.onLoad=function(){s.Instance=this,f.DataMgr.readData(),n.default.Instance.uiContainer.getChildByName("WorldUI").active=!0,cc.loader.loadRes("Building",function(t,e){console.log("Building loaded",e),f.DataMgr.BuildingConfig=e,f.DataMgr.myBuildingData||(f.DataMgr.myBuildingData=[])}.bind(this)),cc.loader.loadRes("Cargo",function(t,e){console.log("Cargo loaded",e,f.DataMgr.myCargoData),f.DataMgr.CargoConfig=e,f.DataMgr.myCargoData||(f.DataMgr.myCargoData=[],f.DataMgr.CargoConfig.forEach(function(t){var e=new f.CargoData;e.id=t.id,e.amount=0,f.DataMgr.myCargoData.push(e)}))}.bind(this)),cc.loader.loadRes("Tech",function(t,e){console.log("Tech loaded",e,f.DataMgr.myTechData),f.DataMgr.TechConfig=e,f.DataMgr.myTechData||(f.DataMgr.myTechData=[],f.DataMgr.TechConfig.forEach(function(t){var e=new f.TechData;e.id=t.id,e.filledWork=0,e.finished=!1,f.DataMgr.myTechData.push(e)}))}.bind(this))},e.prototype.start=function(){n.default.EnterUI(r.default),f.DataMgr.IronMineConfig=[],i.default.Instance.mineContainer.children.forEach(function(t){var e=t.getComponent(cc.PolygonCollider);if(e){var a=new f.MineInfo;a.polygonCollider=e;var n=[];e.points.forEach(function(t){n.push(e.node.position.add(e.offset).add(t))}),a.points=n,f.DataMgr.IronMineConfig.push(a)}}),i.default.Instance.islandContainer.children.forEach(function(t){var e=t.getComponent(c.default),a=new f.IslandData;a.id=parseInt(e.name),a.location=e.node.position,f.DataMgr.allIslandData[a.id]=a,e.setData(a)})},e.prototype.gotoHome=function(){n.default.EnterUI(o.default)},e.prototype.generateSmallArkData=function(){var t=new f.UserData;t.arkSize=f.DataMgr.SmallArkSize;var e=Math.random()*Math.PI;return t.locationX=4e3*Math.cos(e),t.locationY=4e3*Math.sin(e),t.speed=0,t.nickname=o.default.Instance.lblNickname.string,t.country=o.default.Instance.country,this.calcSail(t),t},e.prototype.update=function(u){var p=this;if(f.DataMgr.BuildingConfig&&f.DataMgr.TechConfig&&f.DataMgr.CargoConfig){if(f.DataMgr.myData){f.DataMgr.populationLimit=0,f.DataMgr.researchRatePerMin=0,f.DataMgr.aboveIronMine=!1,f.DataMgr.outputRates={};var h=0;for(var t in this.calcSail(f.DataMgr.myData),f.DataMgr.othersData)this.calcSail(f.DataMgr.othersData[t]);if(f.DataMgr.IronMineConfig.forEach(function(t){cc.Intersection.pointInPolygon(f.DataMgr.myData.currentLocation,t.points)&&(f.DataMgr.aboveIronMine=!0)}),f.DataMgr.myBuildingData&&f.DataMgr.myBuildingData.forEach(function(o){if(o.isWorking=!1,h+=o.workers,p.isHouse(o.id)){var i=f.DataMgr.BuildingConfig.find(function(t){return t.id==o.id});f.DataMgr.populationLimit+=parseInt(i.Arg0)}else if("research239"==o.id){if(f.DataMgr.currentWorkingTech){var t=f.DataMgr.TechConfig.find(function(t){return t.id==f.DataMgr.currentWorkingTech}),e=f.DataMgr.myTechData.find(function(t){return t.id==f.DataMgr.currentWorkingTech}),a=Math.min(t.Work-e.filledWork,1*o.workers/60*u);e.filledWork+=a,e.filledWork>=t.Work&&(e.finished=!0,f.DataMgr.currentWorkingTech=null,g.default.Toast("新科技研究完成，请制定下一个研究计划")),f.DataMgr.researchRatePerMin+=1*o.workers}}else{if(o.workers<=0)return;i=f.DataMgr.BuildingConfig.find(function(t){return t.id==o.id});for(var n=[],r=0;r<4;r++){var c=i["Raw"+r];if(c&&0<c.length){var l=i["Raw"+r+"Rate"]/i.MaxHuman*o.workers;n.push([c,l/60*u]),f.DataMgr.outputRates[c]||(f.DataMgr.outputRates[c]=0),f.DataMgr.outputRates[c]-=l}}var s=!0;if(n.forEach(function(e){if(s){var t=f.DataMgr.myCargoData.find(function(t){return t.id==e[0]});t&&t.amount>e[1]?e.push(t):s=!1}}),s){n.forEach(function(t){t[2].amount-=t[1]});var d=function(t){var e=i["Out"+t];if(e&&0<e.length){var a=f.DataMgr.myCargoData.find(function(t){return t.id==e});a||((a=new f.CargoData).id=e,a.amount=0,f.DataMgr.myCargoData.push(a));var n=i["Out"+t+"Rate"]/i.MaxHuman*o.workers;a.amount+=n/60*u,f.DataMgr.outputRates[e]||(f.DataMgr.outputRates[e]=0),f.DataMgr.outputRates[e]+=n}};for(r=0;r<4;r++)d(r);o.isWorking=!0}}}),f.DataMgr.idleWorkers=f.DataMgr.myData.population-h,f.DataMgr.myData&&f.DataMgr.myCargoData){var e=1*f.DataMgr.myData.population,n=e/60*u;f.DataMgr.outputRates.fish34509||(f.DataMgr.outputRates.fish34509=0),f.DataMgr.outputRates.fish34509-=e;var a=n;if(f.DataMgr.CargoConfig.forEach(function(e){if("TRUE"==e.IsFood){var t=f.DataMgr.myCargoData.find(function(t){return t.id==e.id});if(t&&0<t.amount){var a=Math.min(n,t.amount);n-=a,t.amount-=a}}}),n<=0&&f.DataMgr.myData.population<f.DataMgr.populationLimit){var o=(10+Math.sqrt(f.DataMgr.myData.population))/10*30,i=o/60*u;Math.random()<i&&(f.DataMgr.myData.population+=1,f.DataMgr.idleWorkers+=1),f.DataMgr.populationGrowPerMin=o}else if(0<n){var r=n/a,c=Math.max(0,f.DataMgr.myData.population-10)*r;i=c/60*u;if(Math.random()<i)if(0<f.DataMgr.idleWorkers)f.DataMgr.myData.population-=1,f.DataMgr.idleWorkers-=1;else{var l=f.DataMgr.myBuildingData.filter(function(t){return 0<t.workers&&"fisher8032"!=t.id});if(0<l.length)l[Math.floor(Math.random()*l.length)].workers-=1,f.DataMgr.myData.population-=1}f.DataMgr.populationGrowPerMin=-c}else f.DataMgr.populationGrowPerMin=0}f.DataMgr.autosaveCountdown<=0&&f.DataMgr.writeData()}f.DataMgr.autosaveCountdown-=u,s.Ticks++}},e.prototype.calcSail=function(t){if(t.speed&&0<t.speed&&t.destinationX&&t.destinationY){var e=t.lastLocationTime,a=Number(new Date),n=new cc.Vec2(t.locationX,t.locationY),o=new cc.Vec2(t.destinationX,t.destinationY),i=o.sub(n).mag()/(t.speed/60)*1e3,r=s.lerpVec2(n,o,(a-e)/i,!0);t.currentLocation=r}else t.currentLocation=new cc.Vec2(t.locationX,t.locationY)},e.lerp=function(t,e,a,n){return n&&(a=Math.max(0,Math.min(1,a))),t*(1-a)+e*a},e.lerpVec2=function(t,e,a,n){return n&&(a=Math.max(0,Math.min(1,a))),t.mul(1-a).add(e.mul(a))},e.prototype.isHouse=function(t){return"dorm08821"==t||"house8523"==t},e.Ticks=0,e=s=__decorate([d],e);var s}(cc.Component));a.default=s,cc._RF.pop()},{"./CvsMain":"CvsMain","./DataMgr":"DataMgr","./HomeUI":"HomeUI","./UI/IntroUI":"IntroUI","./UI/ToastPanel":"ToastPanel","./World/Island":"Island","./WorldUI":"WorldUI"}],Road:[function(t,e,a){"use strict";cc._RF.push(e,"57853rAZexG4pEfR+Uh0ALl","Road"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("./Building"),o=cc._decorator,i=o.ccclass,r=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([i],e)}(n.default));a.default=r,cc._RF.pop()},{"./Building":"Building"}],TaskMgr:[function(t,e,a){"use strict";cc._RF.push(e,"8b016C7S51BeY/RKmLSDzh4","TaskMgr"),Object.defineProperty(a,"__esModule",{value:!0});var n=function(){function t(){}return t.list=[{description:"",func:function(){}}],t}();a.default=n,cc._RF.pop()},{}],TechButton:[function(t,e,a){"use strict";cc._RF.push(e,"381b4B+yDRNAIom8tWyu99R","TechButton"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("./DataMgr"),o=cc._decorator,i=o.ccclass,r=o.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblWork=null,t.prgWork=null,t.gear=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(t,e){this.info=t,this.lblName.string=t.Name,this.lblWork.string=t.Work.toString(),this.data=e,this.prgWork.progress=e.filledWork/t.Work},t.prototype.update=function(t){this.prgWork.progress=this.data.filledWork/this.info.Work,n.DataMgr.currentWorkingTech==this.info.id?(this.gear.active=!0,this.gear.rotation+=18*n.DataMgr.researchRatePerMin*t):this.gear.active=!1},t.prototype.onClick=function(){n.DataMgr.currentWorkingTech!=this.info.id?n.DataMgr.currentWorkingTech=this.info.id:n.DataMgr.currentWorkingTech=null},__decorate([r(cc.Label)],t.prototype,"lblName",void 0),__decorate([r(cc.Label)],t.prototype,"lblWork",void 0),__decorate([r(cc.ProgressBar)],t.prototype,"prgWork",void 0),__decorate([r(cc.Node)],t.prototype,"gear",void 0),t=__decorate([i],t)}(cc.Component);a.default=c,cc._RF.pop()},{"./DataMgr":"DataMgr"}],TechPanel:[function(t,e,a){"use strict";cc._RF.push(e,"3402dUp2TBLFIsk2dVlT1d5","TechPanel"),Object.defineProperty(a,"__esModule",{value:!0});var i=t("./DataMgr"),r=t("./TechButton"),n=cc._decorator,o=n.ccclass,c=n.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonContainer=null,t.buttonTemplate=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){(a.Instance=this).node.active=!1},t.prototype.start=function(){var o=this;i.DataMgr.TechConfig.forEach(function(e){var t=cc.instantiate(o.buttonTemplate);t.parent=o.buttonContainer;var a=t.getComponent(r.default),n=i.DataMgr.myTechData.find(function(t){return t.id==e.id});a.setAndRefresh(e,n),t.active=!0}),this.buttonTemplate.active=!1},t.prototype.onEnable=function(){},t.prototype.refresh=function(){},t.Show=function(){a.Instance.node.active=!0},t.Hide=function(){a.Instance.node.active=!1},t.prototype.close=function(){this.node.active=!1},__decorate([c(cc.Node)],t.prototype,"buttonContainer",void 0),__decorate([c(cc.Node)],t.prototype,"buttonTemplate",void 0),t=a=__decorate([o],t);var a}(cc.Component);a.default=l,cc._RF.pop()},{"./DataMgr":"DataMgr","./TechButton":"TechButton"}],ToastPanel:[function(t,e,a){"use strict";cc._RF.push(e,"159ccmVx0JBF6iFx9aAYPqK","ToastPanel"),Object.defineProperty(a,"__esModule",{value:!0});var n=cc._decorator,o=n.ccclass,i=n.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.toastTemplate=null,t.container=null,t}return __extends(t,e),(n=t).prototype.onLoad=function(){(n.Instance=this).toastTemplate.active=!1},t.prototype.toast=function(t){var e=cc.instantiate(n.Instance.toastTemplate);e.parent=this.container,e.getComponent(cc.Label).string=t,e.active=!0;var a=cc.sequence(cc.delayTime(4.5),cc.fadeOut(.5));e.runAction(a),setTimeout(function(){e.destroy()},5e3)},t.Toast=function(t){n.Instance.toast(t)},__decorate([i(cc.Node)],t.prototype,"toastTemplate",void 0),__decorate([i(cc.Node)],t.prototype,"container",void 0),t=n=__decorate([o],t);var n}(cc.Component);a.default=r,cc._RF.pop()},{}],WorkshopBuilding:[function(t,e,a){"use strict";cc._RF.push(e,"2ffd4wRHIRBKbqpQioNYuQn","WorkshopBuilding"),Object.defineProperty(a,"__esModule",{value:!0});var s=t("./DataMgr"),n=t("./Building"),o=t("./MainCtrl"),i=cc._decorator,r=i.ccclass,c=i.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblConsumption=null,t.lblOutput=null,t.lblWorkers=null,t.nodeGear=null,t.btnDecWork=null,t.btnIncWork=null,t}return __extends(t,e),t.prototype.setInfo=function(t,e){this.info=t,this.data=e,this.lblName.string=t.Name,this.node.setContentSize(100*t.Length,100*t.Width),this.refresh()},t.prototype.changeWorkers=function(t,e){if("-"==e){var a=Math.min(this.data.workers,1);this.data.workers-=a,s.DataMgr.idleWorkers+=a}else if("+"==e){var n=Math.min(s.DataMgr.idleWorkers,1,this.info.MaxHuman-this.data.workers);this.data.workers+=n,s.DataMgr.idleWorkers-=n}this.refresh()},t.prototype.update=function(t){this.lblWorkers.string="人"+this.data.workers.toFixed()+"/"+this.info.MaxHuman,"research239"==this.data.id?0<this.data.workers&&s.DataMgr.currentWorkingTech&&(this.nodeGear.rotation+=360*this.data.workers/this.info.MaxHuman*t):this.data.isWorking&&(this.nodeGear.rotation+=360*this.data.workers/this.info.MaxHuman*t),this.btnDecWork.interactable=0<this.data.workers,this.btnIncWork.interactable=this.data.workers<this.info.MaxHuman,o.default.Ticks%200==0&&this.refresh()},t.prototype.refresh=function(){for(var i=this.info,r=[],t=function(t){var e=i["Raw"+t];if(e&&0<e.length){var a=i["Raw"+t+"Rate"],n=s.DataMgr.CargoConfig.find(function(t){return t.id==e}),o=Math.round(a*c.data.workers/c.info.MaxHuman*10)/10;r.push("消耗 "+o+n.Name+"/min")}},c=this,e=0;e<4;e++)t(e);var a=function(t){var e=i["Out"+t];if(e&&0<e.length){var a=i["Out"+t+"Rate"],n=s.DataMgr.CargoConfig.find(function(t){return t.id==e}),o=Math.round(a*l.data.workers/l.info.MaxHuman*10)/10;r.push("生产 "+o+n.Name+"/min")}},l=this;for(e=0;e<4;e++)a(e);if(0<r.length){var n=r[0];for(e=1;e<r.length;e++){n+="\n"+r[e]}this.lblConsumption.string=n}else this.lblConsumption.string=""},__decorate([c(cc.Label)],t.prototype,"lblConsumption",void 0),__decorate([c(cc.Label)],t.prototype,"lblOutput",void 0),__decorate([c(cc.Label)],t.prototype,"lblWorkers",void 0),__decorate([c(cc.Node)],t.prototype,"nodeGear",void 0),__decorate([c(cc.Button)],t.prototype,"btnDecWork",void 0),__decorate([c(cc.Button)],t.prototype,"btnIncWork",void 0),t=__decorate([r],t)}(n.default);a.default=l,cc._RF.pop()},{"./Building":"Building","./DataMgr":"DataMgr","./MainCtrl":"MainCtrl"}],WorldUI:[function(t,e,a){"use strict";cc._RF.push(e,"d2d4ehqPFVDS4fv9l1Oq7He","WorldUI"),Object.defineProperty(a,"__esModule",{value:!0});var n=t("./CvsMain"),o=t("./BaseUI"),g=t("./MainCtrl"),i=t("./ArkUI"),m=t("./ArkInWorld"),y=t("./DataMgr"),c=t("./BlockchainMgr"),r=t("./HomeUI"),M=t("./World/Island"),l=t("./UI/AttackIslandPanel"),s=t("./DialogPanel"),D=t("./Utils/CurrencyFormatter"),d=cc._decorator,u=d.ccclass,p=d.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mineContainer=null,t.islandContainer=null,t.arkContainer=null,t.arkTemplate=null,t.worldMap=null,t.earth=null,t.grpSelectObject=null,t.selectFrame=null,t.btnSponsorLink=null,t.lblAttackButton=null,t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=.1,t.editSailDestinationMode=!1,t.grpSail=null,t.sailDestinationIndicator=null,t.lblDestinationInfo=null,t.btnCancelSail=null,t.btnConfirmSail=null,t}return __extends(t,e),(a=t).prototype.onLoad=function(){var e=a.Instance=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.panPad.on(cc.Node.EventType.TOUCH_END,this.onPanPadTouchEnd,this)},t.prototype.onEnable=function(){this.editSailDestinationMode=!1,this.selectedObjectNode=null,y.DataMgr.myData&&(this.refreshData(),this.refreshZoom())},t.prototype.onBtnBackClick=function(){n.default.EnterUI(r.default)},t.prototype.refreshData=function(){for(var t=Object.keys(y.DataMgr.othersData).length+1,e=this.arkContainer.childrenCount;e<t;e++){cc.instantiate(this.arkTemplate).parent=this.arkContainer}for(var a=[],n=t;n<this.arkContainer.childrenCount;n++)a.push(this.arkContainer.children[n]);a.forEach(function(t){return t.destroy()}),this.arkContainer.children[0].getComponent(m.default).setAndRefresh(y.DataMgr.myData,this.zoomScale);var o=0;for(var i in y.DataMgr.othersData){var r=y.DataMgr.othersData[i];this.arkContainer.children[o+1].getComponent(m.default).setAndRefresh(r,this.zoomScale),o++}},t.prototype.refreshMyArk=function(){this.arkContainer.children[0].getComponent(m.default).setAndRefresh(y.DataMgr.myData,this.zoomScale)},t.prototype.refreshZoom=function(){this.earth.scale=this.zoomScale,this.editSailDestinationMode&&this.newDestination&&(this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale))},t.prototype.update=function(t){(y.DataMgr.changed||g.default.Ticks%100==0)&&(this.refreshData(),y.DataMgr.changed=!1);var e=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<e?((e-=5*t)<.5&&(e=.5),this.sldZoom.progress=e):e<.5&&(.5<(e+=5*t)&&(e=.5),this.sldZoom.progress=e)),.5!=e){var a=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(e-.5)*5*t),this.clampZoom();var n=this.zoomScale/a;this.worldMap.position=this.worldMap.position.mul(n),this.refreshZoom()}if(this.selectedObjectNode){this.selectFrame.active=!0,this.selectFrame.position=this.selectedObjectNode.position,this.selectFrame.setContentSize(2*this.selectedObjectNode.width,2*this.selectedObjectNode.height);var o=this.selectedObjectNode.getComponent(m.default),i=this.selectedObjectNode.getComponent(M.default);if(o)this.grpSelectObject.active=!1;else if(i){if(this.btnSponsorLink.getComponentInChildren(cc.Label).string=i.data.sponsorName?i.data.sponsorName:"无赞助商",i.data.occupant&&i.data.occupant==y.DataMgr.myData.address){var r=i.data.lastMineTime,c=(Number(new Date)-r)/1e3/86400,l=i.data.miningRate,s=i.data.money*(1-Math.exp(-l*c));this.lblAttackButton.string="收取\n"+D.default.formatNAS(s)+"NAS"}else this.lblAttackButton.string="攻占";this.grpSelectObject.active=!0}}else this.selectFrame.active=!1,this.grpSelectObject.active=!1;if(this.editSailDestinationMode){if(this.grpSail.active=!0,this.sailDestinationIndicator.active=null!=this.newDestination,this.newDestination){var d=new cc.Vec2(y.DataMgr.myData.currentLocation.x,y.DataMgr.myData.currentLocation.y),u=this.newDestination.sub(d).mag(),p=u/y.DataMgr.myData.speed,h=y.DataMgr.MethaneCostPerKmPerSize*u*y.DataMgr.myData.arkSize,f=u.toFixed()+"km\n"+p.toFixed()+"min\n"+h.toFixed()+"甲烷";this.lblDestinationInfo.string=f}}else this.grpSail.active=!1,this.sailDestinationIndicator.active=!1},t.prototype.onGotoArkClick=function(){n.default.EnterUI(i.default)},t.prototype.onCenterBtnClick=function(){var t=y.DataMgr.myData.currentLocation;t.mulSelf(this.zoomScale),this.worldMap.position=t.neg()},t.prototype.onPanPadTouchMove=function(t){var e=t.getDelta();this.worldMap.position=this.worldMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onPanPadTouchEnd=function(t){if(this.editSailDestinationMode){var e=t.getLocation();if(new cc.Vec2(e.x,e.y).sub(t.getStartLocation()).mag()<20){var a=this.worldMap.convertTouchToNodeSpaceAR(t.touch);this.newDestination=a.mul(1/this.zoomScale),this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale)}}if(this.selectedObjectNode){e=t.getLocation();new cc.Vec2(e.x,e.y).sub(t.getStartLocation()).mag()<20&&this.cancelSelectObject()}},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),a=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/a;this.worldMap.position=this.worldMap.position.mul(n),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){10<this.zoomScale&&(this.zoomScale=10),this.zoomScale<.01&&(this.zoomScale=.01)},t.prototype.selectArk=function(t){this.selectedObjectNode=t,this.editSailDestinationMode=!1},t.prototype.selectIsland=function(t){this.selectedObjectNode=t,this.editSailDestinationMode=!1},t.prototype.cancelSelectObject=function(){this.selectedObjectNode=null},t.prototype.onBtnAttackIslandClick=function(){var t=this.selectedObjectNode?this.selectedObjectNode.getComponent(M.default):null;t&&(t.data.occupant==y.DataMgr.myData.address?c.default.Instance.collectIslandMoney(t.data.id):(l.default.Instance.node.active=!0,l.default.Instance.setAndRefresh(t)))},t.prototype.onIslandSponsorLinkClick=function(t){t.data.sponsorLink&&window.open(t.data.sponsorLink)},t.prototype.onBtnSailClick=function(){this.selectedObjectNode=null,this.editSailDestinationMode=!0,this.newDestination=null;var t=y.DataMgr.myTechData.find(function(t){return"arkspeed1011"==t.id});y.DataMgr.myData.speed=y.DataMgr.getArkSpeedByTech(!!t&&t.finished)},t.prototype.onCancelSailClick=function(){this.editSailDestinationMode=!1,this.newDestination=null},t.prototype.onConfirmSailClick=function(){var t=y.DataMgr.myData;if(t.arkSize<=y.DataMgr.SmallArkSize)s.default.PopupWith1Button("简陋方舟无法航行","您的方舟是简陋方舟，没有扩建功能，请原地呆着吧。\n想要功能完整的方舟？请回到主界面领取标准方舟或大型方舟。需要安装星云钱包哦！","知道了",null);else{var e=new cc.Vec2(y.DataMgr.myData.currentLocation.x,y.DataMgr.myData.currentLocation.y),a=this.newDestination.sub(e).mag(),n=y.DataMgr.MethaneCostPerKmPerSize*a*y.DataMgr.myData.arkSize,o=y.DataMgr.myCargoData.find(function(t){return"methane74"==t.id});if(n>o.amount)s.default.PopupWith1Button("燃料不足","方舟引擎的唯一动力来源是甲烷。如果你想要环球旅行，多造一些[甲烷采集器]吧！","知道了",null);else{var i=y.DataMgr.myTechData.find(function(t){return"arkspeed1011"==t.id});t.speed=y.DataMgr.getArkSpeedByTech(!!i&&i.finished);var r={};r.speed=t.speed,r.locationX=t.currentLocation.x,r.locationY=t.currentLocation.y,r.destinationX=this.newDestination.x,r.destinationY=this.newDestination.y,console.log("ConfirmSail",r),c.default.Instance.setSail(r,function(){o.amount=Math.max(0,o.amount-n)})}}},__decorate([p(cc.Node)],t.prototype,"mineContainer",void 0),__decorate([p(cc.Node)],t.prototype,"islandContainer",void 0),__decorate([p(cc.Node)],t.prototype,"arkContainer",void 0),__decorate([p(cc.Node)],t.prototype,"arkTemplate",void 0),__decorate([p(cc.Node)],t.prototype,"worldMap",void 0),__decorate([p(cc.Node)],t.prototype,"earth",void 0),__decorate([p(cc.Node)],t.prototype,"grpSelectObject",void 0),__decorate([p(cc.Node)],t.prototype,"selectFrame",void 0),__decorate([p(cc.Button)],t.prototype,"btnSponsorLink",void 0),__decorate([p(cc.Label)],t.prototype,"lblAttackButton",void 0),__decorate([p(cc.Node)],t.prototype,"panPad",void 0),__decorate([p(cc.Slider)],t.prototype,"sldZoom",void 0),__decorate([p(cc.Node)],t.prototype,"grpSail",void 0),__decorate([p(cc.Node)],t.prototype,"sailDestinationIndicator",void 0),__decorate([p(cc.Label)],t.prototype,"lblDestinationInfo",void 0),__decorate([p(cc.Node)],t.prototype,"btnCancelSail",void 0),__decorate([p(cc.Node)],t.prototype,"btnConfirmSail",void 0),t=a=__decorate([u],t);var a}(o.default);a.default=h,cc._RF.pop()},{"./ArkInWorld":"ArkInWorld","./ArkUI":"ArkUI","./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./HomeUI":"HomeUI","./MainCtrl":"MainCtrl","./UI/AttackIslandPanel":"AttackIslandPanel","./Utils/CurrencyFormatter":"CurrencyFormatter","./World/Island":"Island"}]},{},["ArkInWorld","ArkUI","BaseUI","BlockchainMgr","BuildPanel","Building","BuildingButton","CvsMain","DataMgr","DialogPanel","Foreground","HomeUI","HouseBuilding","MainCtrl","Road","TaskMgr","TechButton","TechPanel","AttackIslandPanel","BuildingInfoPanel","EditNicknamePanel","IntroUI","ToastPanel","CurrencyFormatter","WorkshopBuilding","WorldUI","IronMine","Island"]);