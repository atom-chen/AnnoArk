require=function t(e,a,o){function n(i,c){if(!a[i]){if(!e[i]){var l="function"==typeof require&&require;if(!c&&l)return l(i,!0);if(r)return r(i,!0);var s=new Error("Cannot find module '"+i+"'");throw s.code="MODULE_NOT_FOUND",s}var d=a[i]={exports:{}};e[i][0].call(d.exports,function(t){var a=e[i][1][t];return n(a||t)},d,d.exports,t,e,a,o)}return a[i].exports}for(var r="function"==typeof require&&require,i=0;i<o.length;i++)n(o[i]);return n}({ArkInWorld:[function(t,e,a){"use strict";cc._RF.push(e,"dec21HFq/1BXrPvCkgOJBUs","ArkInWorld"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./WorldUI"),n=t("./UI/FlagMgr"),r=cc._decorator,i=r.ccclass,c=r.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.sprArk=null,e.sprFlag=null,e.lblName=null,e}return __extends(e,t),e.prototype.onLoad=function(){},e.prototype.setAndRefresh=function(t,e){this.data=t,this.sprArk.node.setContentSize(t.arkSize,t.arkSize),this.lblName.string=t.nickname,this.refreshZoom(e),n.FlagMgr.setFlag(this.sprFlag,t.country)},e.prototype.refreshZoom=function(t){this.node.position=new cc.Vec2(this.data.currentLocation.x,this.data.currentLocation.y).mul(t)},e.prototype.update=function(t){this.refreshZoom(o.default.Instance.zoomScale)},e.prototype.onClick=function(){o.default.Instance.selectArk(this.node)},__decorate([c(cc.Sprite)],e.prototype,"sprArk",void 0),__decorate([c(cc.Sprite)],e.prototype,"sprFlag",void 0),__decorate([c(cc.Label)],e.prototype,"lblName",void 0),e=__decorate([i],e)}(cc.Component);a.default=l,cc._RF.pop()},{"./UI/FlagMgr":"FlagMgr","./WorldUI":"WorldUI"}],ArkUI:[function(t,e,a){"use strict";cc._RF.push(e,"e7f42dM68VAz487nLcu3wTI","ArkUI"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./CvsMain"),n=t("./BaseUI"),r=t("./WorldUI"),i=t("./DataMgr"),c=t("./BuildPanel"),l=t("./Building"),s=t("./TechPanel"),d=t("./DialogPanel"),u=t("./UI/BuildingInfoPanel"),p=t("./Utils/CurrencyFormatter"),h=t("./BlockchainMgr"),f=cc._decorator,g=f.ccclass,m=f.property,y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.arkMap=null,e.ark=null,e.cargoLabelContainer=null,e.cargoLabelTemplate=null,e.cargoLabels={},e.panPad=null,e.sldZoom=null,e.pressingZoomSlider=!1,e.zoomScale=1,e.workshopTemplate=null,e.houseTemplate=null,e.roadTemplate=null,e.buildingContainer=null,e.blueprint=null,e.blueprintIndicator=null,e.currentHoldingBlueprint=null,e.grpBuild=null,e.btnConfirmBuild=null,e.selectedBuilding=null,e.grpBuildingInfo=null,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.node.active=!1;var t=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(e){t.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(e){t.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(e){t.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.panPad.on(cc.Node.EventType.TOUCH_END,this.deselectBuilding,this),this.cells=[];for(var e=-50;e<=50;e++){this.cells[e]=[];for(var o=-50;o<50;o++)this.cells[e][o]=new M}this.blueprint.on(cc.Node.EventType.TOUCH_MOVE,this.dragBlueprint.bind(this)),this.workshopTemplate.active=!1,this.roadTemplate.active=!1,this.houseTemplate.active=!1;var n=cc.instantiate(this.cargoLabelTemplate);n.parent=this.cargoLabelContainer;var r=n.getComponent(cc.Label);r.string="人口",this.cargoLabels.population=r},e.prototype.start=function(){var t=this;i.DataMgr.CargoConfig.forEach(function(e){var a=cc.instantiate(t.cargoLabelTemplate);a.parent=t.cargoLabelContainer;var o=a.getComponent(cc.Label);o.string=e.Name,t.cargoLabels[e.id]=o}),this.cargoLabelTemplate.active=!1},e.prototype.onEnable=function(){var t=this;this.refreshZoom();var e=i.DataMgr.myData;console.log("size",e.arkSize);for(var a=-Math.floor(e.arkSize/2);a<e.arkSize/2;a++)for(var o=-Math.floor(e.arkSize/2);o<e.arkSize/2;o++){var n=this.cells[a][o];n.isLand=!0,n.building=null}this.buildingContainer.destroyAllChildren();var r=0;i.DataMgr.myBuildingData.forEach(function(e){var a=i.DataMgr.BuildingConfig.find(function(t){return t.id==e.id});console.log("precreatebuilding",e),t.createBuilding(a,e),r+=e.workers}),i.DataMgr.idleWorkers=e.population-r,this.deselectBuilding()},e.prototype.refreshZoom=function(){this.arkMap.scale=this.zoomScale},e.prototype.update=function(t){i.DataMgr.changed&&(this.refreshData(),i.DataMgr.changed=!1),this.updateCheckExpand(),this.cargoLabels.population.string="人口 "+i.DataMgr.myData.population+"/"+i.DataMgr.populationLimit+" (闲置 "+i.DataMgr.idleWorkers+") 增长"+i.DataMgr.populationGrowPerMin.toFixed(0)+"/min";for(var e=function(t){var e=i.DataMgr.CargoConfig[t],o=i.DataMgr.myCargoData.find(function(t){return t.id==e.id}),n=i.DataMgr.outputRates[e.id];n||(n=0);var r=e.Name+"   "+Math.floor(o?o.amount:0).toFixed()+"("+(n>0?"+":"")+n.toFixed()+")";"fish34509"==e.id&&o.amount<=0&&n<0&&(r+=" 食物短缺"),a.cargoLabels[e.id].string=r},a=this,o=0;o<i.DataMgr.CargoConfig.length;o++)e(o);var n=this.sldZoom.progress;if(this.pressingZoomSlider||(n>.5?((n-=5*t)<.5&&(n=.5),this.sldZoom.progress=n):n<.5&&((n+=5*t)>.5&&(n=.5),this.sldZoom.progress=n)),.5!=n){var r=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(n-.5)*5*t),this.clampZoom();var c=this.zoomScale/r;this.arkMap.position=this.arkMap.position.mul(c),this.refreshZoom()}if(this.currentHoldingBlueprint){this.blueprint.active=!0,this.blueprint.position=new cc.Vec2(100*this.currentBlueprintIJ.i-50,100*this.currentBlueprintIJ.j-50),this.blueprint.setContentSize(100*this.currentHoldingBlueprint.Length,100*this.currentHoldingBlueprint.Width);var l=!0;this.blueprintIndicator.clear();for(o=0;o<this.currentHoldingBlueprint.Length;o++)for(var s=0;s<this.currentHoldingBlueprint.Width;s++){var d=this.cells[this.currentBlueprintIJ.i+o][this.currentBlueprintIJ.j+s];this.blueprintIndicator.fillColor=d.building?cc.Color.RED:d.isLand?cc.Color.GREEN:cc.Color.RED,d.building&&(l=!1),d.isLand||(l=!1),this.blueprintIndicator.fillRect(100*o,100*s,100,100)}this.grpBuild.active=!0,this.btnConfirmBuild.interactable=l}else this.blueprint.active=!1,this.grpBuild.active=!1;this.selectedBuilding?this.grpBuildingInfo.active=!0:this.grpBuildingInfo.active=!1,this.ark.setContentSize(100*i.DataMgr.myData.arkSize,100*i.DataMgr.myData.arkSize)},e.prototype.refreshData=function(){},e.prototype.onGotoWorldClick=function(){this.deselectBuilding(),o.default.EnterUI(r.default)},e.prototype.onBuildBtnClick=function(){this.deselectBuilding(),c.default.Show(),s.default.Hide()},e.prototype.onTechClick=function(){this.deselectBuilding(),i.DataMgr.myBuildingData.find(function(t){return"research239"==t.id})||d.default.PopupWith1Button("没有研究院","建造研究院并指派工作人员进行研究","确定",null),s.default.Show(),c.default.Hide()},e.prototype.onCenterBtnClick=function(){var t=i.DataMgr.myData,e=new cc.Vec2(t.currentLocation.x,t.currentLocation.y);e.mulSelf(this.zoomScale),this.arkMap.position=e.neg()},e.prototype.onPanPadTouchMove=function(t){var e=t.getDelta();this.arkMap.position=this.arkMap.position.add(new cc.Vec2(e.x,e.y))},e.prototype.onMouseWheel=function(t){var e=t.getScrollY(),a=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var o=this.zoomScale/a;this.arkMap.position=this.arkMap.position.mul(o),this.refreshZoom()},e.prototype.onZoomSliderChange=function(t){},e.prototype.clampZoom=function(){this.zoomScale>3&&(this.zoomScale=3),this.zoomScale<.3&&(this.zoomScale=.3)},e.prototype.enterBuildMode=function(t){this.currentHoldingBlueprint=t,this.currentBlueprintIJ=i.IJ.ZERO},e.prototype.dragBlueprint=function(t){var e=t.getLocation(),a=this.arkMap.convertToNodeSpaceAR(e);this.currentBlueprintIJ.i=Math.round(a.x/100),this.currentBlueprintIJ.j=Math.round(a.y/100)},e.prototype.onBtnConfirmBuildClick=function(){for(var t=!0,e=0;e<this.currentHoldingBlueprint.Length;e++)for(var a=0;a<this.currentHoldingBlueprint.Width;a++){var o=this.cells[this.currentBlueprintIJ.i+e][this.currentBlueprintIJ.j+a];o.building&&(t=!1),o.isLand||(t=!1)}if(t){var n=[];for(e=0;e<4;e++){var r=this.currentHoldingBlueprint["BuildMat"+e];if(r&&r.length>0){var c=this.currentHoldingBlueprint["BuildMat"+e+"Count"];n.push([r,c])}}var l=!0;if(n.forEach(function(t){i.DataMgr.myCargoData.find(function(e){return e.id==t[0]}).amount<t[1]&&(l=!1)}),l){n.forEach(function(t){i.DataMgr.myCargoData.find(function(e){return e.id==t[0]}).amount-=t[1]});var s=new i.BuildingData;s.id=this.currentHoldingBlueprint.id,s.ij=this.currentBlueprintIJ.clone(),s.workers=0,i.DataMgr.myBuildingData.push(s),this.createBuilding(this.currentHoldingBlueprint,s),"road00001"==this.currentHoldingBlueprint.id?this.currentBlueprintIJ.j+=1:this.currentHoldingBlueprint=null}}},e.prototype.onBtnCancelBuildClick=function(){this.currentHoldingBlueprint=null},e.prototype.createBuilding=function(t,e){var a=t.prefab,o=cc.instantiate(this[a+"Template"]);o.parent=this.buildingContainer;var n=o.getComponent(l.default);n.setInfo(t,e),o.position=new cc.Vec2(100*e.ij.i-50,100*e.ij.j-50),o.active=!0;for(var r=0;r<t.Length;r++)for(var i=0;i<t.Width;i++){this.cells[e.ij.i+r][e.ij.j+i].building=n}},e.prototype.selectBuilding=function(t){console.log("选中建筑"),this.selectedBuilding=t},e.prototype.deselectBuilding=function(){this.selectedBuilding=null},e.prototype.onDemolishBtnClick=function(){var t=a.Instance;this.selectedBuilding&&d.default.PopupWith2Buttons("确定拆除建筑吗",t.selectedBuilding.info.Name+"\n建筑材料不予返还","取消",null,"拆除",function(){t.demolishBuilding(t.selectedBuilding),t.deselectBuilding()})},e.prototype.demolishBuilding=function(t){if(t){console.log("拆除建筑");var e=i.DataMgr.myBuildingData.findIndex(function(e){return e==t.data});if(e>=0){var a=t.data.workers;i.DataMgr.myBuildingData.splice(e,1),i.DataMgr.idleWorkers+=a;var o=i.DataMgr.BuildingConfig.find(function(e){return e.id==t.data.id});console.log("info.Length",o.Length);for(var n=0;n<o.Length;n++)for(var r=0;r<o.Width;r++)console.log("cells",t.data.ij.i+n,t.data.ij.j+r),this.cells[t.data.ij.i+n][t.data.ij.j+r].building=null;t.node.destroy()}}},e.prototype.onBuildingInfoBtnClick=function(){this.selectedBuilding&&(u.default.Show(this.selectedBuilding.info),this.deselectBuilding())},e.prototype.onBtnExpandClick=function(){if(i.DataMgr.myData.arkSize<=i.DataMgr.SmallArkSize)d.default.PopupWith1Button("简陋方舟无法扩建","您的方舟是简陋方舟，没有扩建功能。\n想要功能完整的方舟？请回到主界面领取标准方舟或大型方舟。需要安装星云钱包哦！","知道了",null);else{for(var t=null,e=0;e<i.DataMgr.RechargeToArkSize.length;e++){var a=i.DataMgr.RechargeToArkSize[e];if(i.DataMgr.myData.rechargeOnExpand/1e18<a[0]){t=a;break}}if(t){var o=t[0]-i.DataMgr.myData.rechargeOnExpand/1e18,n=t[1];d.default.PopupWith2Buttons("扩建方舟","支付 "+p.default.formatNAS(o)+"NAS 扩建方舟到 "+n+"×"+n+" 吗","取消",null,"支付",function(){h.default.Instance.expandArk(o)})}else d.default.PopupWith1Button("方舟已经最大","非常感谢您的支持！区块链首款SLG必将越做越好！","支持！！！",null)}},e.prototype.updateCheckExpand=function(){var t=i.DataMgr.GetArkSizeByRecharge(i.DataMgr.myData.rechargeOnExpand/1e18);if(this.lastTickArkSize!=t){console.log("检测到方舟成功扩建了",this.lastTickArkSize,t),this.lastTickArkSize=t;var e=i.DataMgr.myData;e.arkSize=t;for(var a=-Math.floor(e.arkSize/2);a<e.arkSize/2;a++)for(var o=-Math.floor(e.arkSize/2);o<e.arkSize/2;o++){this.cells[a][o].isLand=!0}}},__decorate([m(cc.Node)],e.prototype,"arkMap",void 0),__decorate([m(cc.Node)],e.prototype,"ark",void 0),__decorate([m(cc.Node)],e.prototype,"cargoLabelContainer",void 0),__decorate([m(cc.Node)],e.prototype,"cargoLabelTemplate",void 0),__decorate([m(cc.Node)],e.prototype,"panPad",void 0),__decorate([m(cc.Slider)],e.prototype,"sldZoom",void 0),__decorate([m(cc.Node)],e.prototype,"workshopTemplate",void 0),__decorate([m(cc.Node)],e.prototype,"houseTemplate",void 0),__decorate([m(cc.Node)],e.prototype,"roadTemplate",void 0),__decorate([m(cc.Node)],e.prototype,"buildingContainer",void 0),__decorate([m(cc.Node)],e.prototype,"blueprint",void 0),__decorate([m(cc.Graphics)],e.prototype,"blueprintIndicator",void 0),__decorate([m(cc.Node)],e.prototype,"grpBuild",void 0),__decorate([m(cc.Button)],e.prototype,"btnConfirmBuild",void 0),__decorate([m(cc.Node)],e.prototype,"grpBuildingInfo",void 0),e=a=__decorate([g],e);var a}(n.default);a.default=y;var M=function(){this.isLand=!1,this.building=null};cc._RF.pop()},{"./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./BuildPanel":"BuildPanel","./Building":"Building","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./TechPanel":"TechPanel","./UI/BuildingInfoPanel":"BuildingInfoPanel","./Utils/CurrencyFormatter":"CurrencyFormatter","./WorldUI":"WorldUI"}],AsyncLoadSprite:[function(t,e,a){"use strict";cc._RF.push(e,"39cbcBA8NhMbplhvYeYYTtc","AsyncLoadSprite"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=o.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.delay=0,e.path="",e}return __extends(e,t),e.prototype.start=function(){setTimeout(this.loadSprite.bind(this),1e3*this.delay)},e.prototype.loadSprite=function(){try{var t=this;cc.loader.loadRes(t.path,cc.SpriteFrame,function(e,a){if(!e){var o=t.node.getComponent(cc.Sprite);o&&(o.spriteFrame=a)}})}catch(t){console.error(t)}},__decorate([r(cc.Float)],e.prototype,"delay",void 0),__decorate([r(cc.String)],e.prototype,"path",void 0),e=__decorate([n],e)}(cc.Component);a.default=i,cc._RF.pop()},{}],AttackIslandPanel:[function(t,e,a){"use strict";cc._RF.push(e,"820acbSeDlEZbUkJ5dGpgYt","AttackIslandPanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../DataMgr"),n=t("../BlockchainMgr"),r=t("../DialogPanel"),i=cc._decorator,c=i.ccclass,l=i.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblOccupant=null,e.lblDefTank=null,e.lblDefChopper=null,e.lblDefShip=null,e.lblAtkTankMax=null,e.lblAtkChopperMax=null,e.lblAtkShipMax=null,e.edtAtkTank=null,e.edtAtkChopper=null,e.edtAtkShip=null,e.SldAtkTank=null,e.SldAtkChopper=null,e.SldAtkShip=null,e.lblDistance=null,e.lblMethane=null,e.lblConfirmButton=null,e.tankMax=0,e.chopperMax=0,e.shipMax=0,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.node.active=!1},e.prototype.setAndRefresh=function(t){this.island=t;var e=o.DataMgr.myData.address==t.data.occupant,a=e?o.DataMgr.myData:o.DataMgr.othersData.find(function(e){return e.address==t.data.occupant});this.lblOccupant.string=a?a.nickname:t.data.occupant,this.lblConfirmButton.string=e?"追加":"进攻";var n=(Number(new Date)-t.data.lastBattleTime)/36e5,r=Math.exp(-.05*n);this.lblDefTank.string=(t.data.tankPower*r).toFixed(),this.lblDefChopper.string=(t.data.chopperPower*r).toFixed(),this.lblDefShip.string=(t.data.shipPower*r).toFixed(),this.SldAtkTank.progress=0,this.SldAtkChopper.progress=0,this.SldAtkShip.progress=0,this.onSliderChange(null,"Tank"),this.onSliderChange(null,"Chopper"),this.onSliderChange(null,"Ship"),this.refreshMethaneCost()},e.prototype.onSliderChange=function(t,e){switch(e){case"Tank":this.edtAtkTank.string=(this.SldAtkTank.progress*this.tankMax).toFixed();break;case"Chopper":this.edtAtkChopper.string=(this.SldAtkChopper.progress*this.chopperMax).toFixed();break;case"Ship":this.edtAtkShip.string=(this.SldAtkShip.progress*this.shipMax).toFixed()}this.refreshMethaneCost()},e.prototype.onEditBoxChange=function(t,e){switch(e){case"Tank":var a=parseInt(this.edtAtkTank.string);a=Math.max(0,Math.min(this.tankMax,a)),this.edtAtkTank.string=a.toFixed(),this.SldAtkTank.progress=a/this.tankMax;break;case"Chopper":a=parseInt(this.edtAtkChopper.string),a=Math.max(0,Math.min(this.chopperMax,a)),this.edtAtkChopper.string=a.toFixed(),this.SldAtkChopper.progress=a/this.chopperMax;break;case"Ship":a=parseInt(this.edtAtkShip.string),a=Math.max(0,Math.min(this.shipMax,a)),this.edtAtkShip.string=a.toFixed(),this.SldAtkShip.progress=a/this.shipMax}this.refreshMethaneCost()},e.prototype.update=function(t){this.tankMax=Math.floor(o.DataMgr.myCargoData.find(function(t){return"tank23532"==t.id}).amount),this.lblAtkTankMax.string="/"+this.tankMax.toFixed(),this.chopperMax=Math.floor(o.DataMgr.myCargoData.find(function(t){return"chopper424"==t.id}).amount),this.lblAtkChopperMax.string="/"+this.chopperMax.toFixed(),this.shipMax=Math.floor(o.DataMgr.myCargoData.find(function(t){return"ship40342"==t.id}).amount),this.lblAtkShipMax.string="/"+this.shipMax.toFixed()},e.prototype.refreshMethaneCost=function(){var t=this.island.node.position.sub(new cc.Vec2(o.DataMgr.myData.currentLocation.x,o.DataMgr.myData.currentLocation.y)).mag(),e=o.DataMgr.getMethaneCostOfAttack(t,Math.round(this.SldAtkTank.progress*this.tankMax),Math.round(this.SldAtkChopper.progress*this.chopperMax),Math.round(this.SldAtkShip.progress*this.shipMax)),a=o.DataMgr.myCargoData.find(function(t){return"methane74"==t.id}).amount;this.lblDistance.string=t.toFixed()+"km",this.lblMethane.string=e.toFixed()+"/"+a.toFixed()},e.prototype.onConfirmClick=function(){console.log("准备攻占资源岛",this.island);var t=this.island.node.position.sub(new cc.Vec2(o.DataMgr.myData.currentLocation.x,o.DataMgr.myData.currentLocation.y)).mag(),e=o.DataMgr.getMethaneCostOfAttack(t,Math.round(this.SldAtkTank.progress*this.tankMax),Math.round(this.SldAtkChopper.progress*this.chopperMax),Math.round(this.SldAtkShip.progress*this.shipMax)),a=o.DataMgr.myCargoData.find(function(t){return"methane74"==t.id});if(e<=a.amount){var i=Math.round(this.SldAtkTank.progress*this.tankMax),c=Math.round(this.SldAtkChopper.progress*this.chopperMax),l=Math.round(this.SldAtkShip.progress*this.shipMax);n.default.Instance.attackIsland(this.island.data.id,i,c,l,function(){try{a.amount=Math.max(0,a.amount-e),o.DataMgr.myCargoData.find(function(t){return"tank23532"==t.id}).amount-=i,o.DataMgr.myCargoData.find(function(t){return"chopper424"==t.id}).amount-=c,o.DataMgr.myCargoData.find(function(t){return"ship40342"==t.id}).amount-=l}catch(t){}})}else r.default.PopupWith1Button("燃料不足","将方舟靠近目标，减少派兵数量，或者生产更多甲烷吧","确定",null)},e.prototype.close=function(){this.node.active=!1},__decorate([l(cc.Label)],e.prototype,"lblOccupant",void 0),__decorate([l(cc.Label)],e.prototype,"lblDefTank",void 0),__decorate([l(cc.Label)],e.prototype,"lblDefChopper",void 0),__decorate([l(cc.Label)],e.prototype,"lblDefShip",void 0),__decorate([l(cc.Label)],e.prototype,"lblAtkTankMax",void 0),__decorate([l(cc.Label)],e.prototype,"lblAtkChopperMax",void 0),__decorate([l(cc.Label)],e.prototype,"lblAtkShipMax",void 0),__decorate([l(cc.EditBox)],e.prototype,"edtAtkTank",void 0),__decorate([l(cc.EditBox)],e.prototype,"edtAtkChopper",void 0),__decorate([l(cc.EditBox)],e.prototype,"edtAtkShip",void 0),__decorate([l(cc.Slider)],e.prototype,"SldAtkTank",void 0),__decorate([l(cc.Slider)],e.prototype,"SldAtkChopper",void 0),__decorate([l(cc.Slider)],e.prototype,"SldAtkShip",void 0),__decorate([l(cc.Label)],e.prototype,"lblDistance",void 0),__decorate([l(cc.Label)],e.prototype,"lblMethane",void 0),__decorate([l(cc.Label)],e.prototype,"lblConfirmButton",void 0),e=a=__decorate([c],e);var a}(cc.Component);a.default=s,cc._RF.pop()},{"../BlockchainMgr":"BlockchainMgr","../DataMgr":"DataMgr","../DialogPanel":"DialogPanel"}],BaseUI:[function(t,e,a){"use strict";cc._RF.push(e,"3b934a4EjZFs6JzaRDhWpVf","BaseUI"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([n],e)}(cc.Component));a.default=r,cc._RF.pop()},{}],BlockchainMgr:[function(t,e,a){"use strict";cc._RF.push(e,"3ffefed5pBCD40DXf/kM6bs","BlockchainMgr"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./DataMgr"),n=t("./DialogPanel"),r=t("./WorldUI"),i=t("./UI/ToastPanel"),c=t("./ArkUI"),l=t("./CvsMain"),s=t("./HomeUI"),d=t("./UI/AttackIslandPanel"),u=cc._decorator,p=u.ccclass;u.property;a.ContractAddress="n1jiTBXSNGvuYK6vB4JFz95C4bhATQoJwBm",a.EncKey=37234;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.checkWalletCountdown=1e9,e.fetchAllDataCountdown=1e9,e}return __extends(e,t),u=e,e.prototype.onLoad=function(){u.Instance=this},e.prototype.start=function(){this.checkWalletCountdown=1,this.fetchAllDataCountdown=1},e.prototype.update=function(t){try{Neb,NebPay}catch(t){return}if(this.checkWalletCountdown-=t,this.fetchAllDataCountdown-=t,this.checkWalletCountdown<=0){try{var e=this;(o=new Neb).setRequest(new HttpRequest(u.BlockchainUrl)),o.api.getNebState().then(function(t){window.addEventListener("message",e.onGetWalletData),window.postMessage({target:"contentscript",data:{},method:"getAccount"},"*")})}catch(t){console.error(t)}this.checkWalletCountdown=u.CheckWalletInterval}if(this.fetchAllDataCountdown<=0){var o;(o=new Neb).setRequest(new HttpRequest(u.BlockchainUrl));var n=u.WalletAddress?u.WalletAddress:Account.NewAccount().getAddressString(),r={function:"get_map_info",args:"[]"};o.api.call(n,a.ContractAddress,"0","0","1000000","2000000",r).then(this.onGetAllMapData).catch(function(t){console.log("call get_map_info error:"+t.message)}),this.fetchAllDataCountdown=u.FetchAllDataInterval}},e.prototype.onGetWalletData=function(t){if(t.data&&t.data.data&&t.data.data.account&&t.data.data.account.length>0){var e=t.data.data.account;if(u.WalletAddress!=e){console.log("Change wallet address:",e),u.WalletAddress=e,this.fetchAllDataCountdown=0;try{o.DataMgr.myData&&o.DataMgr.myData.address!=e&&(r.default.Instance.node.active||c.default.Instance.node.active)&&l.default.EnterUI(s.default)}catch(t){console.error(t)}}}},e.prototype.onGetAllMapData=function(t){console.log("onGetAllMapData",t);var e=JSON.parse(t.result).result_data,a=e.ark_info,n=e.island_info;o.DataMgr.othersData=[],a.forEach(function(t){t.address==u.WalletAddress?(o.DataMgr.myData||(o.DataMgr.myData=new o.UserData),o.DataMgr.myData.nickname||(o.DataMgr.myData.nickname=t.nickname),o.DataMgr.myData.address!=t.address&&(r.default.Instance.node.active||c.default.Instance.node.active)&&l.default.EnterUI(s.default),o.DataMgr.myData.address=t.address,o.DataMgr.myData.country||(o.DataMgr.myData.country=t.country),o.DataMgr.myData.speed=t.speed,o.DataMgr.myData.locationX=t.locationX,o.DataMgr.myData.locationY=t.locationY,o.DataMgr.myData.lastLocationTime=t.lastLocationTime,o.DataMgr.myData.destinationX=t.destinationX,o.DataMgr.myData.destinationY=t.destinationY,o.DataMgr.myData.rechargeOnExpand=t.rechargeOnExpand,o.DataMgr.myData.arkSize=o.DataMgr.GetArkSizeByRecharge(t.rechargeOnExpand/1e18),o.DataMgr.writeData()):(o.DataMgr.othersData[t.address]=t,o.DataMgr.othersData[t.address].currentLocation=new cc.Vec2(t.locationX,t.locationY))}),n.forEach(function(t){var e=o.DataMgr.allIslandData[t.id];if(e)for(var a in t)e[a]=t[a];else console.error("从区块链获取到未知id的island:",t)})},e.prototype.claimArk=function(t){if(window.webExtensionWallet)try{var e=s.default.Instance.lblNickname.string,o=s.default.Instance.country,r=new NebPay,i=u.BlockchainUrl,c=a.ContractAddress;console.log("调用钱包claim_ark(",e);var l='["'+e+'","'+o+'"]';r.call(c,t,"claim_ark",l,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:i,listener:this.claimArkCallback})}catch(t){console.error(t)}else n.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},e.prototype.claimArkCallback=function(t){console.log("claimArkCallback: ",t),"Error"!=t.toString().substr(0,5)?n.default.PopupWith2Buttons("方舟正在组装，请等候30秒","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):i.default.Toast("交易失败:"+t)},e.prototype.setSail=function(t,e){if(window.webExtensionWallet)try{var o=new NebPay,r=u.BlockchainUrl,i=a.ContractAddress;console.log("调用钱包update_ark",t);var c='["'+encodeURIComponent(JSON.stringify(t))+'"]';o.call(i,0,"update_ark",c,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:r,listener:this.setSailCallback(e)})}catch(t){console.error(t)}else n.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},e.prototype.setSailCallback=function(t){return function(e){console.log("setSailCallback: ",t,e),"Error"!=e.toString().substr(0,5)?(n.default.PopupWith2Buttons("方舟引擎开始预热，预计1分钟内出发","区块链交易已发送，等待出块\nTxHash:"+e.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+e.txhash)},"确定",null),r.default.Instance.editSailDestinationMode=!1,t&&t()):i.default.Toast("交易失败:"+e)}},e.prototype.expandArk=function(t){if(window.webExtensionWallet)try{var e=new NebPay,o=u.BlockchainUrl,r=a.ContractAddress,i=Math.ceil(1e6*t)/1e6;console.log("调用钱包recharge_expand(valueNas",t,"value",i),e.call(r,i,"recharge_expand",null,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:o,listener:this.expandArkCallback})}catch(t){console.error(t)}else n.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},e.prototype.expandArkCallback=function(t){console.log("expandArkCallback: ",t),"Error"!=t.toString().substr(0,5)?n.default.PopupWith2Buttons("扩建计划已启动，请稍候","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):i.default.Toast("交易失败:"+t)},e.prototype.attackIsland=function(t,e,o,r,i){if(window.webExtensionWallet)try{var c=new NebPay,l=u.BlockchainUrl,s=a.ContractAddress;console.log("调用钱包attack_island(",t,e,o,r);var d=JSON.stringify([t,e,o,r]);c.call(s,0,"attack_island",d,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:l,listener:this.attackIslandCallback(i)})}catch(t){console.error(t)}else n.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},e.prototype.attackIslandCallback=function(t){return function(e){console.log("attackIslandCallback: ",t,e),"Error"!=e.toString().substr(0,5)?(d.default.Instance.close(),n.default.PopupWith2Buttons("您的部队已出发","区块链交易已发送，等待出块\nTxHash:"+e.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+e.txhash)},"确定",null),r.default.Instance.editSailDestinationMode=!1,t&&t()):n.default.PopupWith1Button("区块链交易失败",e,"确定",null)}},e.prototype.collectIslandMoney=function(t){if(window.webExtensionWallet)try{var e=new NebPay,o=u.BlockchainUrl,r=a.ContractAddress;console.log("调用钱包collect_island_money(",t);var i=JSON.stringify([t]);e.call(r,0,"collect_island_money",i,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:o,listener:this.collectIslandMoneyCallback})}catch(t){console.error(t)}else n.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},e.prototype.collectIslandMoneyCallback=function(t){console.log("collectIslandMoneyCallback: ",t),"Error"!=t.toString().substr(0,5)?(d.default.Instance.close(),n.default.PopupWith2Buttons("正在收取资源","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null)):n.default.PopupWith1Button("区块链交易失败",t,"确定",null)},e.prototype.sponsor=function(t,e,o,r){if(window.webExtensionWallet)try{var i=new NebPay,c=u.BlockchainUrl,l=a.ContractAddress,s=Math.ceil(1e6*r)/1e6;console.log("调用钱包sponsor(",t,e,o,r);var d=JSON.stringify([t,e,o]);i.call(l,s,"sponsor",d,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:c,listener:this.sponsorCallback})}catch(t){console.error(t)}else n.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},e.prototype.sponsorCallback=function(t){console.log("sponsorCallback: ",t),"Error"!=t.toString().substr(0,5)?n.default.PopupWith2Buttons("感谢您的赞助","区块链交易已发送，等待出块\nTxHash:"+t.txhash,"查看交易",function(){window.open("https://explorer.nebulas.io/#/tx/"+t.txhash)},"确定",null):i.default.Toast("交易失败:"+t)},e.encrypto=function(t,e,a){if("string"==typeof t&&"number"==typeof e&&"number"==typeof a){var o=[];a=a<=25?a:a%25;for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);r=(r=1*r^e).toString(a),o.push(r)}var i=String.fromCharCode(a+97);return o.join(i)}},e.BlockchainUrl="https://mainnet.nebulas.io",e.CheckWalletInterval=10,e.FetchAllDataInterval=10,e=u=__decorate([p],e);var u}(cc.Component);a.default=h,cc._RF.pop()},{"./ArkUI":"ArkUI","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./HomeUI":"HomeUI","./UI/AttackIslandPanel":"AttackIslandPanel","./UI/ToastPanel":"ToastPanel","./WorldUI":"WorldUI"}],BuildPanel:[function(t,e,a){"use strict";cc._RF.push(e,"5cf0290QotGfpJodxaDGNKp","BuildPanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./DataMgr"),n=t("./BuildingButton"),r=t("./ArkUI"),i=cc._decorator,c=i.ccclass,l=i.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.buttonContainer=null,e.buttonTemplate=null,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.node.active=!1},e.prototype.start=function(){var t=this;o.DataMgr.BuildingConfig.forEach(function(e){var a=cc.instantiate(t.buttonTemplate);a.parent=t.buttonContainer,a.getComponent(n.default).setAndRefresh(e),a.active=!0}),this.buttonTemplate.active=!1},e.prototype.onEnable=function(){},e.prototype.refresh=function(){},e.Show=function(){a.Instance.node.active=!0},e.Hide=function(){a.Instance.node.active=!1},e.prototype.onBtnExpandClick=function(){r.default.Instance.onBtnExpandClick()},e.prototype.close=function(){this.node.active=!1},__decorate([l(cc.Node)],e.prototype,"buttonContainer",void 0),__decorate([l(cc.Node)],e.prototype,"buttonTemplate",void 0),e=a=__decorate([c],e);var a}(cc.Component);a.default=s,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildingButton":"BuildingButton","./DataMgr":"DataMgr"}],BuildingButton:[function(t,e,a){"use strict";cc._RF.push(e,"7884bIsfolMCKOoH+GiGik+","BuildingButton"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./BuildPanel"),n=t("./ArkUI"),r=t("./DataMgr"),i=t("./DialogPanel"),c=t("./UI/BuildingInfoPanel"),l=cc._decorator,s=l.ccclass,d=l.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblName=null,e.lblSize=null,e.sprSize=null,e.lblConsumption=null,e}return __extends(e,t),e.prototype.setAndRefresh=function(t){this.info=t,this.lblName.string=t.Name,this.lblSize.string=t.Length+"*"+t.Width,this.sprSize.setContentSize(12*t.Length,12*t.Width);for(var e=[],a=function(a){var o=t["BuildMat"+a];if(o&&o.length>0){var n=t["BuildMat"+a+"Count"],i=r.DataMgr.CargoConfig.find(function(t){return t.id==o});e.push(i.Name+"*"+n)}},o=0;o<4;o++)a(o);if(e.length>0){var n=e[0];for(o=1;o<e.length;o++){n+="\n"+e[o]}this.lblConsumption.string=n}else this.lblConsumption.string=""},e.prototype.onClick=function(){c.default.Show(this.info)},e.prototype.onBuildClick=function(){for(var t=[],e=0;e<4;e++){var a=this.info["BuildMat"+e];if(a&&a.length>0){var c=this.info["BuildMat"+e+"Count"];t.push([a,c])}}var l=!0;if(t.forEach(function(t){r.DataMgr.myCargoData.find(function(e){return e.id==t[0]}).amount<t[1]&&(l=!1)}),l){var s=[];for(e=0;e<4;e++){var d=this.info["NeedTech"+e];d&&d.length>0&&s.push(d)}l=!0;var u=[];s.forEach(function(t){if(!r.DataMgr.myTechData.find(function(e){return e.id==t}).finished){l=!1;var e=r.DataMgr.TechConfig.find(function(e){return e.id==t});u.push(e.Name)}}),l?(o.default.Hide(),n.default.Instance.enterBuildMode(this.info)):i.default.PopupWith1Button("尚未研究所需科技",u.join(", "),"确定",null)}else i.default.PopupWith1Button("建筑材料不足","","确定",null)},__decorate([d(cc.Label)],e.prototype,"lblName",void 0),__decorate([d(cc.Label)],e.prototype,"lblSize",void 0),__decorate([d(cc.Node)],e.prototype,"sprSize",void 0),__decorate([d(cc.Label)],e.prototype,"lblConsumption",void 0),e=__decorate([s],e)}(cc.Component);a.default=u,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildPanel":"BuildPanel","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./UI/BuildingInfoPanel":"BuildingInfoPanel"}],BuildingInfoPanel:[function(t,e,a){"use strict";cc._RF.push(e,"3a0f2BiXhFBZ7J7uLjk6n4I","BuildingInfoPanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../DataMgr"),n=cc._decorator,r=n.ccclass,i=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblName=null,e.lblBuildingMat=null,e.lblHuman=null,e.lblRaw=null,e.lblOut=null,e.sprPic=null,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.node.active=!1},e.prototype.refresh=function(t){this.lblName.string=t.Name;for(var e=[],a=function(a){var n=t["BuildMat"+a];if(n&&n.length>0){var r=t["BuildMat"+a+"Count"],i=o.DataMgr.CargoConfig.find(function(t){return t.id==n});e.push(i.Name+"*"+r)}},n=0;n<4;n++)a(n);this.lblBuildingMat.string=e.join("\n"),this.lblHuman.string=t.MaxHuman,e=[];var r=function(a){var n=t["Raw"+a];if(n&&n.length>0){var r=t["Raw"+a+"Rate"],i=o.DataMgr.CargoConfig.find(function(t){return t.id==n});e.push(i.Name+"*"+r)}};for(n=0;n<4;n++)r(n);this.lblRaw.string=e.join("\n"),e=[];var i=function(a){var n=t["Out"+a];if(n&&n.length>0){var r=t["Out"+a+"Rate"],i=o.DataMgr.CargoConfig.find(function(t){return t.id==n});e.push(i.Name+"*"+r)}};for(n=0;n<4;n++)i(n);this.lblOut.string=e.join("\n")},e.Show=function(t){var e;e="string"==typeof t?o.DataMgr.BuildingConfig.find(function(e){return e.id==t}):t,a.Instance.node.active=!0,a.Instance.refresh(e)},e.prototype.close=function(){this.node.active=!1},__decorate([i(cc.Label)],e.prototype,"lblName",void 0),__decorate([i(cc.Label)],e.prototype,"lblBuildingMat",void 0),__decorate([i(cc.Label)],e.prototype,"lblHuman",void 0),__decorate([i(cc.Label)],e.prototype,"lblRaw",void 0),__decorate([i(cc.Label)],e.prototype,"lblOut",void 0),__decorate([i(cc.Sprite)],e.prototype,"sprPic",void 0),e=a=__decorate([r],e);var a}(cc.Component);a.default=c,cc._RF.pop()},{"../DataMgr":"DataMgr"}],Building:[function(t,e,a){"use strict";cc._RF.push(e,"3d090TfsndH9pF8dNZnNchl","Building"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./ArkUI"),n=cc._decorator,r=n.ccclass,i=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblName=null,e}return __extends(e,t),e.prototype.onClick=function(){o.default.Instance.selectBuilding(this)},e.prototype.setInfo=function(t,e){this.info=t,this.data=e,this.lblName&&(this.lblName.string=t.Name),this.node.setContentSize(100*t.Length,100*t.Width)},__decorate([i(cc.Label)],e.prototype,"lblName",void 0),e=__decorate([r],e)}(cc.Component);a.default=c,cc._RF.pop()},{"./ArkUI":"ArkUI"}],CurrencyFormatter:[function(t,e,a){"use strict";cc._RF.push(e,"4455937OnBAOLdRb9e7YASo","CurrencyFormatter"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=(o.property,function(){function t(){}return t.formatBTC=function(t){if(Math.abs(t)<1e-7)return"0";var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.max(0,5-e))},t.formatNAS=function(t){var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.min(3,Math.max(0,4-e)))},t.formatCNY=function(t){if(Math.abs(t)<.005)return"0";var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.min(2,Math.max(0,4-e)))},t=__decorate([n],t)}());a.default=r,cc._RF.pop()},{}],CvsMain:[function(t,e,a){"use strict";cc._RF.push(e,"69237yn4edJBK/5XvDAGlzX","CvsMain"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=o.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.fitter=null,e.uiContainer=null,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.uiContainer.children.forEach(function(t){return t.active=!0})},e.EnterUI=function(t){this.Instance.uiContainer.children.forEach(function(e){e.getComponent(t)?e.active=!0:e.active=!1})},e.prototype.update=function(){var t=cc.view.getVisibleSize();this.lastVisibleSize&&t.equals(this.lastVisibleSize)||(t.width>=t.height?(this.fitter.rotation=0,this.fitter.scale=1,this.fitter.setContentSize(1080/t.height*t.width,1080)):(this.fitter.rotation=90,this.fitter.setContentSize(1080/t.width*t.height,1080),this.fitter.scale=t.width/1080),this.lastVisibleSize=t)},__decorate([r(cc.Node)],e.prototype,"fitter",void 0),__decorate([r(cc.Node)],e.prototype,"uiContainer",void 0),e=a=__decorate([n],e);var a}(cc.Component);a.default=i,cc._RF.pop()},{}],DataMgr:[function(t,e,a){"use strict";cc._RF.push(e,"c6c13KfXfRK06sYYQzi7BU0","DataMgr"),Object.defineProperty(a,"__esModule",{value:!0});var o=function(){function t(){}return t.getArkSpeedByTech=function(t){return t?500:200},t.GetArkSizeByRecharge=function(t){for(var e=this.RechargeToArkSize.length-1;e>=0;e--)if(t>=this.RechargeToArkSize[e][0])return this.RechargeToArkSize[e][1]},t.getMethaneCostOfAttack=function(t,e,a,o){return.01*t*(e+a+o)},t.calcCurrentMoneyInIsland=function(t){var e=t.occupant&&t.occupant.length>0;return t.money*(e?Math.exp(-t.miningRate*(Number(new Date)-t.lastMineTime)/36e5):1)},t.readData=function(){try{var e=JSON.parse(cc.sys.localStorage.getItem("user0"));t.myData=e,t.myBuildingData=JSON.parse(cc.sys.localStorage.getItem("user0Building")),t.myCargoData=JSON.parse(cc.sys.localStorage.getItem("user0Cargo")),t.myTechData=JSON.parse(cc.sys.localStorage.getItem("user0Tech")),t.currentWorkingTech=JSON.parse(cc.sys.localStorage.getItem("user0CurrentWorkingTech")),t.changed=!0,console.log("finish read data",e)}catch(t){console.error(t)}},t.writeData=function(){try{t.myData&&(cc.sys.localStorage.setItem("user0",JSON.stringify(t.myData)),cc.sys.localStorage.setItem("user0Building",JSON.stringify(t.myBuildingData)),cc.sys.localStorage.setItem("user0Cargo",JSON.stringify(t.myCargoData)),cc.sys.localStorage.setItem("user0Tech",JSON.stringify(t.myTechData)),cc.sys.localStorage.setItem("user0CurrentWorkingTech",JSON.stringify(t.currentWorkingTech)),this.autosaveCountdown+=15,console.log("finish write data",t.myData,t.myBuildingData))}catch(t){console.error(t)}},t.clearData=function(){cc.sys.localStorage.removeItem("user0"),cc.sys.localStorage.removeItem("user0Building")},t.idleWorkers=0,t.populationLimit=0,t.aboveIronMine=!1,t.othersData={},t.allIslandData={},t.changed=!1,t.populationGrowPerMin=0,t.researchRatePerMin=0,t.outputRates={},t.SmallArkSize=7,t.StdArkSize=9,t.LargeArkSize=21,t.MethaneCostPerKmPerSize=.005,t.RechargeToArkSize=[[0,9],[.001,13],[.006,17],[.01,21],[.1,25],[1,30],[4,35]],t.autosaveCountdown=15,t}();a.DataMgr=o;var n=function(){this.currentLocation=cc.Vec2.ZERO,this.population=8,this.speed=0};a.UserData=n;var r=function(){};a.BuildingInfo=r;var i=function(){this.workers=0,this.isWorking=!1};a.BuildingData=i;var c=function(){};a.CargoInfo=c;var l=function(){this.amount=0};a.CargoData=l;var s=function(){};a.TechInfo=s;var d=function(){};a.TechData=d;var u=function(){};a.MineInfo=u;var p=function(){this.tankPower=0,this.chopperPower=0,this.shipPower=0,this.money=0,this.sponsorName="",this.miningRate=.02,this.balanceMap=0};a.IslandData=p;var h=function(){function t(){this.i=0,this.j=0}return t.prototype.clone=function(){var e=new t;return e.i=this.i,e.j=this.j,e},Object.defineProperty(t,"ZERO",{get:function(){return new t},enumerable:!0,configurable:!0}),t}();a.IJ=h,cc._RF.pop()},{}],DialogPanel:[function(t,e,a){"use strict";cc._RF.push(e,"c0958fmSyFAp6wyHbHS0e10","DialogPanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=o.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblTitle=null,e.lblContext=null,e.btn0=null,e.lblBtn0=null,e.btn1=null,e.lblBtn1=null,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.hide()},e.PopupWithOKButton=function(t,e){a.PopupWith1Button(t,e,"确定",null)},e.PopupWith1Button=function(t,e,a,o){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=o,this.Instance.lblBtn0.string=a,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(0,0),this.Instance.btn1.active=!1},e.PopupWith2Buttons=function(t,e,a,o,n,r){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=o,this.Instance.lblBtn0.string=a,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(-150,0),this.Instance.func1=r,this.Instance.lblBtn1.string=n,this.Instance.btn1.active=!0,this.Instance.btn1.position=new cc.Vec2(150,0)},e.prototype.onBtn0Click=function(){this.func0&&this.func0(),this.hide()},e.prototype.onBtn1Click=function(){this.func1&&this.func1(),this.hide()},e.prototype.show=function(){this.node.active=!0},e.prototype.hide=function(){this.node.active=!1},__decorate([r(cc.Label)],e.prototype,"lblTitle",void 0),__decorate([r(cc.Label)],e.prototype,"lblContext",void 0),__decorate([r(cc.Node)],e.prototype,"btn0",void 0),__decorate([r(cc.Label)],e.prototype,"lblBtn0",void 0),__decorate([r(cc.Node)],e.prototype,"btn1",void 0),__decorate([r(cc.Label)],e.prototype,"lblBtn1",void 0),e=a=__decorate([n],e);var a}(cc.Component);a.default=i,cc._RF.pop()},{}],EditNicknamePanel:[function(t,e,a){"use strict";cc._RF.push(e,"abc4c7by+pEG49b6MBNEz6Y","EditNicknamePanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../DataMgr"),n=t("./ToastPanel"),r=t("../HomeUI"),i=t("./FlagMgr"),c=cc._decorator,l=c.ccclass,s=c.property,d=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.edtNickname=null,e.flagContainer=null,e.flagTemplate=null,e.selectFrame=null,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.node.active=!1,this.init()},e.prototype.init=function(){var t=this;this.flagTemplate.active=!0,i.FlagMgr.flagNames.forEach(function(e){var a=cc.instantiate(t.flagTemplate);a.name=e,a.parent=t.flagContainer;var o=a.getComponent(cc.Sprite);i.FlagMgr.setFlag(o,e),a.on(cc.Node.EventType.TOUCH_END,function(){return t.onFlagClick(a)})}),this.flagTemplate.active=!1},e.prototype.onEnable=function(){var t=this;this.edtNickname.string=o.DataMgr.myData?o.DataMgr.myData.nickname:r.default.Instance.lblNickname.string,this.selectedCountry=r.default.Instance.country?r.default.Instance.country:o.DataMgr.myData?o.DataMgr.myData.country:null;var e=this.flagContainer.children.find(function(e){return e.name==t.selectedCountry});e?(this.selectFrame.active=!0,this.selectFrame.position=this.selectFrame.parent.convertToNodeSpaceAR(this.flagContainer.convertToWorldSpaceAR(e.position))):this.selectFrame.active=!1},e.prototype.onFlagClick=function(t){this.selectFrame.active=!0,this.selectFrame.position=this.selectFrame.parent.convertToNodeSpaceAR(this.flagContainer.convertToWorldSpaceAR(t.position)),this.selectedCountry=t.name},e.prototype.onConfirmClick=function(){o.DataMgr.myData&&(o.DataMgr.myData.nickname=this.edtNickname.string,o.DataMgr.myData.country=this.selectedCountry),r.default.Instance.lblNickname.string=this.edtNickname.string,r.default.Instance.country=this.selectedCountry,n.default.Toast("昵称、国家设置成功"),this.close()},e.prototype.close=function(){this.node.active=!1},__decorate([s(cc.EditBox)],e.prototype,"edtNickname",void 0),__decorate([s(cc.Node)],e.prototype,"flagContainer",void 0),__decorate([s(cc.Node)],e.prototype,"flagTemplate",void 0),__decorate([s(cc.Node)],e.prototype,"selectFrame",void 0),e=a=__decorate([l],e);var a}(cc.Component);a.default=d,cc._RF.pop()},{"../DataMgr":"DataMgr","../HomeUI":"HomeUI","./FlagMgr":"FlagMgr","./ToastPanel":"ToastPanel"}],FlagMgr:[function(t,e,a){"use strict";cc._RF.push(e,"25e0fkSAGlFqq0SWMH7sg7L","FlagMgr"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=(o.property,function(){function t(){}return e=t,t.setFlag=function(t,a){try{e.flagNames.find(function(t){return t==a})?cc.loader.loadRes("flags/"+a,cc.SpriteFrame,function(e,a){e||(t.spriteFrame=a)}):t.spriteFrame=null}catch(e){console.error(e),t.spriteFrame=null}},t.flagNames=["cn","us","jp","kr","eng","ru","de","at","au","be","bg","br","ch","cl","co","cr","cs","dk","es","fr","gh","hr","ir","is","it","kp","ma","mx","ng","nir","nl","pa","pe","pl","pt","py","sa","sco","se","sk","sn","tn","uy","wal"],t=e=__decorate([n],t);var e}());a.FlagMgr=r,cc._RF.pop()},{}],Foreground:[function(t,e,a){"use strict";cc._RF.push(e,"c7a1eqdirtJGpHjde8W3SsV","Foreground"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.node.children.forEach(function(t){t.active||(t.active=!0,t.active=!1)})},e=__decorate([n],e)}(cc.Component));a.default=r,cc._RF.pop()},{}],HomeUI:[function(t,e,a){"use strict";cc._RF.push(e,"458fd6d6ChEGo+U+drv+haG","HomeUI"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./CvsMain"),n=t("./BaseUI"),r=t("./MainCtrl"),i=t("./DataMgr"),c=t("./WorldUI"),l=t("./UI/ToastPanel"),s=t("./BlockchainMgr"),d=t("./UI/EditNicknamePanel"),u=t("./UI/FlagMgr"),p=cc._decorator,h=p.ccclass,f=p.property,g=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblTotalArkCount=null,e.btnClaim0=null,e.btnClaim1=null,e.btnClaim2=null,e.lblNickname=null,e.sprFlag=null,e.lblBlockchainAddress=null,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.node.active=!1},e.prototype.start=function(){l.default.Toast("正在读取您的钱包信息，如果您在用钱包玩游戏，请稍候")},e.prototype.update=function(){this.lblBlockchainAddress.string=s.default.WalletAddress?s.default.WalletAddress:"未获取到钱包地址",i.DataMgr.myData?(this.btnClaim0.getComponentInChildren(cc.Label).string=i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize?"进入":"无法领取",this.btnClaim1.getComponentInChildren(cc.Label).string=i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize?"领取":i.DataMgr.myData.arkSize<i.DataMgr.LargeArkSize?"进入":"无法领取",this.btnClaim2.getComponentInChildren(cc.Label).string=i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize?"领取":i.DataMgr.myData.arkSize<i.DataMgr.LargeArkSize?"无法领取":"进入",this.btnClaim0.interactable=i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize,this.btnClaim1.interactable=i.DataMgr.myData.arkSize<i.DataMgr.LargeArkSize,this.btnClaim2.interactable=i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize||i.DataMgr.myData.arkSize>=i.DataMgr.LargeArkSize,i.DataMgr.myData.nickname&&(this.lblNickname.string=i.DataMgr.myData.nickname),i.DataMgr.myData.country&&(this.country=i.DataMgr.myData.country)):(this.btnClaim0.getComponentInChildren(cc.Label).string="领取",this.btnClaim1.getComponentInChildren(cc.Label).string="领取",this.btnClaim2.getComponentInChildren(cc.Label).string="领取");r.default.Ticks%50==0&&u.FlagMgr.setFlag(this.sprFlag,this.country),r.default.Ticks%100==0&&(this.lblTotalArkCount.string=(Object.keys(i.DataMgr.othersData).length+1).toFixed())},e.prototype.onClaim=function(t,e){if(!this.lblNickname.string||!this.country)return d.default.Instance.node.active=!0,void l.default.Toast("请先设置国旗和昵称");if(i.DataMgr.myData)switch(e){case"0":i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize&&o.default.EnterUI(c.default);break;case"1":i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize?s.default.Instance.claimArk(0):i.DataMgr.myData.arkSize<i.DataMgr.LargeArkSize&&o.default.EnterUI(c.default);break;case"2":i.DataMgr.myData.arkSize<i.DataMgr.StdArkSize?s.default.Instance.claimArk(.01):i.DataMgr.myData.arkSize>=i.DataMgr.LargeArkSize&&o.default.EnterUI(c.default)}else switch(e){case"0":i.DataMgr.myData=r.default.Instance.generateSmallArkData(),l.default.Toast("领取成功，可进入方舟");break;case"1":s.default.Instance.claimArk(0);break;case"2":s.default.Instance.claimArk(.01)}},e.prototype.onBtnEditNicknameClick=function(){d.default.Instance.node.active=!0},e.prototype.onBtnSponsorClick=function(){},e.prototype.onAddressClick=function(){window.open("https://explorer.nebulas.io/address/"+s.default.WalletAddress)},e.prototype.onBookClick=function(){console.log("哪有白皮书")},e.prototype.onBtnClearStorageClick=function(){cc.sys.localStorage.clear(),setTimeout(function(){return location.reload()},100),console.log("成功清除存储")},e.prototype.onTestCheat0Click=function(){i.DataMgr.myCargoData.forEach(function(t){return t.amount=1e6})},__decorate([f(cc.Label)],e.prototype,"lblTotalArkCount",void 0),__decorate([f(cc.Button)],e.prototype,"btnClaim0",void 0),__decorate([f(cc.Button)],e.prototype,"btnClaim1",void 0),__decorate([f(cc.Button)],e.prototype,"btnClaim2",void 0),__decorate([f(cc.Label)],e.prototype,"lblNickname",void 0),__decorate([f(cc.Sprite)],e.prototype,"sprFlag",void 0),__decorate([f(cc.Label)],e.prototype,"lblBlockchainAddress",void 0),e=a=__decorate([h],e);var a}(n.default);a.default=g,cc._RF.pop()},{"./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./MainCtrl":"MainCtrl","./UI/EditNicknamePanel":"EditNicknamePanel","./UI/FlagMgr":"FlagMgr","./UI/ToastPanel":"ToastPanel","./WorldUI":"WorldUI"}],HouseBuilding:[function(t,e,a){"use strict";cc._RF.push(e,"4551bhwrptGmI96ad9hW5WZ","HouseBuilding"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./Building"),n=cc._decorator,r=n.ccclass,i=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblPopulation=null,e}return __extends(e,t),e.prototype.setInfo=function(e,a){t.prototype.setInfo.call(this,e,a),this.lblPopulation.string=e.Arg0},__decorate([i(cc.Label)],e.prototype,"lblPopulation",void 0),e=__decorate([r],e)}(o.default);a.default=c,cc._RF.pop()},{"./Building":"Building"}],IntroUI:[function(t,e,a){"use strict";cc._RF.push(e,"09076VctrZEVKhEeIiQ5hEn","IntroUI"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../CvsMain"),n=t("../HomeUI"),r=cc._decorator,i=r.ccclass,c=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onBtnStartClick=function(){o.default.EnterUI(n.default)},e=__decorate([i],e)}(cc.Component));a.default=c,cc._RF.pop()},{"../CvsMain":"CvsMain","../HomeUI":"HomeUI"}],IronMine:[function(t,e,a){"use strict";cc._RF.push(e,"ff0cb7j7qpO/Yov9EsIMZAo","IronMine"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=(o.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){if(this.gra=this.getComponent(cc.Graphics),this.col=this.getComponent(cc.PolygonCollider),this.col.points.length>=3&&this.gra){this.gra.moveTo(this.col.points[0].x,this.col.points[0].y);for(var t=1;t<this.col.points.length;t++){var e=this.col.points[t];this.gra.lineTo(e.x,e.y)}this.gra.close(),this.gra.fill()}},e=__decorate([n],e)}(cc.Component));a.default=r,cc._RF.pop()},{}],IslandInfoFrame:[function(t,e,a){"use strict";cc._RF.push(e,"c2894Vc0LZARZptbw433jyZ","IslandInfoFrame"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../DataMgr"),n=t("../Utils/CurrencyFormatter"),r=cc._decorator,i=r.ccclass,c=r.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblName=null,e.lblLeftMoney=null,e.lblMiningSpeed=null,e.lblOccupant=null,e}return __extends(e,t),e.prototype.refresh=function(t){if(t){this.lblName.string=t.sponsorName;var e=o.DataMgr.calcCurrentMoneyInIsland(t);this.lblLeftMoney.string=n.default.formatNAS(e/1e18)+"NAS";var a=t.miningRate*e/1e18;if(this.lblMiningSpeed.string=n.default.formatNAS(a)+"NAS/小时",t.occupant&&t.occupant.length>0){var r=t.occupant==o.DataMgr.myData.address?o.DataMgr.myData:o.DataMgr.othersData[t.occupant];this.lblOccupant.string=r?r.nickname:t.occupant}else this.lblOccupant.string="(无)"}},__decorate([c(cc.Label)],e.prototype,"lblName",void 0),__decorate([c(cc.Label)],e.prototype,"lblLeftMoney",void 0),__decorate([c(cc.Label)],e.prototype,"lblMiningSpeed",void 0),__decorate([c(cc.Label)],e.prototype,"lblOccupant",void 0),e=__decorate([i],e)}(cc.Component);a.default=l,cc._RF.pop()},{"../DataMgr":"DataMgr","../Utils/CurrencyFormatter":"CurrencyFormatter"}],Island:[function(t,e,a){"use strict";cc._RF.push(e,"d5cb37wYS9LEY2kNMygFSvm","Island"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../MainCtrl"),n=t("../WorldUI"),r=cc._decorator,i=r.ccclass,c=(r.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.btnNode=new cc.Node,this.btnNode.parent=this.node,this.btnNode.on(cc.Node.EventType.TOUCH_END,this.onClick.bind(this))},e.prototype.setData=function(t){this.data=t},e.prototype.update=function(){o.default.Ticks%60==0&&(this.infoFrame&&this.infoFrame.refresh(this.data),this.btnNode.setContentSize(this.node.width+5,this.node.height+5)),this.node.position=this.data.location.mul(n.default.Instance.zoomScale)},e.prototype.onLinkClick=function(){var t=this.data.sponsorLink;t&&t.length>0&&window.open(t)},e.prototype.onClick=function(){n.default.Instance.selectIsland(this.node)},e=__decorate([i],e)}(cc.Component));a.default=c,cc._RF.pop()},{"../MainCtrl":"MainCtrl","../WorldUI":"WorldUI"}],MainCtrl:[function(t,e,a){"use strict";cc._RF.push(e,"162b9/mIe1LjqpHBpjQnzp+","MainCtrl"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./CvsMain"),n=t("./HomeUI"),r=t("./DataMgr"),i=t("./WorldUI"),c=t("./UI/IntroUI"),l=t("./World/Island"),s=t("./UI/ToastPanel"),d=cc._decorator,u=d.ccclass,p=(d.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,r.DataMgr.readData(),o.default.Instance.uiContainer.getChildByName("WorldUI").active=!0,cc.loader.loadRes("Building",function(t,e){console.log("Building loaded",e),r.DataMgr.BuildingConfig=e,r.DataMgr.myBuildingData||(r.DataMgr.myBuildingData=[])}.bind(this)),cc.loader.loadRes("Cargo",function(t,e){console.log("Cargo loaded",e,r.DataMgr.myCargoData),r.DataMgr.CargoConfig=e,r.DataMgr.myCargoData||(r.DataMgr.myCargoData=[],r.DataMgr.CargoConfig.forEach(function(t){var e=new r.CargoData;e.id=t.id,e.amount=0,r.DataMgr.myCargoData.push(e)}))}.bind(this)),cc.loader.loadRes("Tech",function(t,e){console.log("Tech loaded",e,r.DataMgr.myTechData),r.DataMgr.TechConfig=e,r.DataMgr.myTechData||(r.DataMgr.myTechData=[],r.DataMgr.TechConfig.forEach(function(t){var e=new r.TechData;e.id=t.id,e.filledWork=0,e.finished=!1,r.DataMgr.myTechData.push(e)}))}.bind(this))},e.prototype.start=function(){o.default.EnterUI(c.default),r.DataMgr.IronMineConfig=[],i.default.Instance.mineContainer.children.forEach(function(t){var e=t.getComponent(cc.PolygonCollider);if(e){var a=new r.MineInfo;a.polygonCollider=e;var o=[];e.points.forEach(function(t){o.push(e.node.position.add(e.offset).add(t))}),a.points=o,r.DataMgr.IronMineConfig.push(a)}}),i.default.Instance.islandContainer.children.forEach(function(t){var e=t.getComponent(l.default),a=new r.IslandData;a.id=parseInt(e.name),a.location=e.node.position,r.DataMgr.allIslandData[a.id]=a,e.setData(a)});var t=this.node.getComponent(cc.AudioSource);setTimeout(function(){t.play()},1e3)},e.prototype.gotoHome=function(){o.default.EnterUI(n.default)},e.prototype.generateSmallArkData=function(){var t=new r.UserData;t.arkSize=r.DataMgr.SmallArkSize;var e=Math.random()*Math.PI;return t.locationX=4e3*Math.cos(e),t.locationY=4e3*Math.sin(e),t.speed=0,t.nickname=n.default.Instance.lblNickname.string,t.country=n.default.Instance.country,this.calcSail(t),t},e.prototype.update=function(t){var e=this;if(r.DataMgr.BuildingConfig&&r.DataMgr.TechConfig&&r.DataMgr.CargoConfig){if(r.DataMgr.myData){r.DataMgr.populationLimit=0,r.DataMgr.researchRatePerMin=0,r.DataMgr.aboveIronMine=!1,r.DataMgr.outputRates={};var o=0;for(var n in this.calcSail(r.DataMgr.myData),r.DataMgr.othersData)this.calcSail(r.DataMgr.othersData[n]);if(r.DataMgr.IronMineConfig.forEach(function(t){cc.Intersection.pointInPolygon(r.DataMgr.myData.currentLocation,t.points)&&(r.DataMgr.aboveIronMine=!0)}),r.DataMgr.myBuildingData&&r.DataMgr.myBuildingData.forEach(function(a){if(a.isWorking=!1,o+=a.workers,e.isHouse(a.id)){var n=r.DataMgr.BuildingConfig.find(function(t){return t.id==a.id});r.DataMgr.populationLimit+=parseInt(n.Arg0)}else if("research239"==a.id){if(r.DataMgr.currentWorkingTech){n=r.DataMgr.BuildingConfig.find(function(t){return t.id==a.id});var i=r.DataMgr.TechConfig.find(function(t){return t.id==r.DataMgr.currentWorkingTech}),c=r.DataMgr.myTechData.find(function(t){return t.id==r.DataMgr.currentWorkingTech}),l=Math.min(i.Work-c.filledWork,a.workers/n.MaxHuman*10/60*t);c.filledWork+=l,c.filledWork>=i.Work&&(c.finished=!0,r.DataMgr.currentWorkingTech=null,s.default.Toast("新科技研究完成，请制定下一个研究计划")),r.DataMgr.researchRatePerMin+=1*a.workers}}else{if(a.workers<=0)return;n=r.DataMgr.BuildingConfig.find(function(t){return t.id==a.id});for(var d=[],u=0;u<4;u++){var p=n["Raw"+u];if(p&&p.length>0){var h=n["Raw"+u+"Rate"]/n.MaxHuman*a.workers;d.push([p,h/60*t]),r.DataMgr.outputRates[p]||(r.DataMgr.outputRates[p]=0),r.DataMgr.outputRates[p]-=h}}var f=!0;if(d.forEach(function(t){if(f){var e=r.DataMgr.myCargoData.find(function(e){return e.id==t[0]});e&&e.amount>t[1]?t.push(e):f=!1}}),f){d.forEach(function(t){t[2].amount-=t[1]});var g=function(e){var o=n["Out"+e];if(o&&o.length>0){var i=r.DataMgr.myCargoData.find(function(t){return t.id==o});i||((i=new r.CargoData).id=o,i.amount=0,r.DataMgr.myCargoData.push(i));var c=n["Out"+e+"Rate"]/n.MaxHuman*a.workers;i.amount+=c/60*t,r.DataMgr.outputRates[o]||(r.DataMgr.outputRates[o]=0),r.DataMgr.outputRates[o]+=c}};for(u=0;u<4;u++)g(u);a.isWorking=!0}}}),r.DataMgr.idleWorkers=r.DataMgr.myData.population-o,r.DataMgr.myData&&r.DataMgr.myCargoData){var i=1*r.DataMgr.myData.population,c=i/60*t;r.DataMgr.outputRates.fish34509||(r.DataMgr.outputRates.fish34509=0),r.DataMgr.outputRates.fish34509-=i;var l=c;if(r.DataMgr.CargoConfig.forEach(function(t){if("TRUE"==t.IsFood){var e=r.DataMgr.myCargoData.find(function(e){return e.id==t.id});if(e&&e.amount>0){var a=Math.min(c,e.amount);c-=a,e.amount-=a}}}),c<=0&&r.DataMgr.myData.population<r.DataMgr.populationLimit){var d=(10+Math.sqrt(r.DataMgr.myData.population))/10*30,u=d/60*t;Math.random()<u&&(r.DataMgr.myData.population+=1,r.DataMgr.idleWorkers+=1),r.DataMgr.populationGrowPerMin=d}else if(c>0){var p=c/l,h=Math.max(0,r.DataMgr.myData.population-10)*p;u=h/60*t;if(Math.random()<u)if(r.DataMgr.idleWorkers>0)r.DataMgr.myData.population-=1,r.DataMgr.idleWorkers-=1;else{var f=r.DataMgr.myBuildingData.filter(function(t){return t.workers>0&&"fisher8032"!=t.id});if(f.length>0)f[Math.floor(Math.random()*f.length)].workers-=1,r.DataMgr.myData.population-=1}r.DataMgr.populationGrowPerMin=-h}else r.DataMgr.populationGrowPerMin=0}r.DataMgr.autosaveCountdown<=0&&r.DataMgr.writeData()}r.DataMgr.autosaveCountdown-=t,a.Ticks++}},e.prototype.calcSail=function(t){if(t.speed&&t.speed>0&&t.destinationX&&t.destinationY){var e=t.lastLocationTime,o=Number(new Date),n=new cc.Vec2(t.locationX,t.locationY),r=new cc.Vec2(t.destinationX,t.destinationY),i=r.sub(n).mag()/(t.speed/60)*1e3,c=a.lerpVec2(n,r,(o-e)/i,!0);t.currentLocation=c}else t.currentLocation=new cc.Vec2(t.locationX,t.locationY)},e.lerp=function(t,e,a,o){return o&&(a=Math.max(0,Math.min(1,a))),t*(1-a)+e*a},e.lerpVec2=function(t,e,a,o){return o&&(a=Math.max(0,Math.min(1,a))),t.mul(1-a).add(e.mul(a))},e.prototype.isHouse=function(t){return"dorm08821"==t||"house8523"==t},e.Ticks=0,e=a=__decorate([u],e);var a}(cc.Component));a.default=p,cc._RF.pop()},{"./CvsMain":"CvsMain","./DataMgr":"DataMgr","./HomeUI":"HomeUI","./UI/IntroUI":"IntroUI","./UI/ToastPanel":"ToastPanel","./World/Island":"Island","./WorldUI":"WorldUI"}],Road:[function(t,e,a){"use strict";cc._RF.push(e,"57853rAZexG4pEfR+Uh0ALl","Road"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./Building"),n=cc._decorator,r=n.ccclass,i=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([r],e)}(o.default));a.default=i,cc._RF.pop()},{"./Building":"Building"}],SpecialArk:[function(t,e,a){"use strict";cc._RF.push(e,"af740uwBhpJLINK3QpsTq54","SpecialArk"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../WorldUI"),n=t("../DialogPanel"),r=cc._decorator,i=r.ccclass,c=r.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.strName="",e.distanceThreshold=1e4,e.strTooFar="",e.strInfo="",e}return __extends(e,t),e.prototype.onLoad=function(){this.location=this.node.position},e.prototype.onClick=function(){o.default.Instance.selectSpecialArk(this.node)},e.prototype.refreshZoom=function(t){this.node.position=this.location.mul(t)},e.prototype.update=function(t){this.refreshZoom(o.default.Instance.zoomScale)},e.prototype.showInfo=function(t){t>this.distanceThreshold?n.default.PopupWithOKButton(this.strName,this.strTooFar):n.default.PopupWithOKButton(this.strName,this.strInfo)},__decorate([c(String)],e.prototype,"strName",void 0),__decorate([c(cc.Float)],e.prototype,"distanceThreshold",void 0),__decorate([c(String)],e.prototype,"strTooFar",void 0),__decorate([c(String)],e.prototype,"strInfo",void 0),e=__decorate([i],e)}(cc.Component);a.SpecialArk=l,cc._RF.pop()},{"../DialogPanel":"DialogPanel","../WorldUI":"WorldUI"}],SponsorIslandPanel:[function(t,e,a){"use strict";cc._RF.push(e,"6fe40yau5dLRKwAtiP/MgV8","SponsorIslandPanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("../BlockchainMgr"),n=t("../Utils/CurrencyFormatter"),r=t("../DataMgr"),i=cc._decorator,c=i.ccclass,l=i.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.edtName=null,e.edtLink=null,e.edtValue=null,e.lblCurMoney=null,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.node.active=!1},e.prototype.setData=function(t){if(this.island=t,t.data.sponsor==o.default.WalletAddress)this.lblCurMoney.string="0";else{var e=r.DataMgr.calcCurrentMoneyInIsland(t.data);this.lblCurMoney.string=n.default.formatNAS(1.101*e/1e18)}},e.prototype.onConfirmClick=function(){o.default.Instance.sponsor(this.island.data.id,this.edtName.string,this.edtLink.string,parseFloat(this.edtValue.string))},e.prototype.close=function(){this.node.active=!1},__decorate([l(cc.EditBox)],e.prototype,"edtName",void 0),__decorate([l(cc.EditBox)],e.prototype,"edtLink",void 0),__decorate([l(cc.EditBox)],e.prototype,"edtValue",void 0),__decorate([l(cc.Label)],e.prototype,"lblCurMoney",void 0),e=a=__decorate([c],e);var a}(cc.Component);a.default=s,cc._RF.pop()},{"../BlockchainMgr":"BlockchainMgr","../DataMgr":"DataMgr","../Utils/CurrencyFormatter":"CurrencyFormatter"}],TaskMgr:[function(t,e,a){"use strict";cc._RF.push(e,"8b016C7S51BeY/RKmLSDzh4","TaskMgr"),Object.defineProperty(a,"__esModule",{value:!0});var o=function(){function t(){}return t.list=[{description:"",func:function(){}}],t}();a.default=o,cc._RF.pop()},{}],TechButton:[function(t,e,a){"use strict";cc._RF.push(e,"381b4B+yDRNAIom8tWyu99R","TechButton"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./DataMgr"),n=cc._decorator,r=n.ccclass,i=n.property,c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblName=null,e.lblWork=null,e.prgWork=null,e.gear=null,e}return __extends(e,t),e.prototype.setAndRefresh=function(t,e){this.info=t,this.lblName.string=t.Name,this.data?this.lblWork.string=this.data.filledWork.toFixed()+" / "+t.Work:this.lblWork.string=t.Work.toString(),this.data=e,this.prgWork.progress=e.filledWork/t.Work},e.prototype.update=function(t){this.prgWork.progress=this.data.filledWork/this.info.Work,o.DataMgr.currentWorkingTech==this.info.id?(this.gear.active=!0,this.gear.rotation+=18*o.DataMgr.researchRatePerMin*t):this.gear.active=!1},e.prototype.onClick=function(){o.DataMgr.currentWorkingTech!=this.info.id?o.DataMgr.currentWorkingTech=this.info.id:o.DataMgr.currentWorkingTech=null},__decorate([i(cc.Label)],e.prototype,"lblName",void 0),__decorate([i(cc.Label)],e.prototype,"lblWork",void 0),__decorate([i(cc.ProgressBar)],e.prototype,"prgWork",void 0),__decorate([i(cc.Node)],e.prototype,"gear",void 0),e=__decorate([r],e)}(cc.Component);a.default=c,cc._RF.pop()},{"./DataMgr":"DataMgr"}],TechPanel:[function(t,e,a){"use strict";cc._RF.push(e,"3402dUp2TBLFIsk2dVlT1d5","TechPanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./DataMgr"),n=t("./TechButton"),r=cc._decorator,i=r.ccclass,c=r.property,l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.buttonContainer=null,e.buttonTemplate=null,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.node.active=!1},e.prototype.start=function(){var t=this;o.DataMgr.TechConfig.forEach(function(e){var a=cc.instantiate(t.buttonTemplate);a.parent=t.buttonContainer;var r=a.getComponent(n.default),i=o.DataMgr.myTechData.find(function(t){return t.id==e.id});r.setAndRefresh(e,i),a.active=!0}),this.buttonTemplate.active=!1},e.prototype.onEnable=function(){},e.prototype.refresh=function(){},e.Show=function(){a.Instance.node.active=!0},e.Hide=function(){a.Instance.node.active=!1},e.prototype.close=function(){this.node.active=!1},__decorate([c(cc.Node)],e.prototype,"buttonContainer",void 0),__decorate([c(cc.Node)],e.prototype,"buttonTemplate",void 0),e=a=__decorate([i],e);var a}(cc.Component);a.default=l,cc._RF.pop()},{"./DataMgr":"DataMgr","./TechButton":"TechButton"}],ToastPanel:[function(t,e,a){"use strict";cc._RF.push(e,"159ccmVx0JBF6iFx9aAYPqK","ToastPanel"),Object.defineProperty(a,"__esModule",{value:!0});var o=cc._decorator,n=o.ccclass,r=o.property,i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.toastTemplate=null,e.container=null,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.toastTemplate.active=!1},e.prototype.toast=function(t){var e=cc.instantiate(a.Instance.toastTemplate);e.parent=this.container,e.getComponent(cc.Label).string=t,e.active=!0;var o=cc.sequence(cc.delayTime(4.5),cc.fadeOut(.5));e.runAction(o),setTimeout(function(){e.destroy()},5e3)},e.Toast=function(t){a.Instance.toast(t)},__decorate([r(cc.Node)],e.prototype,"toastTemplate",void 0),__decorate([r(cc.Node)],e.prototype,"container",void 0),e=a=__decorate([n],e);var a}(cc.Component);a.default=i,cc._RF.pop()},{}],WorkshopBuilding:[function(t,e,a){"use strict";cc._RF.push(e,"2ffd4wRHIRBKbqpQioNYuQn","WorkshopBuilding"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./DataMgr"),n=t("./Building"),r=t("./MainCtrl"),i=cc._decorator,c=i.ccclass,l=i.property,s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.lblConsumption=null,e.lblOutput=null,e.lblWorkers=null,e.nodeGear=null,e.btnDecWork=null,e.btnIncWork=null,e}return __extends(e,t),e.prototype.setInfo=function(t,e){this.info=t,this.data=e,this.lblName.string=t.Name,this.node.setContentSize(100*t.Length,100*t.Width),this.refresh()},e.prototype.changeWorkers=function(t,e){if("-"==e){var a=Math.min(this.data.workers,1);this.data.workers-=a,o.DataMgr.idleWorkers+=a}else if("+"==e){var n=Math.min(o.DataMgr.idleWorkers,1,this.info.MaxHuman-this.data.workers);this.data.workers+=n,o.DataMgr.idleWorkers-=n}this.refresh()},e.prototype.update=function(t){this.lblWorkers.string="人"+this.data.workers.toFixed()+"/"+this.info.MaxHuman,"research239"==this.data.id?this.data.workers>0&&o.DataMgr.currentWorkingTech&&(this.nodeGear.rotation+=360*this.data.workers/this.info.MaxHuman*t):this.data.isWorking&&(this.nodeGear.rotation+=360*this.data.workers/this.info.MaxHuman*t),this.btnDecWork.interactable=this.data.workers>0,this.btnIncWork.interactable=this.data.workers<this.info.MaxHuman,r.default.Ticks%200==0&&this.refresh()},e.prototype.refresh=function(){for(var t=this.info,e=[],a=function(a){var r=t["Raw"+a];if(r&&r.length>0){var i=t["Raw"+a+"Rate"],c=o.DataMgr.CargoConfig.find(function(t){return t.id==r}),l=Math.round(i*n.data.workers/n.info.MaxHuman*10)/10;e.push("消耗 "+l+c.Name+"/min")}},n=this,r=0;r<4;r++)a(r);var i=function(a){var n=t["Out"+a];if(n&&n.length>0){var r=t["Out"+a+"Rate"],i=o.DataMgr.CargoConfig.find(function(t){return t.id==n}),l=Math.round(r*c.data.workers/c.info.MaxHuman*10)/10;e.push("生产 "+l+i.Name+"/min")}},c=this;for(r=0;r<4;r++)i(r);if(e.length>0){var l=e[0];for(r=1;r<e.length;r++){l+="\n"+e[r]}this.lblConsumption.string=l}else this.lblConsumption.string=""},__decorate([l(cc.Label)],e.prototype,"lblConsumption",void 0),__decorate([l(cc.Label)],e.prototype,"lblOutput",void 0),__decorate([l(cc.Label)],e.prototype,"lblWorkers",void 0),__decorate([l(cc.Node)],e.prototype,"nodeGear",void 0),__decorate([l(cc.Button)],e.prototype,"btnDecWork",void 0),__decorate([l(cc.Button)],e.prototype,"btnIncWork",void 0),e=__decorate([c],e)}(n.default);a.default=s,cc._RF.pop()},{"./Building":"Building","./DataMgr":"DataMgr","./MainCtrl":"MainCtrl"}],WorldUI:[function(t,e,a){"use strict";cc._RF.push(e,"d2d4ehqPFVDS4fv9l1Oq7He","WorldUI"),Object.defineProperty(a,"__esModule",{value:!0});var o=t("./CvsMain"),n=t("./BaseUI"),r=t("./MainCtrl"),i=t("./ArkUI"),c=t("./ArkInWorld"),l=t("./DataMgr"),s=t("./BlockchainMgr"),d=t("./HomeUI"),u=t("./World/Island"),p=t("./UI/AttackIslandPanel"),h=t("./DialogPanel"),f=t("./Utils/CurrencyFormatter"),g=t("./UI/SponsorIslandPanel"),m=t("./UI/IslandInfoFrame"),y=t("./UI/ToastPanel"),M=t("./World/SpecialArk"),D=cc._decorator,v=D.ccclass,k=D.property,_=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.mineContainer=null,e.islandContainer=null,e.arkContainer=null,e.arkTemplate=null,e.worldMap=null,e.earth=null,e.grpSelectObject=null,e.grpSelectSpeArk=null,e.selectFrame=null,e.btnSponsorLink=null,e.lblAttackButton=null,e.btnCollectIsland=null,e.panPad=null,e.sldZoom=null,e.pressingZoomSlider=!1,e.zoomScale=.1,e.lblAsideSelectFrame=null,e.editSailDestinationMode=!1,e.grpSail=null,e.sailDestinationIndicator=null,e.lblDestinationInfo=null,e.btnCancelSail=null,e.btnConfirmSail=null,e.islandInfoFrameTemplate=null,e}return __extends(e,t),a=e,e.prototype.onLoad=function(){a.Instance=this,this.node.active=!1;var t=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(e){t.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(e){t.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(e){t.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.panPad.on(cc.Node.EventType.TOUCH_END,this.onPanPadTouchEnd,this),this.initIslandInfoFrames()},e.prototype.onEnable=function(){if(this.editSailDestinationMode=!1,this.selectedObjectNode=null,l.DataMgr.myData)try{this.refreshData(),this.refreshZoom()}catch(t){console.error(t)}},e.prototype.onBtnBackClick=function(){o.default.EnterUI(d.default)},e.prototype.refreshData=function(){for(var t=Object.keys(l.DataMgr.othersData).length+1,e=this.arkContainer.childrenCount;e<t;e++){cc.instantiate(this.arkTemplate).parent=this.arkContainer}for(var a=[],o=t;o<this.arkContainer.childrenCount;o++)a.push(this.arkContainer.children[o]);a.forEach(function(t){return t.destroy()}),this.arkContainer.children[0].getComponent(c.default).setAndRefresh(l.DataMgr.myData,this.zoomScale);var n=0;for(var r in l.DataMgr.othersData){var i=l.DataMgr.othersData[r];this.arkContainer.children[n+1].getComponent(c.default).setAndRefresh(i,this.zoomScale),n++}},e.prototype.refreshMyArk=function(){this.arkContainer.children[0].getComponent(c.default).setAndRefresh(l.DataMgr.myData,this.zoomScale)},e.prototype.refreshZoom=function(){this.earth.scale=this.zoomScale,this.editSailDestinationMode&&this.newDestination&&(this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale))},e.prototype.update=function(t){(l.DataMgr.changed||r.default.Ticks%100==0)&&(this.refreshData(),l.DataMgr.changed=!1);var e=this.sldZoom.progress;if(this.pressingZoomSlider||(e>.5?((e-=5*t)<.5&&(e=.5),this.sldZoom.progress=e):e<.5&&((e+=5*t)>.5&&(e=.5),this.sldZoom.progress=e)),.5!=e){var a=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(e-.5)*5*t),this.clampZoom();var o=this.zoomScale/a;this.worldMap.position=this.worldMap.position.mul(o),this.refreshZoom()}if(this.selectedObjectNode){this.selectFrame.active=!0,this.selectFrame.position=this.selectedObjectNode.position,this.selectFrame.setContentSize(2*this.selectedObjectNode.width,2*this.selectedObjectNode.height);var n=this.selectedObjectNode.getComponent(c.default),i=this.selectedObjectNode.getComponent(M.SpecialArk),s=this.selectedObjectNode.getComponent(u.default);if(n)this.grpSelectSpeArk.active=!1,this.grpSelectObject.active=!1;else if(s){if(this.btnSponsorLink.getComponentInChildren(cc.Label).string=s.data.sponsorName?s.data.sponsorName:"无赞助商",s.data.occupant&&s.data.occupant==l.DataMgr.myData.address){this.lblAttackButton.string="追加\n驻军";var d=s.data.lastMineTime,p=(Number(new Date)-d)/36e5,h=s.data.miningRate,g=s.data.money*(1-Math.exp(-h*p))/1e18;this.btnCollectIsland.node.active=!0,this.btnCollectIsland.getComponentInChildren(cc.Label).string="收取\n"+f.default.formatNAS(g)+"NAS"}else this.lblAttackButton.string="攻占",this.btnCollectIsland.node.active=!1;this.grpSelectSpeArk.active=!1,this.grpSelectObject.active=!0}else i&&(this.grpSelectObject.active=!1,this.grpSelectSpeArk.active=!0)}else this.grpSelectSpeArk.active=!1,this.selectFrame.active=!1,this.grpSelectObject.active=!1;if(this.editSailDestinationMode){if(this.grpSail.active=!0,this.sailDestinationIndicator.active=null!=this.newDestination,this.newDestination){var m=new cc.Vec2(l.DataMgr.myData.currentLocation.x,l.DataMgr.myData.currentLocation.y),y=this.newDestination.sub(m).mag(),D=y/l.DataMgr.getArkSpeedByTech(l.DataMgr.myTechData.find(function(t){return"arkspeed1011"==t.id}).finished),v=l.DataMgr.MethaneCostPerKmPerSize*y*l.DataMgr.myData.arkSize,k=y.toFixed()+"km\n"+D.toFixed()+"min\n"+v.toFixed()+"甲烷";this.lblDestinationInfo.string=k}}else this.grpSail.active=!1,this.sailDestinationIndicator.active=!1},e.prototype.onGotoArkClick=function(){o.default.EnterUI(i.default)},e.prototype.onCenterBtnClick=function(){var t=l.DataMgr.myData.currentLocation;t.mulSelf(this.zoomScale),this.worldMap.position=t.neg()},e.prototype.onPanPadTouchMove=function(t){var e=t.getDelta();this.worldMap.position=this.worldMap.position.add(new cc.Vec2(e.x,e.y))},e.prototype.onPanPadTouchEnd=function(t){if(this.editSailDestinationMode){var e=t.getLocation();if(new cc.Vec2(e.x,e.y).sub(t.getStartLocation()).mag()<20){var a=this.worldMap.convertTouchToNodeSpaceAR(t.touch);this.newDestination=a.mul(1/this.zoomScale),this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale)}}if(this.selectedObjectNode){e=t.getLocation();new cc.Vec2(e.x,e.y).sub(t.getStartLocation()).mag()<20&&this.cancelSelectObject()}},e.prototype.onMouseWheel=function(t){var e=t.getScrollY(),a=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var o=this.zoomScale/a;this.worldMap.position=this.worldMap.position.mul(o),this.refreshZoom()},e.prototype.onZoomSliderChange=function(t){},e.prototype.clampZoom=function(){this.zoomScale>10&&(this.zoomScale=10),this.zoomScale<.01&&(this.zoomScale=.01)},e.prototype.selectArk=function(t){this.selectedObjectNode=t,this.editSailDestinationMode=!1},e.prototype.selectSpecialArk=function(t){this.selectedObjectNode=t,this.editSailDestinationMode=!1},e.prototype.selectIsland=function(t){this.selectedObjectNode=t,this.editSailDestinationMode=!1},e.prototype.cancelSelectObject=function(){this.selectedObjectNode=null},e.prototype.onSelectObjectInfoClick=function(){var t=this.selectedObjectNode.getComponent(M.SpecialArk);if(t){var e=new cc.Vec2(l.DataMgr.myData.currentLocation.x,l.DataMgr.myData.currentLocation.y).sub(t.node.position).mag();t.showInfo(e)}},e.prototype.onBtnAttackIslandClick=function(){var t=this.selectedObjectNode?this.selectedObjectNode.getComponent(u.default):null;t&&(p.default.Instance.node.active=!0,p.default.Instance.setAndRefresh(t))},e.prototype.onBtnCollectIslandClick=function(){var t=this.selectedObjectNode?this.selectedObjectNode.getComponent(u.default):null;t&&t.data.occupant==l.DataMgr.myData.address&&s.default.Instance.collectIslandMoney(t.data.id)},e.prototype.onIslandSponsorLinkClick=function(){var t=this.selectedObjectNode?this.selectedObjectNode.getComponent(u.default):null;t&&t.data.sponsorLink&&window.open(t.data.sponsorLink)},e.prototype.onIslandIWantSponsorClick=function(){var t=this.selectedObjectNode?this.selectedObjectNode.getComponent(u.default):null;t&&(g.default.Instance.node.active=!0,g.default.Instance.setData(t))},e.prototype.onBtnSailClick=function(){this.selectedObjectNode=null,this.editSailDestinationMode=!0,this.newDestination=null;var t=l.DataMgr.myTechData.find(function(t){return"arkspeed1011"==t.id});l.DataMgr.myData.speed=l.DataMgr.getArkSpeedByTech(!!t&&t.finished)},e.prototype.onCancelSailClick=function(){this.editSailDestinationMode=!1,this.newDestination=null},e.prototype.onConfirmSailClick=function(){if(this.newDestination){var t=l.DataMgr.myData;if(t.arkSize<=l.DataMgr.SmallArkSize)h.default.PopupWith1Button("简陋方舟无法航行","您的方舟是简陋方舟，没有扩建功能，请原地呆着吧。\n想要功能完整的方舟？请回到主界面领取标准方舟或大型方舟。需要安装星云钱包哦！","知道了",null);else{var e=new cc.Vec2(l.DataMgr.myData.currentLocation.x,l.DataMgr.myData.currentLocation.y),a=this.newDestination.sub(e).mag(),o=l.DataMgr.MethaneCostPerKmPerSize*a*l.DataMgr.myData.arkSize,n=l.DataMgr.myCargoData.find(function(t){return"methane74"==t.id});if(o>n.amount)h.default.PopupWith1Button("燃料不足","方舟引擎的唯一动力来源是甲烷。如果你想要环球旅行，多造一些[甲烷采集器]吧！","知道了",null);else{var r=l.DataMgr.myTechData.find(function(t){return"arkspeed1011"==t.id});t.speed=l.DataMgr.getArkSpeedByTech(!!r&&r.finished);var i={};i.nickname=t.nickname,i.country=t.country,i.arkSize=t.arkSize,i.population=t.population,i.speed=t.speed,i.locationX=t.currentLocation.x,i.locationY=t.currentLocation.y,i.destinationX=this.newDestination.x,i.destinationY=this.newDestination.y,console.log("ConfirmSail",i),s.default.Instance.setSail(i,function(){n.amount=Math.max(0,n.amount-o)})}}}else y.default.Toast("请先点击地图空白位置，选择目的地，再点√")},e.prototype.initIslandInfoFrames=function(){var t=this;this.islandContainer.children.forEach(function(e){var a=cc.instantiate(t.islandInfoFrameTemplate);a.parent=e,a.position=t.islandInfoFrameTemplate.position,e.getComponent(u.default).infoFrame=a.getComponent(m.default),a.active=!0}),this.islandInfoFrameTemplate.active=!1},__decorate([k(cc.Node)],e.prototype,"mineContainer",void 0),__decorate([k(cc.Node)],e.prototype,"islandContainer",void 0),__decorate([k(cc.Node)],e.prototype,"arkContainer",void 0),__decorate([k(cc.Node)],e.prototype,"arkTemplate",void 0),__decorate([k(cc.Node)],e.prototype,"worldMap",void 0),__decorate([k(cc.Node)],e.prototype,"earth",void 0),__decorate([k(cc.Node)],e.prototype,"grpSelectObject",void 0),__decorate([k(cc.Node)],e.prototype,"grpSelectSpeArk",void 0),__decorate([k(cc.Node)],e.prototype,"selectFrame",void 0),__decorate([k(cc.Button)],e.prototype,"btnSponsorLink",void 0),__decorate([k(cc.Label)],e.prototype,"lblAttackButton",void 0),__decorate([k(cc.Button)],e.prototype,"btnCollectIsland",void 0),__decorate([k(cc.Node)],e.prototype,"panPad",void 0),__decorate([k(cc.Slider)],e.prototype,"sldZoom",void 0),__decorate([k(cc.Label)],e.prototype,"lblAsideSelectFrame",void 0),__decorate([k(cc.Node)],e.prototype,"grpSail",void 0),__decorate([k(cc.Node)],e.prototype,"sailDestinationIndicator",void 0),__decorate([k(cc.Label)],e.prototype,"lblDestinationInfo",void 0),__decorate([k(cc.Node)],e.prototype,"btnCancelSail",void 0),__decorate([k(cc.Node)],e.prototype,"btnConfirmSail",void 0),__decorate([k(cc.Node)],e.prototype,"islandInfoFrameTemplate",void 0),e=a=__decorate([v],e);var a}(n.default);a.default=_,cc._RF.pop()},{"./ArkInWorld":"ArkInWorld","./ArkUI":"ArkUI","./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./HomeUI":"HomeUI","./MainCtrl":"MainCtrl","./UI/AttackIslandPanel":"AttackIslandPanel","./UI/IslandInfoFrame":"IslandInfoFrame","./UI/SponsorIslandPanel":"SponsorIslandPanel","./UI/ToastPanel":"ToastPanel","./Utils/CurrencyFormatter":"CurrencyFormatter","./World/Island":"Island","./World/SpecialArk":"SpecialArk"}]},{},["ArkInWorld","ArkUI","BaseUI","BlockchainMgr","BuildPanel","Building","BuildingButton","CvsMain","DataMgr","DialogPanel","Foreground","HomeUI","HouseBuilding","MainCtrl","Road","TaskMgr","TechButton","TechPanel","AsyncLoadSprite","AttackIslandPanel","BuildingInfoPanel","EditNicknamePanel","FlagMgr","IntroUI","IslandInfoFrame","SponsorIslandPanel","ToastPanel","CurrencyFormatter","WorkshopBuilding","IronMine","Island","SpecialArk","WorldUI"]);