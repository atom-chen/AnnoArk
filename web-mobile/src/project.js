require=function i(r,c,l){function s(e,t){if(!c[e]){if(!r[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(u)return u(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var a=c[e]={exports:{}};r[e][0].call(a.exports,function(t){return s(r[e][1][t]||t)},a,a.exports,i,r,c,l)}return c[e].exports}for(var u="function"==typeof require&&require,t=0;t<l.length;t++)s(l[t]);return s}({ArkInWorld:[function(t,e,o){"use strict";cc._RF.push(e,"dec21HFq/1BXrPvCkgOJBUs","ArkInWorld"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./WorldUI"),a=cc._decorator,i=a.ccclass,r=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprArk=null,t.lblName=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(t,e){this.data=t,this.sprArk.node.setContentSize(t.arkSize,t.arkSize),this.lblName.string=t.nickname,this.refreshZoom(e)},t.prototype.refreshZoom=function(t){this.node.position=this.data.currentLocation.mul(t)},t.prototype.update=function(t){this.refreshZoom(n.default.Instance.zoomScale)},__decorate([r(cc.Sprite)],t.prototype,"sprArk",void 0),__decorate([r(cc.Label)],t.prototype,"lblName",void 0),t=__decorate([i],t)}(cc.Component);o.default=c,cc._RF.pop()},{"./WorldUI":"WorldUI"}],ArkUI:[function(t,e,o){"use strict";cc._RF.push(e,"e7f42dM68VAz487nLcu3wTI","ArkUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),a=t("./BaseUI"),i=t("./WorldUI"),u=t("./DataMgr"),c=t("./BuildPanel"),l=t("./Building"),s=t("./TechPanel"),d=t("./DialogPanel"),p=t("./UI/BuildingInfoPanel"),r=cc._decorator,h=r.ccclass,f=r.property,g=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.arkMap=null,t.cargoLabelContainer=null,t.cargoLabelTemplate=null,t.cargoLabels={},t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=1,t.workshopTemplate=null,t.houseTemplate=null,t.roadTemplate=null,t.buildingContainer=null,t.blueprint=null,t.blueprintIndicator=null,t.currentHoldingBlueprint=null,t.grpBuild=null,t.btnConfirmBuild=null,t.selectedBuilding=null,t.grpBuildingInfo=null,t}return __extends(t,e),(r=t).prototype.onLoad=function(){var n=this,e=r.Instance=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.cells=[];for(var t=-50;t<=50;t++){this.cells[t]=[];for(var o=-50;o<50;o++)this.cells[t][o]=new m}this.blueprint.on(cc.Node.EventType.TOUCH_MOVE,this.dragBlueprint.bind(this)),this.workshopTemplate.active=!1,this.roadTemplate.active=!1,this.houseTemplate.active=!1;var a=cc.instantiate(this.cargoLabelTemplate);a.parent=this.cargoLabelContainer;var i=a.getComponent(cc.Label);i.string="人口",this.cargoLabels.population=i,u.DataMgr.CargoConfig.forEach(function(t){var e=cc.instantiate(n.cargoLabelTemplate);e.parent=n.cargoLabelContainer;var o=e.getComponent(cc.Label);o.string=t.Name,n.cargoLabels[t.id]=o}),this.cargoLabelTemplate.active=!1},t.prototype.onEnable=function(){this.refreshZoom();for(var t=u.DataMgr.myData,e=-Math.floor(t.arkSize/2);e<t.arkSize/2;e++)for(var o=-Math.floor(t.arkSize/2);o<t.arkSize/2;o++){var n=this.cells[e][o];n.isLand=!0,n.building=null}var a=0;u.DataMgr.myBuildingData.forEach(function(t){a+=t.workers}),u.DataMgr.idleWorkers=t.population-a,this.deselectBuilding()},t.prototype.refreshZoom=function(){this.arkMap.scale=this.zoomScale},t.prototype.update=function(t){u.DataMgr.changed&&(this.refreshData(),u.DataMgr.changed=!1),this.cargoLabels.population.string="人口 "+u.DataMgr.myData.population+"/"+u.DataMgr.populationLimit+" (闲置 "+u.DataMgr.idleWorkers+") 增长"+u.DataMgr.populationGrowPerMin.toFixed(0)+"/min";for(var e=function(t){var n=u.DataMgr.CargoConfig[t],e=u.DataMgr.myCargoData.find(function(t,e,o){return t.id==n.id});o.cargoLabels[n.id].string=n.Name+"   "+Math.floor(e.amount).toFixed()},o=this,n=0;n<u.DataMgr.CargoConfig.length;n++)e(n);var a=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<a?((a-=5*t)<.5&&(a=.5),this.sldZoom.progress=a):a<.5&&(.5<(a+=5*t)&&(a=.5),this.sldZoom.progress=a)),.5!=a){var i=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(a-.5)*5*t),this.clampZoom();var r=this.zoomScale/i;this.arkMap.position=this.arkMap.position.mul(r),this.refreshZoom()}if(this.currentHoldingBlueprint){this.blueprint.active=!0,this.blueprint.position=new cc.Vec2(100*this.currentBlueprintIJ.i-50,100*this.currentBlueprintIJ.j-50),this.blueprint.setContentSize(100*this.currentHoldingBlueprint.length,100*this.currentHoldingBlueprint.width);var c=!0;this.blueprintIndicator.clear();for(n=0;n<this.currentHoldingBlueprint.length;n++)for(var l=0;l<this.currentHoldingBlueprint.width;l++){var s=this.cells[this.currentBlueprintIJ.i+n][this.currentBlueprintIJ.j+l];this.blueprintIndicator.fillColor=s.building?cc.Color.RED:cc.Color.GREEN,s.building&&(c=!1),s.isLand||(c=!1),this.blueprintIndicator.fillRect(100*n,100*l,100,100)}this.grpBuild.active=!0,this.btnConfirmBuild.interactable=c}else this.blueprint.active=!1,this.grpBuild.active=!1;this.selectedBuilding?this.grpBuildingInfo.active=!0:this.grpBuildingInfo.active=!1},t.prototype.refreshData=function(){},t.prototype.onGotoWorldClick=function(){this.deselectBuilding(),n.default.EnterUI(i.default)},t.prototype.onBuildBtnClick=function(){this.deselectBuilding(),c.default.Show()},t.prototype.onTechClick=function(){this.deselectBuilding(),s.default.Show()},t.prototype.onCenterBtnClick=function(){var t=u.DataMgr.myData,e=new cc.Vec2(t.arkLocationX,t.arkLocationY);e.mulSelf(this.zoomScale),this.arkMap.position=e.neg()},t.prototype.onPanPadTouchMove=function(t){console.log("drag map");var e=t.getDelta();this.arkMap.position=this.arkMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),o=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/o;this.arkMap.position=this.arkMap.position.mul(n),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){3<this.zoomScale&&(this.zoomScale=3),this.zoomScale<.3&&(this.zoomScale=.3)},t.prototype.enterBuildMode=function(t){this.currentHoldingBlueprint=t,this.currentBlueprintIJ=u.IJ.ZERO},t.prototype.dragBlueprint=function(t){var e=t.getLocation(),o=this.arkMap.convertToNodeSpaceAR(e);this.currentBlueprintIJ.i=Math.round(o.x/100),this.currentBlueprintIJ.j=Math.round(o.y/100)},t.prototype.onBtnConfirmBuildClick=function(){for(var t=!0,e=0;e<this.currentHoldingBlueprint.length;e++)for(var o=0;o<this.currentHoldingBlueprint.width;o++){var n=this.cells[this.currentBlueprintIJ.i+e][this.currentBlueprintIJ.j+o];n.building&&(t=!1),n.isLand||(t=!1)}if(t){var a=[];for(e=0;e<4;e++){var i=this.currentHoldingBlueprint["BuildMat"+e];if(i&&0<i.length){var r=this.currentHoldingBlueprint["BuildMat"+e+"Count"];a.push([i,r])}}var c=!0;a.forEach(function(e){u.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount<e[1]&&(c=!1)}),c&&(a.forEach(function(e){u.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount-=e[1]}),this.createBuilding(this.currentHoldingBlueprint,this.currentBlueprintIJ),"road00001"==this.currentHoldingBlueprint.id?this.currentBlueprintIJ.j+=1:this.currentHoldingBlueprint=null)}},t.prototype.onBtnCancelBuildClick=function(){this.currentHoldingBlueprint=null},t.prototype.createBuilding=function(t,e){var o=t.prefab,n=cc.instantiate(this[o+"Template"]);n.parent=this.buildingContainer;var a=n.getComponent(l.default),i=new u.BuildingData;i.id=t.id,i.ij=e.clone(),i.workers=0,u.DataMgr.myBuildingData.push(i),a.setInfo(t,i),n.position=new cc.Vec2(100*e.i-50,100*e.j-50),n.active=!0;for(var r=0;r<t.length;r++)for(var c=0;c<t.width;c++){this.cells[e.i+r][e.j+c].building=a}},t.prototype.selectBuilding=function(t){console.log("选中建筑"),this.selectedBuilding=t},t.prototype.deselectBuilding=function(){this.selectedBuilding=null},t.prototype.onDemolishBtnClick=function(){var t=r.Instance;this.selectedBuilding&&d.default.PopupWith2Buttons("确定拆除建筑吗",t.selectedBuilding.info.Name+"\n建筑材料不予返还","拆除",function(){t.demolishBuilding(t.selectedBuilding),t.deselectBuilding()},"取消",null)},t.prototype.demolishBuilding=function(e){if(e){console.log("拆除建筑");var t=u.DataMgr.myBuildingData.findIndex(function(t){return t==e.data});if(0<=t){var o=e.data.workers;u.DataMgr.myBuildingData.splice(t,1),e.node.destroy(),u.DataMgr.idleWorkers+=o}}},t.prototype.onBuildingInfoBtnClick=function(){this.selectedBuilding&&p.default.Show(this.selectedBuilding.info)},__decorate([f(cc.Node)],t.prototype,"arkMap",void 0),__decorate([f(cc.Node)],t.prototype,"cargoLabelContainer",void 0),__decorate([f(cc.Node)],t.prototype,"cargoLabelTemplate",void 0),__decorate([f(cc.Node)],t.prototype,"panPad",void 0),__decorate([f(cc.Slider)],t.prototype,"sldZoom",void 0),__decorate([f(cc.Node)],t.prototype,"workshopTemplate",void 0),__decorate([f(cc.Node)],t.prototype,"houseTemplate",void 0),__decorate([f(cc.Node)],t.prototype,"roadTemplate",void 0),__decorate([f(cc.Node)],t.prototype,"buildingContainer",void 0),__decorate([f(cc.Node)],t.prototype,"blueprint",void 0),__decorate([f(cc.Graphics)],t.prototype,"blueprintIndicator",void 0),__decorate([f(cc.Node)],t.prototype,"grpBuild",void 0),__decorate([f(cc.Button)],t.prototype,"btnConfirmBuild",void 0),__decorate([f(cc.Node)],t.prototype,"grpBuildingInfo",void 0),t=r=__decorate([h],t);var r}(a.default);o.default=g;var m=function(){this.isLand=!1,this.building=null};cc._RF.pop()},{"./BaseUI":"BaseUI","./BuildPanel":"BuildPanel","./Building":"Building","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./TechPanel":"TechPanel","./UI/BuildingInfoPanel":"BuildingInfoPanel","./WorldUI":"WorldUI"}],BaseUI:[function(t,e,o){"use strict";cc._RF.push(e,"3b934a4EjZFs6JzaRDhWpVf","BaseUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,i=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([a],e)}(cc.Component));o.default=i,cc._RF.pop()},{}],BlockchainMgr:[function(t,e,r){"use strict";cc._RF.push(e,"3ffefed5pBCD40DXf/kM6bs","BlockchainMgr"),Object.defineProperty(r,"__esModule",{value:!0});var a=t("./DataMgr"),c=t("./DialogPanel"),o=t("./WorldUI"),n=t("./UI/ToastPanel"),i=cc._decorator,l=i.ccclass;i.property;r.ContractAddress="n1rt9xtdXpfm6MNTmUhd6LaaY2w3tr7DxFd",r.EncKey=37234;var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.checkWalletCountdown=1e9,t.fetchAllDataCountdown=1e9,t}return __extends(t,e),(i=t).prototype.onLoad=function(){i.Instance=this},t.prototype.start=function(){this.checkWalletCountdown=1,this.fetchAllDataCountdown=1},t.prototype.update=function(t){try{Neb,NebPay}catch(t){return}if(this.checkWalletCountdown-=t,this.fetchAllDataCountdown-=t,this.checkWalletCountdown<=0){try{var e=this;(o=new Neb).setRequest(new HttpRequest(i.BlockchainUrl)),o.api.getNebState().then(function(t){window.addEventListener("message",e.onGetWalletData),window.postMessage({target:"contentscript",data:{},method:"getAccount"},"*")})}catch(t){console.error(t)}this.checkWalletCountdown=i.CheckWalletInterval}if(this.fetchAllDataCountdown<=0){var o;(o=new Neb).setRequest(new HttpRequest(i.BlockchainUrl));var n=i.WalletAddress?i.WalletAddress:Account.NewAccount().getAddressString(),a={function:"get_map_info",args:"[]"};o.api.call(n,r.ContractAddress,"0","0","1000000","2000000",a).then(this.onGetAllMapData).catch(function(t){console.log("call get_map_info error:"+t.message)}),this.fetchAllDataCountdown=i.FetchAllDataInterval}},t.prototype.onGetWalletData=function(t){if(t.data&&t.data.data&&t.data.data.account&&0<t.data.data.account.length){var e=t.data.data.account;i.WalletAddress!=e&&(console.log("Change wallet address:",e),i.WalletAddress=e,this.fetchAllDataCountdown=0)}},t.prototype.onGetAllMapData=function(t){console.log("onGetAllMapData",t);var e=JSON.parse(t.result).result_data,o=e.ark_info,n=e.island_info;o.forEach(function(t){var e=a.DataMgr.othersData[t.address];for(var o in e||((e=new a.UserData).currentLocation=new cc.Vec2(t.lastLocationX,t.lastLocationY),a.DataMgr.othersData[t.address]=e),t)e[o]=t[o]}),n.forEach(function(t){var e=a.DataMgr.allIslandData[t.id];if(e)for(var o in t)e[o]=t[o];else console.error("从区块链获取到未知id的island:",t)})},t.prototype.setSail=function(t){if(window.webExtensionWallet)try{var e=new NebPay,o=i.BlockchainUrl,n=r.ContractAddress;console.log("调用钱包",t);var a='["'+JSON.stringify(t)+'"]';e.call(n,0,"udpate_ark",a,{qrcode:{showQRCode:!1},goods:{name:"test",desc:"test goods"},callback:o,listener:this.setSailCallback})}catch(t){console.error(t)}else c.default.PopupWith2Buttons("您没有安装星云钱包","安装星云钱包，方可使用区块链功能，与全世界玩家互动。","取消",null,"去安装",function(){return window.open("https://github.com/ChengOrangeJu/WebExtensionWallet")})},t.prototype.setSailCallback=function(t){console.log("setSailCallback: ",t),"Error"!=t.toString().substr(0,5)?(n.default.Toast("方舟引擎开始预热，预计1分钟内出发\n(交易发送成功，请等待区块链出块)"),o.default.Instance.editSailDestinationMode=!1):n.default.Toast("交易失败:"+t)},t.encrypto=function(t,e,o){if("string"==typeof t&&"number"==typeof e&&"number"==typeof o){var n=[];o=o<=25?o:o%25;for(var a=0;a<t.length;a++){var i=t.charCodeAt(a);i=(i=1*i^e).toString(o),n.push(i)}var r=String.fromCharCode(o+97);return n.join(r)}},t.BlockchainUrl="https://testnet.nebulas.io",t.CheckWalletInterval=10,t.FetchAllDataInterval=10,t=i=__decorate([l],t);var i}(cc.Component);r.default=s,cc._RF.pop()},{"./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./UI/ToastPanel":"ToastPanel","./WorldUI":"WorldUI"}],BuildPanel:[function(t,e,o){"use strict";cc._RF.push(e,"5cf0290QotGfpJodxaDGNKp","BuildPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./DataMgr"),a=t("./BuildingButton"),i=cc._decorator,r=i.ccclass,c=i.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonContainer=null,t.buttonTemplate=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.start=function(){var o=this;n.DataMgr.BuildingConfig.forEach(function(t){var e=cc.instantiate(o.buttonTemplate);e.parent=o.buttonContainer,e.getComponent(a.default).setAndRefresh(t),e.active=!0}),this.buttonTemplate.active=!1},t.prototype.onEnable=function(){},t.prototype.refresh=function(){},t.Show=function(){o.Instance.node.active=!0},t.Hide=function(){o.Instance.node.active=!1},t.prototype.close=function(){this.node.active=!1},__decorate([c(cc.Node)],t.prototype,"buttonContainer",void 0),__decorate([c(cc.Node)],t.prototype,"buttonTemplate",void 0),t=o=__decorate([r],t);var o}(cc.Component);o.default=l,cc._RF.pop()},{"./BuildingButton":"BuildingButton","./DataMgr":"DataMgr"}],BuildingButton:[function(t,e,o){"use strict";cc._RF.push(e,"7884bIsfolMCKOoH+GiGik+","BuildingButton"),Object.defineProperty(o,"__esModule",{value:!0});var l=t("./BuildPanel"),s=t("./ArkUI"),u=t("./DataMgr"),d=t("./DialogPanel"),n=t("./UI/BuildingInfoPanel"),a=cc._decorator,i=a.ccclass,r=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblSize=null,t.sprSize=null,t.lblConsumption=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(a){this.info=a,this.lblName.string=a.Name,this.lblSize.string=a.length+"*"+a.width,this.sprSize.setContentSize(12*a.length,12*a.width);for(var i=[],t=function(t){var e=a["BuildMat"+t];if(e&&0<e.length){var o=a["BuildMat"+t+"Count"],n=u.DataMgr.CargoConfig.find(function(t){return t.id==e});i.push(n.Name+"*"+o)}},e=0;e<4;e++)t(e);if(0<i.length){var o=i[0];for(e=1;e<i.length;e++){o+="\n"+i[e]}this.lblConsumption.string=o}else this.lblConsumption.string=""},t.prototype.onClick=function(){n.default.Show(this.info)},t.prototype.onBuildClick=function(){for(var t=[],e=0;e<4;e++){var o=this.info["BuildMat"+e];if(o&&0<o.length){var n=this.info["BuildMat"+e+"Count"];t.push([o,n])}}var a=!0;if(t.forEach(function(e){u.DataMgr.myCargoData.find(function(t){return t.id==e[0]}).amount<e[1]&&(a=!1)}),a){var i=[];for(e=0;e<4;e++){var r=this.info["NeedTech"+e];r&&0<r.length&&i.push(r)}a=!0;var c=[];i.forEach(function(e){if(!u.DataMgr.myTechData.find(function(t){return t.id==e}).finished){a=!1;var t=u.DataMgr.TechConfig.find(function(t){return t.id==e});c.push(t.Name)}}),a?(l.default.Hide(),s.default.Instance.enterBuildMode(this.info)):d.default.PopupWith1Button("尚未研究所需科技",c.join(", "),"确定",null)}else d.default.PopupWith1Button("建筑材料不足","","确定",null)},__decorate([r(cc.Label)],t.prototype,"lblName",void 0),__decorate([r(cc.Label)],t.prototype,"lblSize",void 0),__decorate([r(cc.Node)],t.prototype,"sprSize",void 0),__decorate([r(cc.Label)],t.prototype,"lblConsumption",void 0),t=__decorate([i],t)}(cc.Component);o.default=c,cc._RF.pop()},{"./ArkUI":"ArkUI","./BuildPanel":"BuildPanel","./DataMgr":"DataMgr","./DialogPanel":"DialogPanel","./UI/BuildingInfoPanel":"BuildingInfoPanel"}],BuildingInfoPanel:[function(t,e,o){"use strict";cc._RF.push(e,"3a0f2BiXhFBZ7J7uLjk6n4I","BuildingInfoPanel"),Object.defineProperty(o,"__esModule",{value:!0});var r=t("../DataMgr"),n=cc._decorator,a=n.ccclass,i=n.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblBuildingMat=null,t.lblHuman=null,t.lblRaw=null,t.lblOut=null,t.sprPic=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.refresh=function(a){this.lblName.string=a.Name;for(var i=[],t=function(t){var e=a["BuildMat"+t];if(e&&0<e.length){var o=a["BuildMat"+t+"Count"],n=r.DataMgr.CargoConfig.find(function(t){return t.id==e});i.push(n.Name+"*"+o)}},e=0;e<4;e++)t(e);this.lblBuildingMat.string=i.join("\n"),this.lblHuman.string=a.MaxHuman,i=[];var o=function(t){var e=a["Raw"+t];if(e&&0<e.length){var o=a["Raw"+t+"Rate"],n=r.DataMgr.CargoConfig.find(function(t){return t.id==e});i.push(n.Name+"*"+o)}};for(e=0;e<4;e++)o(e);this.lblRaw.string=i.join("\n"),i=[];var n=function(t){var e=a["Out"+t];if(e&&0<e.length){var o=a["Out"+t+"Rate"],n=r.DataMgr.CargoConfig.find(function(t){return t.id==e});i.push(n.Name+"*"+o)}};for(e=0;e<4;e++)n(e);this.lblOut.string=i.join("\n")},t.Show=function(e){var t;t="string"==typeof e?r.DataMgr.BuildingConfig.find(function(t){return t.id==e}):e,o.Instance.node.active=!0,o.Instance.refresh(t)},t.prototype.close=function(){this.node.active=!1},__decorate([i(cc.Label)],t.prototype,"lblName",void 0),__decorate([i(cc.Label)],t.prototype,"lblBuildingMat",void 0),__decorate([i(cc.Label)],t.prototype,"lblHuman",void 0),__decorate([i(cc.Label)],t.prototype,"lblRaw",void 0),__decorate([i(cc.Label)],t.prototype,"lblOut",void 0),__decorate([i(cc.Sprite)],t.prototype,"sprPic",void 0),t=o=__decorate([a],t);var o}(cc.Component);o.default=c,cc._RF.pop()},{"../DataMgr":"DataMgr"}],Building:[function(t,e,o){"use strict";cc._RF.push(e,"3d090TfsndH9pF8dNZnNchl","Building"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./ArkUI"),a=cc._decorator,i=a.ccclass,r=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t}return __extends(t,e),t.prototype.onClick=function(){n.default.Instance.selectBuilding(this)},t.prototype.setInfo=function(t,e){this.info=t,this.data=e,this.lblName&&(this.lblName.string=t.Name),this.node.setContentSize(100*t.length,100*t.width)},__decorate([r(cc.Label)],t.prototype,"lblName",void 0),t=__decorate([i],t)}(cc.Component);o.default=c,cc._RF.pop()},{"./ArkUI":"ArkUI"}],CurrencyFormatter:[function(t,e,o){"use strict";cc._RF.push(e,"4455937OnBAOLdRb9e7YASo","CurrencyFormatter"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,i=(n.property,function(){function t(){}return t.formatBTC=function(t){if(Math.abs(t)<1e-7)return"0";var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.max(0,5-e))},t.formatNAS=function(t){var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.min(4,Math.max(0,4-e)))},t.formatCNY=function(t){if(Math.abs(t)<.005)return"0";var e=Math.max(0,Math.floor(Math.log(t)/Math.LN10));return t.toFixed(Math.min(2,Math.max(0,4-e)))},t=__decorate([a],t)}());o.default=i,cc._RF.pop()},{}],CvsMain:[function(t,e,o){"use strict";cc._RF.push(e,"69237yn4edJBK/5XvDAGlzX","CvsMain"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,i=n.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.fitter=null,t.uiContainer=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).uiContainer.children.forEach(function(t){return t.active=!1})},t.EnterUI=function(e){this.Instance.uiContainer.children.forEach(function(t){t.getComponent(e)?t.active=!0:t.active=!1})},t.prototype.update=function(){var t=cc.view.getVisibleSize();this.lastVisibleSize&&t.equals(this.lastVisibleSize)||(t.width>=t.height?(this.fitter.rotation=0,this.fitter.scale=1,this.fitter.setContentSize(1080/t.height*t.width,1080)):(this.fitter.rotation=90,this.fitter.setContentSize(1080/t.width*t.height,1080),this.fitter.scale=t.width/1080),this.lastVisibleSize=t)},__decorate([i(cc.Node)],t.prototype,"fitter",void 0),__decorate([i(cc.Node)],t.prototype,"uiContainer",void 0),t=o=__decorate([a],t);var o}(cc.Component);o.default=r,cc._RF.pop()},{}],DataMgr:[function(t,e,o){"use strict";cc._RF.push(e,"c6c13KfXfRK06sYYQzi7BU0","DataMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function e(){}return e.readData=function(){try{var t=JSON.parse(cc.sys.localStorage.getItem("user0"));e.myData=t,e.myBuildingData=JSON.parse(cc.sys.localStorage.getItem("user0Building")),e.myCargoData=JSON.parse(cc.sys.localStorage.getItem("user0Cargo")),e.myTechData=JSON.parse(cc.sys.localStorage.getItem("user0Tech")),e.currentWorkingTech=JSON.parse(cc.sys.localStorage.getItem("user0CurrentWorkingTech")),e.changed=!0,console.log("finish read data")}catch(t){console.error(t)}},e.writeData=function(){try{cc.sys.localStorage.setItem("user0",JSON.stringify(e.myData)),cc.sys.localStorage.setItem("user0Building",JSON.stringify(e.myBuildingData)),cc.sys.localStorage.setItem("user0Cargo",JSON.stringify(e.myCargoData)),cc.sys.localStorage.setItem("user0Tech",JSON.stringify(e.myTechData)),cc.sys.localStorage.setItem("user0CurrentWorkingTech",JSON.stringify(e.currentWorkingTech)),console.log("finish write data")}catch(t){console.error(t)}},e.clearData=function(){cc.sys.localStorage.removeItem("user0"),cc.sys.localStorage.removeItem("user0Building")},e.idleWorkers=0,e.populationLimit=0,e.aboveIronMine=!1,e.othersData={},e.allIslandData={},e.changed=!1,e.populationGrowPerMin=0,e.researchRatePerMin=0,e}();o.DataMgr=n;var a=function(){this.population=0};o.UserData=a;var i=function(){};o.BuildingInfo=i;var r=function(){this.workers=0,this.isWorking=!1};o.BuildingData=r;var c=function(){};o.CargoInfo=c;var l=function(){};o.CargoData=l;var s=function(){};o.TechInfo=s;var u=function(){};o.TechData=u;var d=function(){};o.MineInfo=d;var p=function(){this.marinePower=0,this.tankPower=0,this.shipPower=0,this.money=0,this.sponsorName="",this.minMiningSpeed=.04167,this.miningRate=.02,this.occupantBalance=0};o.IslandData=p;var h=function(){function e(){this.i=0,this.j=0}return e.prototype.clone=function(){var t=new e;return t.i=this.i,t.j=this.j,t},Object.defineProperty(e,"ZERO",{get:function(){return new e},enumerable:!0,configurable:!0}),e}();o.IJ=h,cc._RF.pop()},{}],DialogPanel:[function(t,e,o){"use strict";cc._RF.push(e,"c0958fmSyFAp6wyHbHS0e10","DialogPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,i=n.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblTitle=null,t.lblContext=null,t.btn0=null,t.lblBtn0=null,t.btn1=null,t.lblBtn1=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).hide()},t.PopupWith1Button=function(t,e,o,n){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=o,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(0,0),this.Instance.btn1.active=!1},t.PopupWith2Buttons=function(t,e,o,n,a,i){this.Instance.show(),this.Instance.lblTitle.string=t,this.Instance.lblContext.string=e,this.Instance.func0=n,this.Instance.lblBtn0.string=o,this.Instance.btn0.active=!0,this.Instance.btn0.position=new cc.Vec2(-150,0),this.Instance.func1=i,this.Instance.lblBtn1.string=a,this.Instance.btn1.active=!0,this.Instance.btn1.position=new cc.Vec2(150,0)},t.prototype.onBtn0Click=function(){this.func0&&this.func0(),this.hide()},t.prototype.onBtn1Click=function(){this.func1&&this.func1(),this.hide()},t.prototype.show=function(){this.node.active=!0},t.prototype.hide=function(){this.node.active=!1},__decorate([i(cc.Label)],t.prototype,"lblTitle",void 0),__decorate([i(cc.Label)],t.prototype,"lblContext",void 0),__decorate([i(cc.Node)],t.prototype,"btn0",void 0),__decorate([i(cc.Label)],t.prototype,"lblBtn0",void 0),__decorate([i(cc.Node)],t.prototype,"btn1",void 0),__decorate([i(cc.Label)],t.prototype,"lblBtn1",void 0),t=o=__decorate([a],t);var o}(cc.Component);o.default=r,cc._RF.pop()},{}],Foreground:[function(t,e,o){"use strict";cc._RF.push(e,"c7a1eqdirtJGpHjde8W3SsV","Foreground"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,i=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){this.node.children.forEach(function(t){t.active||(t.active=!0,t.active=!1)})},e=__decorate([a],e)}(cc.Component));o.default=i,cc._RF.pop()},{}],HomeUI:[function(t,e,o){"use strict";cc._RF.push(e,"458fd6d6ChEGo+U+drv+haG","HomeUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),a=t("./BaseUI"),i=t("./MainCtrl"),r=t("./DataMgr"),c=t("./WorldUI"),l=t("./UI/ToastPanel"),s=t("./BlockchainMgr"),u=cc._decorator,d=u.ccclass,p=u.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.btnClaim0=null,t.btnClaim1=null,t.btnClaim2=null,t.lblBlockchainAddress=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){o.Instance=this},t.prototype.start=function(){r.DataMgr.myData&&(r.DataMgr.myData.arkSize||(r.DataMgr.myData=null)),r.DataMgr.myData&&n.default.EnterUI(c.default),l.default.Toast("正在读取您的钱包信息，如果您在用钱包玩游戏，请稍候")},t.prototype.update=function(){this.lblBlockchainAddress.string=s.default.WalletAddress},t.prototype.onClaim=function(t,e){switch(e){case"0":r.DataMgr.myData=i.default.Instance.generateNewArk(9),this.enterGameWithArk()}r.DataMgr.myBuildingData=[]},t.prototype.enterGameWithArk=function(){r.DataMgr.myCargoData=[],r.DataMgr.CargoConfig.forEach(function(t){var e=new r.CargoData;e.id=t.id,e.amount=0,r.DataMgr.myCargoData.push(e)}),r.DataMgr.myTechData=[],r.DataMgr.TechConfig.forEach(function(t){var e=new r.TechData;e.id=t.id,e.filledWork=0,e.finished=!1,r.DataMgr.myTechData.push(e)}),n.default.EnterUI(c.default),console.log("pop",r.DataMgr.myData.population)},t.prototype.onBookClick=function(){console.log("哪有白皮书")},__decorate([p(cc.Button)],t.prototype,"btnClaim0",void 0),__decorate([p(cc.Button)],t.prototype,"btnClaim1",void 0),__decorate([p(cc.Button)],t.prototype,"btnClaim2",void 0),__decorate([p(cc.Label)],t.prototype,"lblBlockchainAddress",void 0),t=o=__decorate([d],t);var o}(a.default);o.default=h,cc._RF.pop()},{"./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./MainCtrl":"MainCtrl","./UI/ToastPanel":"ToastPanel","./WorldUI":"WorldUI"}],HouseBuilding:[function(t,e,o){"use strict";cc._RF.push(e,"4551bhwrptGmI96ad9hW5WZ","HouseBuilding"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Building"),a=cc._decorator,i=a.ccclass,r=a.property,c=function(o){function t(){var t=null!==o&&o.apply(this,arguments)||this;return t.lblPopulation=null,t}return __extends(t,o),t.prototype.setInfo=function(t,e){o.prototype.setInfo.call(this,t,e),this.lblPopulation.string=t.Arg0},__decorate([r(cc.Label)],t.prototype,"lblPopulation",void 0),t=__decorate([i],t)}(n.default);o.default=c,cc._RF.pop()},{"./Building":"Building"}],IntroUI:[function(t,e,o){"use strict";cc._RF.push(e,"09076VctrZEVKhEeIiQ5hEn","IntroUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../CvsMain"),a=t("../HomeUI"),i=cc._decorator,r=i.ccclass,c=(i.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onBtnStartClick=function(){n.default.EnterUI(a.default)},e=__decorate([r],e)}(cc.Component));o.default=c,cc._RF.pop()},{"../CvsMain":"CvsMain","../HomeUI":"HomeUI"}],IronMine:[function(t,e,o){"use strict";cc._RF.push(e,"ff0cb7j7qpO/Yov9EsIMZAo","IronMine"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,i=(n.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.onLoad=function(){if(this.gra=this.getComponent(cc.Graphics),this.col=this.getComponent(cc.PolygonCollider),3<=this.col.points.length&&this.gra){this.gra.moveTo(this.col.points[0].x,this.col.points[0].y);for(var t=1;t<this.col.points.length;t++){var e=this.col.points[t];this.gra.lineTo(e.x,e.y)}this.gra.close(),this.gra.fill()}},e=__decorate([a],e)}(cc.Component));o.default=i,cc._RF.pop()},{}],Island:[function(t,e,o){"use strict";cc._RF.push(e,"d5cb37wYS9LEY2kNMygFSvm","Island"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("../DataMgr"),a=t("../MainCtrl"),i=t("../Utils/CurrencyFormatter"),r=t("../WorldUI"),c=cc._decorator,l=c.ccclass,s=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblLeftMoney=null,t.lblMiningSpeed=null,t.lblOccupant=null,t}return __extends(t,e),t.prototype.setData=function(t){this.data=t},t.prototype.update=function(){a.default.Ticks%60==0&&this.refresh(),this.node.position=this.data.location.mul(r.default.Instance.zoomScale)},t.prototype.refresh=function(){if(this.data){this.lblName.string=this.data.sponsorName+" 资源岛",this.lblLeftMoney.string="当前储量"+i.default.formatNAS(this.data.money/1e18)+"NAS";var t=Math.max(this.data.minMiningSpeed,this.data.miningRate*this.data.money/1e18);if(this.lblMiningSpeed.string="采集速度"+i.default.formatNAS(t)+"NAS/小时",this.data.occupant&&0<this.data.occupant.length){var e=n.DataMgr.othersData[this.data.occupant];this.lblOccupant.string="占领者 "+(e?e.nickname:this.data.occupant)}else this.lblOccupant.string="无人占领"}},t.prototype.onLinkClick=function(){var t=this.data.sponsorLink;t&&0<t.length&&window.open(t)},__decorate([s(cc.Label)],t.prototype,"lblName",void 0),__decorate([s(cc.Label)],t.prototype,"lblLeftMoney",void 0),__decorate([s(cc.Label)],t.prototype,"lblMiningSpeed",void 0),__decorate([s(cc.Label)],t.prototype,"lblOccupant",void 0),t=__decorate([l],t)}(cc.Component);o.default=u,cc._RF.pop()},{"../DataMgr":"DataMgr","../MainCtrl":"MainCtrl","../Utils/CurrencyFormatter":"CurrencyFormatter","../WorldUI":"WorldUI"}],MainCtrl:[function(t,e,o){"use strict";cc._RF.push(e,"162b9/mIe1LjqpHBpjQnzp+","MainCtrl"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),a=t("./HomeUI"),h=t("./DataMgr"),i=t("./WorldUI"),r=t("./UI/IntroUI"),c=t("./World/Island"),l=cc._decorator,s=l.ccclass,u=(l.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),(l=e).prototype.onLoad=function(){l.Instance=this,h.DataMgr.readData(),this.fetchRemoteData(),n.default.Instance.uiContainer.getChildByName("WorldUI").active=!0},e.prototype.start=function(){n.default.EnterUI(r.default),cc.loader.loadRes("Building",function(t,e){console.log("Building loaded",e),h.DataMgr.BuildingConfig=e}.bind(this)),cc.loader.loadRes("Cargo",function(t,e){console.log("Cargo loaded"),h.DataMgr.CargoConfig=e}.bind(this)),cc.loader.loadRes("Tech",function(t,e){console.log("Tech loaded",e),h.DataMgr.TechConfig=e}.bind(this)),h.DataMgr.IronMineConfig=[],i.default.Instance.mineContainer.children.forEach(function(t){var e=t.getComponent(cc.PolygonCollider);if(e){var o=new h.MineInfo;o.polygonCollider=e;var n=[];e.points.forEach(function(t){n.push(e.node.position.add(e.offset).add(t))}),o.points=n,h.DataMgr.IronMineConfig.push(o)}}),i.default.Instance.islandContainer.children.forEach(function(t){var e=t.getComponent(c.default),o=new h.IslandData;o.id=parseInt(e.name),o.location=e.node.position,h.DataMgr.allIslandData[o.id]=o,e.setData(o)})},e.prototype.gotoHome=function(){n.default.EnterUI(a.default)},e.prototype.generateNewArk=function(t){var e=new h.UserData;e.arkSize=t;var o=Math.random()*Math.PI;return e.lastLocationX=4e3*Math.cos(o),e.lastLocationY=4e3*Math.sin(o),e.speed=0,e.population=5,e.nickname="新玩家",this.calcSail(e),e},e.prototype.fetchRemoteData=function(){var t=[],e=new h.UserData;e.arkSize=41,e.currentLocation=cc.Vec2.ZERO,e.lastLocationX=0,e.lastLocationY=0,e.speed=0,e.population=2251,e.nickname="星云号交易所方舟",t.push(e),h.DataMgr.othersData=t,h.DataMgr.changed=!0},e.prototype.update=function(u){var d=this;if(h.DataMgr.myData){h.DataMgr.populationLimit=0,h.DataMgr.researchRatePerMin=0,h.DataMgr.aboveIronMine=!1;var p=0;if(h.DataMgr.IronMineConfig.forEach(function(t){cc.Intersection.pointInPolygon(h.DataMgr.myData.currentLocation,t.points)&&(h.DataMgr.aboveIronMine=!0)}),h.DataMgr.myBuildingData&&h.DataMgr.myBuildingData.forEach(function(n){if(n.isWorking=!1,p+=n.workers,d.isHouse(n.id)){var a=h.DataMgr.BuildingConfig.find(function(t){return t.id==n.id});h.DataMgr.populationLimit+=parseInt(a.Arg0)}else if("research239"==n.id){if(h.DataMgr.currentWorkingTech){var t=h.DataMgr.TechConfig.find(function(t){return t.id==h.DataMgr.currentWorkingTech}),e=h.DataMgr.myTechData.find(function(t){return t.id==h.DataMgr.currentWorkingTech}),o=Math.min(t.Work-e.filledWork,1*n.workers/60*u);e.filledWork+=o,e.filledWork>=t.Work&&(e.finished=!0,h.DataMgr.currentWorkingTech=null),h.DataMgr.researchRatePerMin+=1*n.workers}}else{if(n.workers<=0)return;if("ironcoll28"==n.id&&!h.DataMgr.aboveIronMine)return;a=h.DataMgr.BuildingConfig.find(function(t){return t.id==n.id});for(var i=[],r=0;r<4;r++){var c=a["Raw"+r];c&&0<c.length&&i.push([c,a["Raw"+r+"Rate"]/a.MaxHuman/60*u*n.workers])}var l=!0;if(i.forEach(function(e){if(l){var t=h.DataMgr.myCargoData.find(function(t){return t.id==e[0]});t&&t.amount>e[1]?e.push(t):l=!1}}),l){i.forEach(function(t){t[2].amount-=t[1]});var s=function(t){var e=a["Out"+t];if(e&&0<e.length){var o=h.DataMgr.myCargoData.find(function(t){return t.id==e});o||((o=new h.CargoData).id=e,o.amount=0,h.DataMgr.myCargoData.push(o)),o.amount+=a["Out"+t+"Rate"]/a.MaxHuman/60*u*n.workers}};for(r=0;r<4;r++)s(r);n.isWorking=!0}}}),h.DataMgr.idleWorkers=h.DataMgr.myData.population-p,h.DataMgr.myData&&h.DataMgr.myCargoData){var n=1*h.DataMgr.myData.population/60*u,t=n;if(h.DataMgr.CargoConfig.forEach(function(e){if("TRUE"==e.IsFood){var t=h.DataMgr.myCargoData.find(function(t){return t.id==e.id});if(t&&0<t.amount){var o=Math.min(n,t.amount);n-=o,t.amount-=o}}}),n<=0&&h.DataMgr.myData.population<h.DataMgr.populationLimit){var e=(10+Math.sqrt(h.DataMgr.myData.population))/10*30,o=e/60*u;Math.random()<o&&(h.DataMgr.myData.population+=1,h.DataMgr.idleWorkers+=1),h.DataMgr.populationGrowPerMin=e}else if(0<n){var a=n/t,i=Math.max(0,h.DataMgr.myData.population-10)*a;o=i/60*u;if(Math.random()<o)if(0<h.DataMgr.idleWorkers)h.DataMgr.myData.population-=1,h.DataMgr.idleWorkers-=1;else{var r=h.DataMgr.myBuildingData.filter(function(t){return 0<t.workers&&"fisher8032"!=t.id});if(0<r.length)r[Math.floor(Math.random()*r.length)].workers-=1,h.DataMgr.myData.population-=1}h.DataMgr.populationGrowPerMin=-i}else h.DataMgr.populationGrowPerMin=0}for(var c in this.calcSail(h.DataMgr.myData),h.DataMgr.othersData)this.calcSail(h.DataMgr.othersData[c])}l.Ticks++},e.prototype.calcSail=function(t){if(t.speed&&0<t.speed&&t.destinationX&&t.destinationY){var e=t.lastLocationTime,o=Number(new Date),n=new cc.Vec2(t.lastLocationX,t.lastLocationY),a=new cc.Vec2(t.destinationX,t.destinationY),i=a.sub(n).mag()/(t.speed/60)*1e3,r=l.lerpVec2(n,a,(o-e)/i,!0);t.currentLocation=r}else t.currentLocation=new cc.Vec2(t.lastLocationX,t.lastLocationY)},e.lerp=function(t,e,o,n){return n&&(o=Math.max(0,Math.min(1,o))),t*(1-o)+e*o},e.lerpVec2=function(t,e,o,n){return n&&(o=Math.max(0,Math.min(1,o))),t.mul(1-o).add(e.mul(o))},e.prototype.isHouse=function(t){return"dorm08821"==t||"house8523"==t},e.Ticks=0,e=l=__decorate([s],e);var l}(cc.Component));o.default=u,cc._RF.pop()},{"./CvsMain":"CvsMain","./DataMgr":"DataMgr","./HomeUI":"HomeUI","./UI/IntroUI":"IntroUI","./World/Island":"Island","./WorldUI":"WorldUI"}],Road:[function(t,e,o){"use strict";cc._RF.push(e,"57853rAZexG4pEfR+Uh0ALl","Road"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./Building"),a=cc._decorator,i=a.ccclass,r=(a.property,function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e=__decorate([i],e)}(n.default));o.default=r,cc._RF.pop()},{"./Building":"Building"}],TaskMgr:[function(t,e,o){"use strict";cc._RF.push(e,"8b016C7S51BeY/RKmLSDzh4","TaskMgr"),Object.defineProperty(o,"__esModule",{value:!0});var n=function(){function t(){}return t.list=[{description:"",func:function(){}}],t}();o.default=n,cc._RF.pop()},{}],TechButton:[function(t,e,o){"use strict";cc._RF.push(e,"381b4B+yDRNAIom8tWyu99R","TechButton"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./DataMgr"),a=cc._decorator,i=a.ccclass,r=a.property,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblName=null,t.lblWork=null,t.prgWork=null,t.gear=null,t}return __extends(t,e),t.prototype.setAndRefresh=function(t,e){this.info=t,this.lblName.string=t.Name,this.lblWork.string=t.Work,this.data=e,this.prgWork.progress=e.filledWork/t.Work},t.prototype.update=function(t){this.prgWork.progress=this.data.filledWork/this.info.Work,n.DataMgr.currentWorkingTech==this.info.id?(this.gear.active=!0,this.gear.rotation+=36*n.DataMgr.researchRatePerMin*t):this.gear.active=!1},t.prototype.onClick=function(){n.DataMgr.currentWorkingTech!=this.info.id?n.DataMgr.currentWorkingTech=this.info.id:n.DataMgr.currentWorkingTech=null},__decorate([r(cc.Label)],t.prototype,"lblName",void 0),__decorate([r(cc.Label)],t.prototype,"lblWork",void 0),__decorate([r(cc.ProgressBar)],t.prototype,"prgWork",void 0),__decorate([r(cc.Node)],t.prototype,"gear",void 0),t=__decorate([i],t)}(cc.Component);o.default=c,cc._RF.pop()},{"./DataMgr":"DataMgr"}],TechPanel:[function(t,e,o){"use strict";cc._RF.push(e,"3402dUp2TBLFIsk2dVlT1d5","TechPanel"),Object.defineProperty(o,"__esModule",{value:!0});var i=t("./DataMgr"),r=t("./TechButton"),n=cc._decorator,a=n.ccclass,c=n.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.buttonContainer=null,t.buttonTemplate=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){(o.Instance=this).node.active=!1},t.prototype.start=function(){var a=this;i.DataMgr.TechConfig.forEach(function(e){var t=cc.instantiate(a.buttonTemplate);t.parent=a.buttonContainer;var o=t.getComponent(r.default),n=i.DataMgr.myTechData.find(function(t){return t.id==e.id});o.setAndRefresh(e,n),t.active=!0}),this.buttonTemplate.active=!1},t.prototype.onEnable=function(){},t.prototype.refresh=function(){},t.Show=function(){o.Instance.node.active=!0},t.Hide=function(){o.Instance.node.active=!1},t.prototype.close=function(){this.node.active=!1},__decorate([c(cc.Node)],t.prototype,"buttonContainer",void 0),__decorate([c(cc.Node)],t.prototype,"buttonTemplate",void 0),t=o=__decorate([a],t);var o}(cc.Component);o.default=l,cc._RF.pop()},{"./DataMgr":"DataMgr","./TechButton":"TechButton"}],ToastPanel:[function(t,e,o){"use strict";cc._RF.push(e,"159ccmVx0JBF6iFx9aAYPqK","ToastPanel"),Object.defineProperty(o,"__esModule",{value:!0});var n=cc._decorator,a=n.ccclass,i=n.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.toastTemplate=null,t.container=null,t}return __extends(t,e),(n=t).prototype.onLoad=function(){(n.Instance=this).toastTemplate.active=!1},t.prototype.toast=function(t){var e=cc.instantiate(n.Instance.toastTemplate);e.parent=this.container,e.getComponent(cc.Label).string=t,e.active=!0;var o=cc.sequence(cc.delayTime(2.5),cc.fadeOut(.5));e.runAction(o),setTimeout(function(){e.destroy()},3e3)},t.Toast=function(t){n.Instance.toast(t)},__decorate([i(cc.Node)],t.prototype,"toastTemplate",void 0),__decorate([i(cc.Node)],t.prototype,"container",void 0),t=n=__decorate([a],t);var n}(cc.Component);o.default=r,cc._RF.pop()},{}],WorkshopBuilding:[function(t,e,o){"use strict";cc._RF.push(e,"2ffd4wRHIRBKbqpQioNYuQn","WorkshopBuilding"),Object.defineProperty(o,"__esModule",{value:!0});var c=t("./DataMgr"),n=t("./Building"),a=cc._decorator,i=a.ccclass,r=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lblConsumption=null,t.lblOutput=null,t.lblWorkers=null,t.nodeGear=null,t.btnDecWork=null,t.btnIncWork=null,t}return __extends(t,e),t.prototype.setInfo=function(a,t){console.log("wb si"),this.info=a,this.data=t,this.lblName.string=a.Name;for(var i=[],e=function(t){var e=a["Raw"+t];if(e&&0<e.length){var o=a["Raw"+t+"Rate"],n=c.DataMgr.CargoConfig.find(function(t){return t.id==e});i.push("消耗 "+o+n.Name+"/min")}},o=0;o<4;o++)e(o);var n=function(t){var e=a["Out"+t];if(e&&0<e.length){var o=a["Out"+t+"Rate"],n=c.DataMgr.CargoConfig.find(function(t){return t.id==e});i.push("生产 "+o+n.Name+"/min")}};for(o=0;o<4;o++)n(o);if(0<i.length){var r=i[0];for(o=1;o<i.length;o++){r+="\n"+i[o]}this.lblConsumption.string=r}else this.lblConsumption.string="";this.node.setContentSize(100*a.length,100*a.width)},t.prototype.changeWorkers=function(t,e){if("-"==e){var o=Math.min(this.data.workers,1);this.data.workers-=o,c.DataMgr.idleWorkers+=o}else if("+"==e){var n=Math.min(c.DataMgr.idleWorkers,1,this.info.MaxHuman-this.data.workers);this.data.workers+=n,c.DataMgr.idleWorkers-=n}},t.prototype.update=function(t){this.lblWorkers.string="工人 "+this.data.workers.toFixed(),this.data.isWorking&&(this.nodeGear.rotation+=90*this.data.workers*t),this.btnDecWork.interactable=0<this.data.workers,this.btnIncWork.interactable=this.data.workers<this.info.MaxHuman},__decorate([r(cc.Label)],t.prototype,"lblConsumption",void 0),__decorate([r(cc.Label)],t.prototype,"lblOutput",void 0),__decorate([r(cc.Label)],t.prototype,"lblWorkers",void 0),__decorate([r(cc.Node)],t.prototype,"nodeGear",void 0),__decorate([r(cc.Button)],t.prototype,"btnDecWork",void 0),__decorate([r(cc.Button)],t.prototype,"btnIncWork",void 0),t=__decorate([i],t)}(n.default);o.default=l,cc._RF.pop()},{"./Building":"Building","./DataMgr":"DataMgr"}],WorldUI:[function(t,e,o){"use strict";cc._RF.push(e,"d2d4ehqPFVDS4fv9l1Oq7He","WorldUI"),Object.defineProperty(o,"__esModule",{value:!0});var n=t("./CvsMain"),a=t("./BaseUI"),i=t("./ArkUI"),c=t("./ArkInWorld"),l=t("./DataMgr"),r=t("./BlockchainMgr"),s=t("./HomeUI"),u=cc._decorator,d=u.ccclass,p=u.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mineContainer=null,t.islandContainer=null,t.arkContainer=null,t.arkTemplate=null,t.worldMap=null,t.earth=null,t.panPad=null,t.sldZoom=null,t.pressingZoomSlider=!1,t.zoomScale=.1,t.editSailDestinationMode=!1,t.grpSail=null,t.sailDestinationIndicator=null,t.btnCancelSail=null,t.btnConfirmSail=null,t}return __extends(t,e),(o=t).prototype.onLoad=function(){var e=o.Instance=this;this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_START,function(t){e.pressingZoomSlider=!0}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_END,function(t){e.pressingZoomSlider=!1}),this.sldZoom.node.getChildByName("Handle").on(cc.Node.EventType.TOUCH_CANCEL,function(t){e.pressingZoomSlider=!1}),this.panPad.on(cc.Node.EventType.TOUCH_MOVE,this.onPanPadTouchMove,this),this.panPad.on(cc.Node.EventType.MOUSE_WHEEL,this.onMouseWheel,this),this.panPad.on(cc.Node.EventType.TOUCH_END,this.onPanPadTouchEnd,this)},t.prototype.onEnable=function(){l.DataMgr.myData&&(this.refreshData(),this.refreshZoom())},t.prototype.onBtnBackClick=function(){n.default.EnterUI(s.default)},t.prototype.refreshData=function(){for(var t=Object.keys(l.DataMgr.othersData).length+1,e=this.arkContainer.childrenCount;e<t;e++){cc.instantiate(this.arkTemplate).parent=this.arkContainer}for(var o=[],n=t;n<this.arkContainer.childrenCount;n++)o.push(this.arkContainer.children[n]);o.forEach(function(t){return t.destroy()}),this.arkContainer.children[0].getComponent(c.default).setAndRefresh(l.DataMgr.myData,this.zoomScale);var a=0;for(var i in l.DataMgr.othersData){var r=l.DataMgr.othersData[i];this.arkContainer.children[a+1].getComponent(c.default).setAndRefresh(r,this.zoomScale),a++}},t.prototype.refreshMyArk=function(){this.arkContainer.children[0].getComponent(c.default).setAndRefresh(l.DataMgr.myData,this.zoomScale)},t.prototype.refreshZoom=function(){this.earth.scale=this.zoomScale,this.editSailDestinationMode&&this.newDestination&&(this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale))},t.prototype.update=function(t){l.DataMgr.changed&&(this.refreshData(),l.DataMgr.changed=!1);var e=this.sldZoom.progress;if(this.pressingZoomSlider||(.5<e?((e-=5*t)<.5&&(e=.5),this.sldZoom.progress=e):e<.5&&(.5<(e+=5*t)&&(e=.5),this.sldZoom.progress=e)),.5!=e){var o=this.zoomScale;this.zoomScale*=Math.pow(1.5,2*(e-.5)*5*t),this.clampZoom();var n=this.zoomScale/o;this.worldMap.position=this.worldMap.position.mul(n),this.refreshZoom()}this.editSailDestinationMode?(this.grpSail.active=!0,this.sailDestinationIndicator.active=null!=this.newDestination):(this.grpSail.active=!1,this.sailDestinationIndicator.active=!1)},t.prototype.onGotoArkClick=function(){n.default.EnterUI(i.default)},t.prototype.onCenterBtnClick=function(){var t=l.DataMgr.myData.currentLocation;t.mulSelf(this.zoomScale),this.worldMap.position=t.neg()},t.prototype.onPanPadTouchMove=function(t){console.log("drag map");var e=t.getDelta();this.worldMap.position=this.worldMap.position.add(new cc.Vec2(e.x,e.y))},t.prototype.onPanPadTouchEnd=function(t){if(this.editSailDestinationMode){var e=t.getLocation();if(console.log("curLoc",e),new cc.Vec2(e.x,e.y).sub(t.getStartLocation()).mag()<20){var o=this.worldMap.convertTouchToNodeSpaceAR(t.touch);console.log("toupos",o),this.newDestination=o.mul(1/this.zoomScale),this.sailDestinationIndicator.position=this.newDestination.mul(this.zoomScale)}}},t.prototype.onMouseWheel=function(t){var e=t.getScrollY(),o=this.zoomScale;this.zoomScale*=Math.pow(1.5,e/120),this.clampZoom();var n=this.zoomScale/o;this.worldMap.position=this.worldMap.position.mul(n),this.refreshZoom()},t.prototype.onZoomSliderChange=function(t){},t.prototype.clampZoom=function(){10<this.zoomScale&&(this.zoomScale=10),this.zoomScale<.01&&(this.zoomScale=.01)},t.prototype.onBtnSailClick=function(){this.editSailDestinationMode=!0,this.newDestination=null},t.prototype.onCancelSailClick=function(){this.editSailDestinationMode=!1,this.newDestination=null},t.prototype.onConfirmSailClick=function(){console.log("调用合约咯");var t=l.DataMgr.myData,e={speed:1e3};e.lastLocationX=t.lastLocationX,e.lastLocationX=t.lastLocationX,e.destinationX=this.newDestination.x,e.destinationY=this.newDestination.y,r.default.Instance.setSail(e)},__decorate([p(cc.Node)],t.prototype,"mineContainer",void 0),__decorate([p(cc.Node)],t.prototype,"islandContainer",void 0),__decorate([p(cc.Node)],t.prototype,"arkContainer",void 0),__decorate([p(cc.Node)],t.prototype,"arkTemplate",void 0),__decorate([p(cc.Node)],t.prototype,"worldMap",void 0),__decorate([p(cc.Node)],t.prototype,"earth",void 0),__decorate([p(cc.Node)],t.prototype,"panPad",void 0),__decorate([p(cc.Slider)],t.prototype,"sldZoom",void 0),__decorate([p(cc.Node)],t.prototype,"grpSail",void 0),__decorate([p(cc.Node)],t.prototype,"sailDestinationIndicator",void 0),__decorate([p(cc.Node)],t.prototype,"btnCancelSail",void 0),__decorate([p(cc.Node)],t.prototype,"btnConfirmSail",void 0),t=o=__decorate([d],t);var o}(a.default);o.default=h,cc._RF.pop()},{"./ArkInWorld":"ArkInWorld","./ArkUI":"ArkUI","./BaseUI":"BaseUI","./BlockchainMgr":"BlockchainMgr","./CvsMain":"CvsMain","./DataMgr":"DataMgr","./HomeUI":"HomeUI"}]},{},["ArkInWorld","ArkUI","BaseUI","BlockchainMgr","BuildPanel","Building","BuildingButton","CvsMain","DataMgr","DialogPanel","Foreground","HomeUI","HouseBuilding","MainCtrl","Road","TaskMgr","TechButton","TechPanel","BuildingInfoPanel","IntroUI","ToastPanel","CurrencyFormatter","WorkshopBuilding","WorldUI","IronMine","Island"]);